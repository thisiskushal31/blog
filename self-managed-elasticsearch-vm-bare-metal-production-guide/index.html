<!DOCTYPE html><html lang="en" class="light"><head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Self-Managed Elasticsearch - VM and Bare Metal Production Guide | Kushal Gupta Tech Blog</title>
    <meta name="description" content="Complete guide to self-managed Elasticsearch on VM and bare metal with multi-node automation, performance tuning, hardware sizing, and operational procedures.">
    <meta name="author" content="Kushal Gupta">
    <meta name="keywords" content="Kushal Gupta, Kushal Gupta Platform Engineer, Kushal Gupta Software Engineer, Kushal Gupta DevOps Engineer, Kushal Gupta MLOps Engineer, Kushal Gupta AI Engineer, Kushal Gupta Engineer, Kushal Gupta Developer, Kushal Gupta Programmer, Kushal Gupta Tech, Kushal Gupta Blog, Kushal Gupta Professional, Kushal Gupta India, Platform Engineer India, Software Engineer India, DevOps Engineer India, MLOps Engineer India, AI Engineer India, Machine Learning Engineer India, Engineer India, Developer India, Programmer India, Tech Professional India, Technology Expert India, Full Stack Engineer India, Backend Engineer India, Frontend Engineer India, System Architect India, Software Architect India, Cloud Architect India, Solutions Architect India, Production Engineer India, Platform Engineer, Software Engineer, DevOps Engineer, MLOps Engineer, AI Engineer, Machine Learning Engineer, Engineer, Developer, Programmer, Tech Professional, Technology Expert, Full Stack Engineer, Backend Engineer, Frontend Engineer, System Architect, Software Architect, Cloud Architect, Solutions Architect, Production Engineer, Production Systems Engineer, Platform Development, Software Development, Cloud Computing, Infrastructure, Automation, Kubernetes, AWS, GCP, Azure, CI/CD, Terraform, GitOps, DevSecOps, MLOps, AI/ML, Machine Learning, Deep Learning, Artificial Intelligence, Data Science, Data Engineering, Platform Engineering, Infrastructure as Code, Microservices, Cloud-Native, Site Reliability Engineering, SRE, Tech Blog, Technology Blog, Programming Blog, Developer Blog, Engineering Blog, Technical Writing, Tech Articles, Software Articles, Programming Articles, Engineering Articles, Technology Content, Tech Content, Software Content, Programming Content, Engineering Content, Technology Insights, Tech Insights, Software Insights, Programming Insights, Engineering Insights, Technology Tutorials, Tech Tutorials, Software Tutorials, Programming Tutorials, Engineering Tutorials, Technology Guides, Tech Guides, Software Guides, Programming Guides, Engineering Guides">
    
    <!-- Google Search Console Verification -->
    <meta name="google-site-verification" content="rNdu4NokL3QVj_CH_zYaJ5XnbMFLST-u_ZQuRwrS67I">
    
    <!-- Additional SEO Meta Tags -->
    <meta name="robots" content="index, follow, max-image-preview:large, max-snippet:-1, max-video-preview:-1">
    <meta name="googlebot" content="index, follow">
    <link rel="canonical" href="https://thisiskushal31.github.io/blog/self-managed-elasticsearch-vm-bare-metal-production-guide">
    
    <!-- Professional Keywords for Search -->
    <meta name="subject" content="Kushal Gupta - Engineer, Developer &amp; Tech Professional">
    <meta name="classification" content="Technology, Engineering, Software Development, Programming, Cloud Computing, DevOps">
    <meta name="category" content="Technology Blog, Engineering Blog, Developer Blog, Programming Blog">
    <meta name="coverage" content="Worldwide">
    <meta name="distribution" content="Global">
    <meta name="rating" content="General">
    <meta name="revisit-after" content="7 days">
    <meta name="target" content="all">
    <meta name="HandheldFriendly" content="True">
    <meta name="MobileOptimized" content="320">
    
    <!-- Additional Generic Search Terms -->
    <meta name="application-name" content="Kushal Gupta Tech Blog">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="theme-color" content="#ffffff">
    <meta name="apple-mobile-web-app-title" content="Kushal Gupta Blog">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="article">
    <meta property="og:title" content="Self-Managed Elasticsearch - VM and Bare Metal Production Guide">
    <meta property="og:description" content="Complete guide to self-managed Elasticsearch on VM and bare metal with multi-node automation, performance tuning, hardware sizing, and operational procedures.">
    <meta property="og:image" content="https://thisiskushal31.github.io/blog/blog/blogImages/elasticsearch-deployment-guide.png">
    <meta property="og:url" content="https://thisiskushal31.github.io/blog/self-managed-elasticsearch-vm-bare-metal-production-guide">

    <!-- Twitter -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Kushal Gupta | Tech Blog">
    <meta name="twitter:description" content="Tech blog with software development, cloud computing, and DevOps content. Practical guides for developers.">
    <meta name="twitter:image" content="https://thisiskushal31.github.io/og.png">

    <!-- Structured Data -->
    <script type="application/ld+json">
      {
        "@context": "https://schema.org",
        "@type": "Person",
        "name": "Kushal Gupta",
        "alternateName": ["Kushal Gupta Platform Engineer", "Kushal Gupta Software Engineer", "Kushal Gupta DevOps Engineer", "Kushal Gupta MLOps Engineer", "Kushal Gupta AI Engineer", "Kushal Gupta Engineer", "Kushal Gupta Developer", "Kushal Gupta Programmer", "Kushal Gupta Tech", "Kushal Gupta Blog", "Kushal Gupta Professional", "Kushal Gupta India"],
        "jobTitle": ["Platform Engineer", "Software Engineer", "DevOps Engineer", "MLOps Engineer", "AI Engineer", "Machine Learning Engineer", "Full Stack Engineer", "System Architect", "Cloud Architect", "Production Engineer", "Engineer", "Developer", "Programmer", "Tech Professional", "Technology Expert"],
        "description": "Kushal Gupta - Tech Professional. Blog with articles on software development, cloud computing, and DevOps.",
        "url": "https://thisiskushal31.github.io/blog/",
        "address": {
          "@type": "PostalAddress",
          "addressCountry": "India"
        },
        "knowsAbout": ["Software Development", "Cloud Computing", "DevOps", "Platform Engineering", "MLOps", "AI/ML", "Machine Learning", "Deep Learning", "Artificial Intelligence", "Data Science", "Data Engineering", "Full Stack Development", "Backend Development", "Frontend Development", "System Architecture", "Software Architecture", "Cloud Architecture", "Production Engineering", "Programming", "Technology", "Engineering", "Infrastructure", "Automation", "Kubernetes", "Docker", "AWS", "GCP", "Azure", "CI/CD", "Terraform", "GitOps", "DevSecOps", "Infrastructure as Code", "Microservices", "Cloud-Native", "Site Reliability Engineering", "SRE", "Monitoring", "Observability", "Security Engineering", "Performance Optimization", "Scalable Systems", "High Availability", "Technical Writing", "Tech Blogging", "Programming Tutorials", "Technology Guides", "System Design", "Containerization", "Orchestration", "Technical Consulting", "Remote Work", "Global Teams", "International Projects"],
        "sameAs": [
          "https://github.com/thisiskushal31",
          "https://www.linkedin.com/in/thisiskushalgupta/"
        ]
      }
    </script>

    <!-- Preload fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&amp;display=swap" rel="stylesheet">

    <!-- Font Awesome for social media icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA==" crossorigin="anonymous" referrerpolicy="no-referrer">

    <!-- Favicon -->
    <link rel="icon" href="/blog/favicon.ico" type="image/x-icon">

    <!-- Theme color (optional, if PWA or mobile) -->
    <meta name="theme-color" content="#ffffff">
    <script type="module" crossorigin="" src="/blog/assets/index-D85vkkJh.js"></script>
    <link rel="stylesheet" crossorigin="" href="/blog/assets/index-DBt49E5R.css">
  <style type="text/css">:where(html[dir="ltr"]),:where([data-sonner-toaster][dir="ltr"]){--toast-icon-margin-start: -3px;--toast-icon-margin-end: 4px;--toast-svg-margin-start: -1px;--toast-svg-margin-end: 0px;--toast-button-margin-start: auto;--toast-button-margin-end: 0;--toast-close-button-start: 0;--toast-close-button-end: unset;--toast-close-button-transform: translate(-35%, -35%)}:where(html[dir="rtl"]),:where([data-sonner-toaster][dir="rtl"]){--toast-icon-margin-start: 4px;--toast-icon-margin-end: -3px;--toast-svg-margin-start: 0px;--toast-svg-margin-end: -1px;--toast-button-margin-start: 0;--toast-button-margin-end: auto;--toast-close-button-start: unset;--toast-close-button-end: 0;--toast-close-button-transform: translate(35%, -35%)}:where([data-sonner-toaster]){position:fixed;width:var(--width);font-family:ui-sans-serif,system-ui,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Arial,Noto Sans,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol,Noto Color Emoji;--gray1: hsl(0, 0%, 99%);--gray2: hsl(0, 0%, 97.3%);--gray3: hsl(0, 0%, 95.1%);--gray4: hsl(0, 0%, 93%);--gray5: hsl(0, 0%, 90.9%);--gray6: hsl(0, 0%, 88.7%);--gray7: hsl(0, 0%, 85.8%);--gray8: hsl(0, 0%, 78%);--gray9: hsl(0, 0%, 56.1%);--gray10: hsl(0, 0%, 52.3%);--gray11: hsl(0, 0%, 43.5%);--gray12: hsl(0, 0%, 9%);--border-radius: 8px;box-sizing:border-box;padding:0;margin:0;list-style:none;outline:none;z-index:999999999;transition:transform .4s ease}:where([data-sonner-toaster][data-lifted="true"]){transform:translateY(-10px)}@media (hover: none) and (pointer: coarse){:where([data-sonner-toaster][data-lifted="true"]){transform:none}}:where([data-sonner-toaster][data-x-position="right"]){right:var(--offset-right)}:where([data-sonner-toaster][data-x-position="left"]){left:var(--offset-left)}:where([data-sonner-toaster][data-x-position="center"]){left:50%;transform:translate(-50%)}:where([data-sonner-toaster][data-y-position="top"]){top:var(--offset-top)}:where([data-sonner-toaster][data-y-position="bottom"]){bottom:var(--offset-bottom)}:where([data-sonner-toast]){--y: translateY(100%);--lift-amount: calc(var(--lift) * var(--gap));z-index:var(--z-index);position:absolute;opacity:0;transform:var(--y);filter:blur(0);touch-action:none;transition:transform .4s,opacity .4s,height .4s,box-shadow .2s;box-sizing:border-box;outline:none;overflow-wrap:anywhere}:where([data-sonner-toast][data-styled="true"]){padding:16px;background:var(--normal-bg);border:1px solid var(--normal-border);color:var(--normal-text);border-radius:var(--border-radius);box-shadow:0 4px 12px #0000001a;width:var(--width);font-size:13px;display:flex;align-items:center;gap:6px}:where([data-sonner-toast]:focus-visible){box-shadow:0 4px 12px #0000001a,0 0 0 2px #0003}:where([data-sonner-toast][data-y-position="top"]){top:0;--y: translateY(-100%);--lift: 1;--lift-amount: calc(1 * var(--gap))}:where([data-sonner-toast][data-y-position="bottom"]){bottom:0;--y: translateY(100%);--lift: -1;--lift-amount: calc(var(--lift) * var(--gap))}:where([data-sonner-toast]) :where([data-description]){font-weight:400;line-height:1.4;color:inherit}:where([data-sonner-toast]) :where([data-title]){font-weight:500;line-height:1.5;color:inherit}:where([data-sonner-toast]) :where([data-icon]){display:flex;height:16px;width:16px;position:relative;justify-content:flex-start;align-items:center;flex-shrink:0;margin-left:var(--toast-icon-margin-start);margin-right:var(--toast-icon-margin-end)}:where([data-sonner-toast][data-promise="true"]) :where([data-icon])>svg{opacity:0;transform:scale(.8);transform-origin:center;animation:sonner-fade-in .3s ease forwards}:where([data-sonner-toast]) :where([data-icon])>*{flex-shrink:0}:where([data-sonner-toast]) :where([data-icon]) svg{margin-left:var(--toast-svg-margin-start);margin-right:var(--toast-svg-margin-end)}:where([data-sonner-toast]) :where([data-content]){display:flex;flex-direction:column;gap:2px}[data-sonner-toast][data-styled=true] [data-button]{border-radius:4px;padding-left:8px;padding-right:8px;height:24px;font-size:12px;color:var(--normal-bg);background:var(--normal-text);margin-left:var(--toast-button-margin-start);margin-right:var(--toast-button-margin-end);border:none;cursor:pointer;outline:none;display:flex;align-items:center;flex-shrink:0;transition:opacity .4s,box-shadow .2s}:where([data-sonner-toast]) :where([data-button]):focus-visible{box-shadow:0 0 0 2px #0006}:where([data-sonner-toast]) :where([data-button]):first-of-type{margin-left:var(--toast-button-margin-start);margin-right:var(--toast-button-margin-end)}:where([data-sonner-toast]) :where([data-cancel]){color:var(--normal-text);background:rgba(0,0,0,.08)}:where([data-sonner-toast][data-theme="dark"]) :where([data-cancel]){background:rgba(255,255,255,.3)}:where([data-sonner-toast]) :where([data-close-button]){position:absolute;left:var(--toast-close-button-start);right:var(--toast-close-button-end);top:0;height:20px;width:20px;display:flex;justify-content:center;align-items:center;padding:0;color:var(--gray12);border:1px solid var(--gray4);transform:var(--toast-close-button-transform);border-radius:50%;cursor:pointer;z-index:1;transition:opacity .1s,background .2s,border-color .2s}[data-sonner-toast] [data-close-button]{background:var(--gray1)}:where([data-sonner-toast]) :where([data-close-button]):focus-visible{box-shadow:0 4px 12px #0000001a,0 0 0 2px #0003}:where([data-sonner-toast]) :where([data-disabled="true"]){cursor:not-allowed}:where([data-sonner-toast]):hover :where([data-close-button]):hover{background:var(--gray2);border-color:var(--gray5)}:where([data-sonner-toast][data-swiping="true"]):before{content:"";position:absolute;left:-50%;right:-50%;height:100%;z-index:-1}:where([data-sonner-toast][data-y-position="top"][data-swiping="true"]):before{bottom:50%;transform:scaleY(3) translateY(50%)}:where([data-sonner-toast][data-y-position="bottom"][data-swiping="true"]):before{top:50%;transform:scaleY(3) translateY(-50%)}:where([data-sonner-toast][data-swiping="false"][data-removed="true"]):before{content:"";position:absolute;inset:0;transform:scaleY(2)}:where([data-sonner-toast]):after{content:"";position:absolute;left:0;height:calc(var(--gap) + 1px);bottom:100%;width:100%}:where([data-sonner-toast][data-mounted="true"]){--y: translateY(0);opacity:1}:where([data-sonner-toast][data-expanded="false"][data-front="false"]){--scale: var(--toasts-before) * .05 + 1;--y: translateY(calc(var(--lift-amount) * var(--toasts-before))) scale(calc(-1 * var(--scale)));height:var(--front-toast-height)}:where([data-sonner-toast])>*{transition:opacity .4s}:where([data-sonner-toast][data-expanded="false"][data-front="false"][data-styled="true"])>*{opacity:0}:where([data-sonner-toast][data-visible="false"]){opacity:0;pointer-events:none}:where([data-sonner-toast][data-mounted="true"][data-expanded="true"]){--y: translateY(calc(var(--lift) * var(--offset)));height:var(--initial-height)}:where([data-sonner-toast][data-removed="true"][data-front="true"][data-swipe-out="false"]){--y: translateY(calc(var(--lift) * -100%));opacity:0}:where([data-sonner-toast][data-removed="true"][data-front="false"][data-swipe-out="false"][data-expanded="true"]){--y: translateY(calc(var(--lift) * var(--offset) + var(--lift) * -100%));opacity:0}:where([data-sonner-toast][data-removed="true"][data-front="false"][data-swipe-out="false"][data-expanded="false"]){--y: translateY(40%);opacity:0;transition:transform .5s,opacity .2s}:where([data-sonner-toast][data-removed="true"][data-front="false"]):before{height:calc(var(--initial-height) + 20%)}[data-sonner-toast][data-swiping=true]{transform:var(--y) translateY(var(--swipe-amount-y, 0px)) translate(var(--swipe-amount-x, 0px));transition:none}[data-sonner-toast][data-swiped=true]{user-select:none}[data-sonner-toast][data-swipe-out=true][data-y-position=bottom],[data-sonner-toast][data-swipe-out=true][data-y-position=top]{animation-duration:.2s;animation-timing-function:ease-out;animation-fill-mode:forwards}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=left]{animation-name:swipe-out-left}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=right]{animation-name:swipe-out-right}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=up]{animation-name:swipe-out-up}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=down]{animation-name:swipe-out-down}@keyframes swipe-out-left{0%{transform:var(--y) translate(var(--swipe-amount-x));opacity:1}to{transform:var(--y) translate(calc(var(--swipe-amount-x) - 100%));opacity:0}}@keyframes swipe-out-right{0%{transform:var(--y) translate(var(--swipe-amount-x));opacity:1}to{transform:var(--y) translate(calc(var(--swipe-amount-x) + 100%));opacity:0}}@keyframes swipe-out-up{0%{transform:var(--y) translateY(var(--swipe-amount-y));opacity:1}to{transform:var(--y) translateY(calc(var(--swipe-amount-y) - 100%));opacity:0}}@keyframes swipe-out-down{0%{transform:var(--y) translateY(var(--swipe-amount-y));opacity:1}to{transform:var(--y) translateY(calc(var(--swipe-amount-y) + 100%));opacity:0}}@media (max-width: 600px){[data-sonner-toaster]{position:fixed;right:var(--mobile-offset-right);left:var(--mobile-offset-left);width:100%}[data-sonner-toaster][dir=rtl]{left:calc(var(--mobile-offset-left) * -1)}[data-sonner-toaster] [data-sonner-toast]{left:0;right:0;width:calc(100% - var(--mobile-offset-left) * 2)}[data-sonner-toaster][data-x-position=left]{left:var(--mobile-offset-left)}[data-sonner-toaster][data-y-position=bottom]{bottom:var(--mobile-offset-bottom)}[data-sonner-toaster][data-y-position=top]{top:var(--mobile-offset-top)}[data-sonner-toaster][data-x-position=center]{left:var(--mobile-offset-left);right:var(--mobile-offset-right);transform:none}}[data-sonner-toaster][data-theme=light]{--normal-bg: #fff;--normal-border: var(--gray4);--normal-text: var(--gray12);--success-bg: hsl(143, 85%, 96%);--success-border: hsl(145, 92%, 91%);--success-text: hsl(140, 100%, 27%);--info-bg: hsl(208, 100%, 97%);--info-border: hsl(221, 91%, 91%);--info-text: hsl(210, 92%, 45%);--warning-bg: hsl(49, 100%, 97%);--warning-border: hsl(49, 91%, 91%);--warning-text: hsl(31, 92%, 45%);--error-bg: hsl(359, 100%, 97%);--error-border: hsl(359, 100%, 94%);--error-text: hsl(360, 100%, 45%)}[data-sonner-toaster][data-theme=light] [data-sonner-toast][data-invert=true]{--normal-bg: #000;--normal-border: hsl(0, 0%, 20%);--normal-text: var(--gray1)}[data-sonner-toaster][data-theme=dark] [data-sonner-toast][data-invert=true]{--normal-bg: #fff;--normal-border: var(--gray3);--normal-text: var(--gray12)}[data-sonner-toaster][data-theme=dark]{--normal-bg: #000;--normal-bg-hover: hsl(0, 0%, 12%);--normal-border: hsl(0, 0%, 20%);--normal-border-hover: hsl(0, 0%, 25%);--normal-text: var(--gray1);--success-bg: hsl(150, 100%, 6%);--success-border: hsl(147, 100%, 12%);--success-text: hsl(150, 86%, 65%);--info-bg: hsl(215, 100%, 6%);--info-border: hsl(223, 100%, 12%);--info-text: hsl(216, 87%, 65%);--warning-bg: hsl(64, 100%, 6%);--warning-border: hsl(60, 100%, 12%);--warning-text: hsl(46, 87%, 65%);--error-bg: hsl(358, 76%, 10%);--error-border: hsl(357, 89%, 16%);--error-text: hsl(358, 100%, 81%)}[data-sonner-toaster][data-theme=dark] [data-sonner-toast] [data-close-button]{background:var(--normal-bg);border-color:var(--normal-border);color:var(--normal-text)}[data-sonner-toaster][data-theme=dark] [data-sonner-toast] [data-close-button]:hover{background:var(--normal-bg-hover);border-color:var(--normal-border-hover)}[data-rich-colors=true][data-sonner-toast][data-type=success],[data-rich-colors=true][data-sonner-toast][data-type=success] [data-close-button]{background:var(--success-bg);border-color:var(--success-border);color:var(--success-text)}[data-rich-colors=true][data-sonner-toast][data-type=info],[data-rich-colors=true][data-sonner-toast][data-type=info] [data-close-button]{background:var(--info-bg);border-color:var(--info-border);color:var(--info-text)}[data-rich-colors=true][data-sonner-toast][data-type=warning],[data-rich-colors=true][data-sonner-toast][data-type=warning] [data-close-button]{background:var(--warning-bg);border-color:var(--warning-border);color:var(--warning-text)}[data-rich-colors=true][data-sonner-toast][data-type=error],[data-rich-colors=true][data-sonner-toast][data-type=error] [data-close-button]{background:var(--error-bg);border-color:var(--error-border);color:var(--error-text)}.sonner-loading-wrapper{--size: 16px;height:var(--size);width:var(--size);position:absolute;inset:0;z-index:10}.sonner-loading-wrapper[data-visible=false]{transform-origin:center;animation:sonner-fade-out .2s ease forwards}.sonner-spinner{position:relative;top:50%;left:50%;height:var(--size);width:var(--size)}.sonner-loading-bar{animation:sonner-spin 1.2s linear infinite;background:var(--gray11);border-radius:6px;height:8%;left:-10%;position:absolute;top:-3.9%;width:24%}.sonner-loading-bar:nth-child(1){animation-delay:-1.2s;transform:rotate(.0001deg) translate(146%)}.sonner-loading-bar:nth-child(2){animation-delay:-1.1s;transform:rotate(30deg) translate(146%)}.sonner-loading-bar:nth-child(3){animation-delay:-1s;transform:rotate(60deg) translate(146%)}.sonner-loading-bar:nth-child(4){animation-delay:-.9s;transform:rotate(90deg) translate(146%)}.sonner-loading-bar:nth-child(5){animation-delay:-.8s;transform:rotate(120deg) translate(146%)}.sonner-loading-bar:nth-child(6){animation-delay:-.7s;transform:rotate(150deg) translate(146%)}.sonner-loading-bar:nth-child(7){animation-delay:-.6s;transform:rotate(180deg) translate(146%)}.sonner-loading-bar:nth-child(8){animation-delay:-.5s;transform:rotate(210deg) translate(146%)}.sonner-loading-bar:nth-child(9){animation-delay:-.4s;transform:rotate(240deg) translate(146%)}.sonner-loading-bar:nth-child(10){animation-delay:-.3s;transform:rotate(270deg) translate(146%)}.sonner-loading-bar:nth-child(11){animation-delay:-.2s;transform:rotate(300deg) translate(146%)}.sonner-loading-bar:nth-child(12){animation-delay:-.1s;transform:rotate(330deg) translate(146%)}@keyframes sonner-fade-in{0%{opacity:0;transform:scale(.8)}to{opacity:1;transform:scale(1)}}@keyframes sonner-fade-out{0%{opacity:1;transform:scale(1)}to{opacity:0;transform:scale(.8)}}@keyframes sonner-spin{0%{opacity:1}to{opacity:.15}}@media (prefers-reduced-motion){[data-sonner-toast],[data-sonner-toast]>*,.sonner-loading-bar{transition:none!important;animation:none!important}}.sonner-loader{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);transform-origin:center;transition:opacity .2s,transform .2s}.sonner-loader[data-visible=false]{opacity:0;transform:scale(.8) translate(-50%,-50%)}
</style><style type="text/css">:where(html[dir="ltr"]),:where([data-sonner-toaster][dir="ltr"]){--toast-icon-margin-start: -3px;--toast-icon-margin-end: 4px;--toast-svg-margin-start: -1px;--toast-svg-margin-end: 0px;--toast-button-margin-start: auto;--toast-button-margin-end: 0;--toast-close-button-start: 0;--toast-close-button-end: unset;--toast-close-button-transform: translate(-35%, -35%)}:where(html[dir="rtl"]),:where([data-sonner-toaster][dir="rtl"]){--toast-icon-margin-start: 4px;--toast-icon-margin-end: -3px;--toast-svg-margin-start: 0px;--toast-svg-margin-end: -1px;--toast-button-margin-start: 0;--toast-button-margin-end: auto;--toast-close-button-start: unset;--toast-close-button-end: 0;--toast-close-button-transform: translate(35%, -35%)}:where([data-sonner-toaster]){position:fixed;width:var(--width);font-family:ui-sans-serif,system-ui,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Arial,Noto Sans,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol,Noto Color Emoji;--gray1: hsl(0, 0%, 99%);--gray2: hsl(0, 0%, 97.3%);--gray3: hsl(0, 0%, 95.1%);--gray4: hsl(0, 0%, 93%);--gray5: hsl(0, 0%, 90.9%);--gray6: hsl(0, 0%, 88.7%);--gray7: hsl(0, 0%, 85.8%);--gray8: hsl(0, 0%, 78%);--gray9: hsl(0, 0%, 56.1%);--gray10: hsl(0, 0%, 52.3%);--gray11: hsl(0, 0%, 43.5%);--gray12: hsl(0, 0%, 9%);--border-radius: 8px;box-sizing:border-box;padding:0;margin:0;list-style:none;outline:none;z-index:999999999;transition:transform .4s ease}:where([data-sonner-toaster][data-lifted="true"]){transform:translateY(-10px)}@media (hover: none) and (pointer: coarse){:where([data-sonner-toaster][data-lifted="true"]){transform:none}}:where([data-sonner-toaster][data-x-position="right"]){right:var(--offset-right)}:where([data-sonner-toaster][data-x-position="left"]){left:var(--offset-left)}:where([data-sonner-toaster][data-x-position="center"]){left:50%;transform:translate(-50%)}:where([data-sonner-toaster][data-y-position="top"]){top:var(--offset-top)}:where([data-sonner-toaster][data-y-position="bottom"]){bottom:var(--offset-bottom)}:where([data-sonner-toast]){--y: translateY(100%);--lift-amount: calc(var(--lift) * var(--gap));z-index:var(--z-index);position:absolute;opacity:0;transform:var(--y);filter:blur(0);touch-action:none;transition:transform .4s,opacity .4s,height .4s,box-shadow .2s;box-sizing:border-box;outline:none;overflow-wrap:anywhere}:where([data-sonner-toast][data-styled="true"]){padding:16px;background:var(--normal-bg);border:1px solid var(--normal-border);color:var(--normal-text);border-radius:var(--border-radius);box-shadow:0 4px 12px #0000001a;width:var(--width);font-size:13px;display:flex;align-items:center;gap:6px}:where([data-sonner-toast]:focus-visible){box-shadow:0 4px 12px #0000001a,0 0 0 2px #0003}:where([data-sonner-toast][data-y-position="top"]){top:0;--y: translateY(-100%);--lift: 1;--lift-amount: calc(1 * var(--gap))}:where([data-sonner-toast][data-y-position="bottom"]){bottom:0;--y: translateY(100%);--lift: -1;--lift-amount: calc(var(--lift) * var(--gap))}:where([data-sonner-toast]) :where([data-description]){font-weight:400;line-height:1.4;color:inherit}:where([data-sonner-toast]) :where([data-title]){font-weight:500;line-height:1.5;color:inherit}:where([data-sonner-toast]) :where([data-icon]){display:flex;height:16px;width:16px;position:relative;justify-content:flex-start;align-items:center;flex-shrink:0;margin-left:var(--toast-icon-margin-start);margin-right:var(--toast-icon-margin-end)}:where([data-sonner-toast][data-promise="true"]) :where([data-icon])>svg{opacity:0;transform:scale(.8);transform-origin:center;animation:sonner-fade-in .3s ease forwards}:where([data-sonner-toast]) :where([data-icon])>*{flex-shrink:0}:where([data-sonner-toast]) :where([data-icon]) svg{margin-left:var(--toast-svg-margin-start);margin-right:var(--toast-svg-margin-end)}:where([data-sonner-toast]) :where([data-content]){display:flex;flex-direction:column;gap:2px}[data-sonner-toast][data-styled=true] [data-button]{border-radius:4px;padding-left:8px;padding-right:8px;height:24px;font-size:12px;color:var(--normal-bg);background:var(--normal-text);margin-left:var(--toast-button-margin-start);margin-right:var(--toast-button-margin-end);border:none;cursor:pointer;outline:none;display:flex;align-items:center;flex-shrink:0;transition:opacity .4s,box-shadow .2s}:where([data-sonner-toast]) :where([data-button]):focus-visible{box-shadow:0 0 0 2px #0006}:where([data-sonner-toast]) :where([data-button]):first-of-type{margin-left:var(--toast-button-margin-start);margin-right:var(--toast-button-margin-end)}:where([data-sonner-toast]) :where([data-cancel]){color:var(--normal-text);background:rgba(0,0,0,.08)}:where([data-sonner-toast][data-theme="dark"]) :where([data-cancel]){background:rgba(255,255,255,.3)}:where([data-sonner-toast]) :where([data-close-button]){position:absolute;left:var(--toast-close-button-start);right:var(--toast-close-button-end);top:0;height:20px;width:20px;display:flex;justify-content:center;align-items:center;padding:0;color:var(--gray12);border:1px solid var(--gray4);transform:var(--toast-close-button-transform);border-radius:50%;cursor:pointer;z-index:1;transition:opacity .1s,background .2s,border-color .2s}[data-sonner-toast] [data-close-button]{background:var(--gray1)}:where([data-sonner-toast]) :where([data-close-button]):focus-visible{box-shadow:0 4px 12px #0000001a,0 0 0 2px #0003}:where([data-sonner-toast]) :where([data-disabled="true"]){cursor:not-allowed}:where([data-sonner-toast]):hover :where([data-close-button]):hover{background:var(--gray2);border-color:var(--gray5)}:where([data-sonner-toast][data-swiping="true"]):before{content:"";position:absolute;left:-50%;right:-50%;height:100%;z-index:-1}:where([data-sonner-toast][data-y-position="top"][data-swiping="true"]):before{bottom:50%;transform:scaleY(3) translateY(50%)}:where([data-sonner-toast][data-y-position="bottom"][data-swiping="true"]):before{top:50%;transform:scaleY(3) translateY(-50%)}:where([data-sonner-toast][data-swiping="false"][data-removed="true"]):before{content:"";position:absolute;inset:0;transform:scaleY(2)}:where([data-sonner-toast]):after{content:"";position:absolute;left:0;height:calc(var(--gap) + 1px);bottom:100%;width:100%}:where([data-sonner-toast][data-mounted="true"]){--y: translateY(0);opacity:1}:where([data-sonner-toast][data-expanded="false"][data-front="false"]){--scale: var(--toasts-before) * .05 + 1;--y: translateY(calc(var(--lift-amount) * var(--toasts-before))) scale(calc(-1 * var(--scale)));height:var(--front-toast-height)}:where([data-sonner-toast])>*{transition:opacity .4s}:where([data-sonner-toast][data-expanded="false"][data-front="false"][data-styled="true"])>*{opacity:0}:where([data-sonner-toast][data-visible="false"]){opacity:0;pointer-events:none}:where([data-sonner-toast][data-mounted="true"][data-expanded="true"]){--y: translateY(calc(var(--lift) * var(--offset)));height:var(--initial-height)}:where([data-sonner-toast][data-removed="true"][data-front="true"][data-swipe-out="false"]){--y: translateY(calc(var(--lift) * -100%));opacity:0}:where([data-sonner-toast][data-removed="true"][data-front="false"][data-swipe-out="false"][data-expanded="true"]){--y: translateY(calc(var(--lift) * var(--offset) + var(--lift) * -100%));opacity:0}:where([data-sonner-toast][data-removed="true"][data-front="false"][data-swipe-out="false"][data-expanded="false"]){--y: translateY(40%);opacity:0;transition:transform .5s,opacity .2s}:where([data-sonner-toast][data-removed="true"][data-front="false"]):before{height:calc(var(--initial-height) + 20%)}[data-sonner-toast][data-swiping=true]{transform:var(--y) translateY(var(--swipe-amount-y, 0px)) translate(var(--swipe-amount-x, 0px));transition:none}[data-sonner-toast][data-swiped=true]{user-select:none}[data-sonner-toast][data-swipe-out=true][data-y-position=bottom],[data-sonner-toast][data-swipe-out=true][data-y-position=top]{animation-duration:.2s;animation-timing-function:ease-out;animation-fill-mode:forwards}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=left]{animation-name:swipe-out-left}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=right]{animation-name:swipe-out-right}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=up]{animation-name:swipe-out-up}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=down]{animation-name:swipe-out-down}@keyframes swipe-out-left{0%{transform:var(--y) translate(var(--swipe-amount-x));opacity:1}to{transform:var(--y) translate(calc(var(--swipe-amount-x) - 100%));opacity:0}}@keyframes swipe-out-right{0%{transform:var(--y) translate(var(--swipe-amount-x));opacity:1}to{transform:var(--y) translate(calc(var(--swipe-amount-x) + 100%));opacity:0}}@keyframes swipe-out-up{0%{transform:var(--y) translateY(var(--swipe-amount-y));opacity:1}to{transform:var(--y) translateY(calc(var(--swipe-amount-y) - 100%));opacity:0}}@keyframes swipe-out-down{0%{transform:var(--y) translateY(var(--swipe-amount-y));opacity:1}to{transform:var(--y) translateY(calc(var(--swipe-amount-y) + 100%));opacity:0}}@media (max-width: 600px){[data-sonner-toaster]{position:fixed;right:var(--mobile-offset-right);left:var(--mobile-offset-left);width:100%}[data-sonner-toaster][dir=rtl]{left:calc(var(--mobile-offset-left) * -1)}[data-sonner-toaster] [data-sonner-toast]{left:0;right:0;width:calc(100% - var(--mobile-offset-left) * 2)}[data-sonner-toaster][data-x-position=left]{left:var(--mobile-offset-left)}[data-sonner-toaster][data-y-position=bottom]{bottom:var(--mobile-offset-bottom)}[data-sonner-toaster][data-y-position=top]{top:var(--mobile-offset-top)}[data-sonner-toaster][data-x-position=center]{left:var(--mobile-offset-left);right:var(--mobile-offset-right);transform:none}}[data-sonner-toaster][data-theme=light]{--normal-bg: #fff;--normal-border: var(--gray4);--normal-text: var(--gray12);--success-bg: hsl(143, 85%, 96%);--success-border: hsl(145, 92%, 91%);--success-text: hsl(140, 100%, 27%);--info-bg: hsl(208, 100%, 97%);--info-border: hsl(221, 91%, 91%);--info-text: hsl(210, 92%, 45%);--warning-bg: hsl(49, 100%, 97%);--warning-border: hsl(49, 91%, 91%);--warning-text: hsl(31, 92%, 45%);--error-bg: hsl(359, 100%, 97%);--error-border: hsl(359, 100%, 94%);--error-text: hsl(360, 100%, 45%)}[data-sonner-toaster][data-theme=light] [data-sonner-toast][data-invert=true]{--normal-bg: #000;--normal-border: hsl(0, 0%, 20%);--normal-text: var(--gray1)}[data-sonner-toaster][data-theme=dark] [data-sonner-toast][data-invert=true]{--normal-bg: #fff;--normal-border: var(--gray3);--normal-text: var(--gray12)}[data-sonner-toaster][data-theme=dark]{--normal-bg: #000;--normal-bg-hover: hsl(0, 0%, 12%);--normal-border: hsl(0, 0%, 20%);--normal-border-hover: hsl(0, 0%, 25%);--normal-text: var(--gray1);--success-bg: hsl(150, 100%, 6%);--success-border: hsl(147, 100%, 12%);--success-text: hsl(150, 86%, 65%);--info-bg: hsl(215, 100%, 6%);--info-border: hsl(223, 100%, 12%);--info-text: hsl(216, 87%, 65%);--warning-bg: hsl(64, 100%, 6%);--warning-border: hsl(60, 100%, 12%);--warning-text: hsl(46, 87%, 65%);--error-bg: hsl(358, 76%, 10%);--error-border: hsl(357, 89%, 16%);--error-text: hsl(358, 100%, 81%)}[data-sonner-toaster][data-theme=dark] [data-sonner-toast] [data-close-button]{background:var(--normal-bg);border-color:var(--normal-border);color:var(--normal-text)}[data-sonner-toaster][data-theme=dark] [data-sonner-toast] [data-close-button]:hover{background:var(--normal-bg-hover);border-color:var(--normal-border-hover)}[data-rich-colors=true][data-sonner-toast][data-type=success],[data-rich-colors=true][data-sonner-toast][data-type=success] [data-close-button]{background:var(--success-bg);border-color:var(--success-border);color:var(--success-text)}[data-rich-colors=true][data-sonner-toast][data-type=info],[data-rich-colors=true][data-sonner-toast][data-type=info] [data-close-button]{background:var(--info-bg);border-color:var(--info-border);color:var(--info-text)}[data-rich-colors=true][data-sonner-toast][data-type=warning],[data-rich-colors=true][data-sonner-toast][data-type=warning] [data-close-button]{background:var(--warning-bg);border-color:var(--warning-border);color:var(--warning-text)}[data-rich-colors=true][data-sonner-toast][data-type=error],[data-rich-colors=true][data-sonner-toast][data-type=error] [data-close-button]{background:var(--error-bg);border-color:var(--error-border);color:var(--error-text)}.sonner-loading-wrapper{--size: 16px;height:var(--size);width:var(--size);position:absolute;inset:0;z-index:10}.sonner-loading-wrapper[data-visible=false]{transform-origin:center;animation:sonner-fade-out .2s ease forwards}.sonner-spinner{position:relative;top:50%;left:50%;height:var(--size);width:var(--size)}.sonner-loading-bar{animation:sonner-spin 1.2s linear infinite;background:var(--gray11);border-radius:6px;height:8%;left:-10%;position:absolute;top:-3.9%;width:24%}.sonner-loading-bar:nth-child(1){animation-delay:-1.2s;transform:rotate(.0001deg) translate(146%)}.sonner-loading-bar:nth-child(2){animation-delay:-1.1s;transform:rotate(30deg) translate(146%)}.sonner-loading-bar:nth-child(3){animation-delay:-1s;transform:rotate(60deg) translate(146%)}.sonner-loading-bar:nth-child(4){animation-delay:-.9s;transform:rotate(90deg) translate(146%)}.sonner-loading-bar:nth-child(5){animation-delay:-.8s;transform:rotate(120deg) translate(146%)}.sonner-loading-bar:nth-child(6){animation-delay:-.7s;transform:rotate(150deg) translate(146%)}.sonner-loading-bar:nth-child(7){animation-delay:-.6s;transform:rotate(180deg) translate(146%)}.sonner-loading-bar:nth-child(8){animation-delay:-.5s;transform:rotate(210deg) translate(146%)}.sonner-loading-bar:nth-child(9){animation-delay:-.4s;transform:rotate(240deg) translate(146%)}.sonner-loading-bar:nth-child(10){animation-delay:-.3s;transform:rotate(270deg) translate(146%)}.sonner-loading-bar:nth-child(11){animation-delay:-.2s;transform:rotate(300deg) translate(146%)}.sonner-loading-bar:nth-child(12){animation-delay:-.1s;transform:rotate(330deg) translate(146%)}@keyframes sonner-fade-in{0%{opacity:0;transform:scale(.8)}to{opacity:1;transform:scale(1)}}@keyframes sonner-fade-out{0%{opacity:1;transform:scale(1)}to{opacity:0;transform:scale(.8)}}@keyframes sonner-spin{0%{opacity:1}to{opacity:.15}}@media (prefers-reduced-motion){[data-sonner-toast],[data-sonner-toast]>*,.sonner-loading-bar{transition:none!important;animation:none!important}}.sonner-loader{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);transform-origin:center;transition:opacity .2s,transform .2s}.sonner-loader[data-visible=false]{opacity:0;transform:scale(.8) translate(-50%,-50%)}
</style><style type="text/css">:where(html[dir="ltr"]),:where([data-sonner-toaster][dir="ltr"]){--toast-icon-margin-start: -3px;--toast-icon-margin-end: 4px;--toast-svg-margin-start: -1px;--toast-svg-margin-end: 0px;--toast-button-margin-start: auto;--toast-button-margin-end: 0;--toast-close-button-start: 0;--toast-close-button-end: unset;--toast-close-button-transform: translate(-35%, -35%)}:where(html[dir="rtl"]),:where([data-sonner-toaster][dir="rtl"]){--toast-icon-margin-start: 4px;--toast-icon-margin-end: -3px;--toast-svg-margin-start: 0px;--toast-svg-margin-end: -1px;--toast-button-margin-start: 0;--toast-button-margin-end: auto;--toast-close-button-start: unset;--toast-close-button-end: 0;--toast-close-button-transform: translate(35%, -35%)}:where([data-sonner-toaster]){position:fixed;width:var(--width);font-family:ui-sans-serif,system-ui,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Arial,Noto Sans,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol,Noto Color Emoji;--gray1: hsl(0, 0%, 99%);--gray2: hsl(0, 0%, 97.3%);--gray3: hsl(0, 0%, 95.1%);--gray4: hsl(0, 0%, 93%);--gray5: hsl(0, 0%, 90.9%);--gray6: hsl(0, 0%, 88.7%);--gray7: hsl(0, 0%, 85.8%);--gray8: hsl(0, 0%, 78%);--gray9: hsl(0, 0%, 56.1%);--gray10: hsl(0, 0%, 52.3%);--gray11: hsl(0, 0%, 43.5%);--gray12: hsl(0, 0%, 9%);--border-radius: 8px;box-sizing:border-box;padding:0;margin:0;list-style:none;outline:none;z-index:999999999;transition:transform .4s ease}:where([data-sonner-toaster][data-lifted="true"]){transform:translateY(-10px)}@media (hover: none) and (pointer: coarse){:where([data-sonner-toaster][data-lifted="true"]){transform:none}}:where([data-sonner-toaster][data-x-position="right"]){right:var(--offset-right)}:where([data-sonner-toaster][data-x-position="left"]){left:var(--offset-left)}:where([data-sonner-toaster][data-x-position="center"]){left:50%;transform:translate(-50%)}:where([data-sonner-toaster][data-y-position="top"]){top:var(--offset-top)}:where([data-sonner-toaster][data-y-position="bottom"]){bottom:var(--offset-bottom)}:where([data-sonner-toast]){--y: translateY(100%);--lift-amount: calc(var(--lift) * var(--gap));z-index:var(--z-index);position:absolute;opacity:0;transform:var(--y);filter:blur(0);touch-action:none;transition:transform .4s,opacity .4s,height .4s,box-shadow .2s;box-sizing:border-box;outline:none;overflow-wrap:anywhere}:where([data-sonner-toast][data-styled="true"]){padding:16px;background:var(--normal-bg);border:1px solid var(--normal-border);color:var(--normal-text);border-radius:var(--border-radius);box-shadow:0 4px 12px #0000001a;width:var(--width);font-size:13px;display:flex;align-items:center;gap:6px}:where([data-sonner-toast]:focus-visible){box-shadow:0 4px 12px #0000001a,0 0 0 2px #0003}:where([data-sonner-toast][data-y-position="top"]){top:0;--y: translateY(-100%);--lift: 1;--lift-amount: calc(1 * var(--gap))}:where([data-sonner-toast][data-y-position="bottom"]){bottom:0;--y: translateY(100%);--lift: -1;--lift-amount: calc(var(--lift) * var(--gap))}:where([data-sonner-toast]) :where([data-description]){font-weight:400;line-height:1.4;color:inherit}:where([data-sonner-toast]) :where([data-title]){font-weight:500;line-height:1.5;color:inherit}:where([data-sonner-toast]) :where([data-icon]){display:flex;height:16px;width:16px;position:relative;justify-content:flex-start;align-items:center;flex-shrink:0;margin-left:var(--toast-icon-margin-start);margin-right:var(--toast-icon-margin-end)}:where([data-sonner-toast][data-promise="true"]) :where([data-icon])>svg{opacity:0;transform:scale(.8);transform-origin:center;animation:sonner-fade-in .3s ease forwards}:where([data-sonner-toast]) :where([data-icon])>*{flex-shrink:0}:where([data-sonner-toast]) :where([data-icon]) svg{margin-left:var(--toast-svg-margin-start);margin-right:var(--toast-svg-margin-end)}:where([data-sonner-toast]) :where([data-content]){display:flex;flex-direction:column;gap:2px}[data-sonner-toast][data-styled=true] [data-button]{border-radius:4px;padding-left:8px;padding-right:8px;height:24px;font-size:12px;color:var(--normal-bg);background:var(--normal-text);margin-left:var(--toast-button-margin-start);margin-right:var(--toast-button-margin-end);border:none;cursor:pointer;outline:none;display:flex;align-items:center;flex-shrink:0;transition:opacity .4s,box-shadow .2s}:where([data-sonner-toast]) :where([data-button]):focus-visible{box-shadow:0 0 0 2px #0006}:where([data-sonner-toast]) :where([data-button]):first-of-type{margin-left:var(--toast-button-margin-start);margin-right:var(--toast-button-margin-end)}:where([data-sonner-toast]) :where([data-cancel]){color:var(--normal-text);background:rgba(0,0,0,.08)}:where([data-sonner-toast][data-theme="dark"]) :where([data-cancel]){background:rgba(255,255,255,.3)}:where([data-sonner-toast]) :where([data-close-button]){position:absolute;left:var(--toast-close-button-start);right:var(--toast-close-button-end);top:0;height:20px;width:20px;display:flex;justify-content:center;align-items:center;padding:0;color:var(--gray12);border:1px solid var(--gray4);transform:var(--toast-close-button-transform);border-radius:50%;cursor:pointer;z-index:1;transition:opacity .1s,background .2s,border-color .2s}[data-sonner-toast] [data-close-button]{background:var(--gray1)}:where([data-sonner-toast]) :where([data-close-button]):focus-visible{box-shadow:0 4px 12px #0000001a,0 0 0 2px #0003}:where([data-sonner-toast]) :where([data-disabled="true"]){cursor:not-allowed}:where([data-sonner-toast]):hover :where([data-close-button]):hover{background:var(--gray2);border-color:var(--gray5)}:where([data-sonner-toast][data-swiping="true"]):before{content:"";position:absolute;left:-50%;right:-50%;height:100%;z-index:-1}:where([data-sonner-toast][data-y-position="top"][data-swiping="true"]):before{bottom:50%;transform:scaleY(3) translateY(50%)}:where([data-sonner-toast][data-y-position="bottom"][data-swiping="true"]):before{top:50%;transform:scaleY(3) translateY(-50%)}:where([data-sonner-toast][data-swiping="false"][data-removed="true"]):before{content:"";position:absolute;inset:0;transform:scaleY(2)}:where([data-sonner-toast]):after{content:"";position:absolute;left:0;height:calc(var(--gap) + 1px);bottom:100%;width:100%}:where([data-sonner-toast][data-mounted="true"]){--y: translateY(0);opacity:1}:where([data-sonner-toast][data-expanded="false"][data-front="false"]){--scale: var(--toasts-before) * .05 + 1;--y: translateY(calc(var(--lift-amount) * var(--toasts-before))) scale(calc(-1 * var(--scale)));height:var(--front-toast-height)}:where([data-sonner-toast])>*{transition:opacity .4s}:where([data-sonner-toast][data-expanded="false"][data-front="false"][data-styled="true"])>*{opacity:0}:where([data-sonner-toast][data-visible="false"]){opacity:0;pointer-events:none}:where([data-sonner-toast][data-mounted="true"][data-expanded="true"]){--y: translateY(calc(var(--lift) * var(--offset)));height:var(--initial-height)}:where([data-sonner-toast][data-removed="true"][data-front="true"][data-swipe-out="false"]){--y: translateY(calc(var(--lift) * -100%));opacity:0}:where([data-sonner-toast][data-removed="true"][data-front="false"][data-swipe-out="false"][data-expanded="true"]){--y: translateY(calc(var(--lift) * var(--offset) + var(--lift) * -100%));opacity:0}:where([data-sonner-toast][data-removed="true"][data-front="false"][data-swipe-out="false"][data-expanded="false"]){--y: translateY(40%);opacity:0;transition:transform .5s,opacity .2s}:where([data-sonner-toast][data-removed="true"][data-front="false"]):before{height:calc(var(--initial-height) + 20%)}[data-sonner-toast][data-swiping=true]{transform:var(--y) translateY(var(--swipe-amount-y, 0px)) translate(var(--swipe-amount-x, 0px));transition:none}[data-sonner-toast][data-swiped=true]{user-select:none}[data-sonner-toast][data-swipe-out=true][data-y-position=bottom],[data-sonner-toast][data-swipe-out=true][data-y-position=top]{animation-duration:.2s;animation-timing-function:ease-out;animation-fill-mode:forwards}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=left]{animation-name:swipe-out-left}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=right]{animation-name:swipe-out-right}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=up]{animation-name:swipe-out-up}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=down]{animation-name:swipe-out-down}@keyframes swipe-out-left{0%{transform:var(--y) translate(var(--swipe-amount-x));opacity:1}to{transform:var(--y) translate(calc(var(--swipe-amount-x) - 100%));opacity:0}}@keyframes swipe-out-right{0%{transform:var(--y) translate(var(--swipe-amount-x));opacity:1}to{transform:var(--y) translate(calc(var(--swipe-amount-x) + 100%));opacity:0}}@keyframes swipe-out-up{0%{transform:var(--y) translateY(var(--swipe-amount-y));opacity:1}to{transform:var(--y) translateY(calc(var(--swipe-amount-y) - 100%));opacity:0}}@keyframes swipe-out-down{0%{transform:var(--y) translateY(var(--swipe-amount-y));opacity:1}to{transform:var(--y) translateY(calc(var(--swipe-amount-y) + 100%));opacity:0}}@media (max-width: 600px){[data-sonner-toaster]{position:fixed;right:var(--mobile-offset-right);left:var(--mobile-offset-left);width:100%}[data-sonner-toaster][dir=rtl]{left:calc(var(--mobile-offset-left) * -1)}[data-sonner-toaster] [data-sonner-toast]{left:0;right:0;width:calc(100% - var(--mobile-offset-left) * 2)}[data-sonner-toaster][data-x-position=left]{left:var(--mobile-offset-left)}[data-sonner-toaster][data-y-position=bottom]{bottom:var(--mobile-offset-bottom)}[data-sonner-toaster][data-y-position=top]{top:var(--mobile-offset-top)}[data-sonner-toaster][data-x-position=center]{left:var(--mobile-offset-left);right:var(--mobile-offset-right);transform:none}}[data-sonner-toaster][data-theme=light]{--normal-bg: #fff;--normal-border: var(--gray4);--normal-text: var(--gray12);--success-bg: hsl(143, 85%, 96%);--success-border: hsl(145, 92%, 91%);--success-text: hsl(140, 100%, 27%);--info-bg: hsl(208, 100%, 97%);--info-border: hsl(221, 91%, 91%);--info-text: hsl(210, 92%, 45%);--warning-bg: hsl(49, 100%, 97%);--warning-border: hsl(49, 91%, 91%);--warning-text: hsl(31, 92%, 45%);--error-bg: hsl(359, 100%, 97%);--error-border: hsl(359, 100%, 94%);--error-text: hsl(360, 100%, 45%)}[data-sonner-toaster][data-theme=light] [data-sonner-toast][data-invert=true]{--normal-bg: #000;--normal-border: hsl(0, 0%, 20%);--normal-text: var(--gray1)}[data-sonner-toaster][data-theme=dark] [data-sonner-toast][data-invert=true]{--normal-bg: #fff;--normal-border: var(--gray3);--normal-text: var(--gray12)}[data-sonner-toaster][data-theme=dark]{--normal-bg: #000;--normal-bg-hover: hsl(0, 0%, 12%);--normal-border: hsl(0, 0%, 20%);--normal-border-hover: hsl(0, 0%, 25%);--normal-text: var(--gray1);--success-bg: hsl(150, 100%, 6%);--success-border: hsl(147, 100%, 12%);--success-text: hsl(150, 86%, 65%);--info-bg: hsl(215, 100%, 6%);--info-border: hsl(223, 100%, 12%);--info-text: hsl(216, 87%, 65%);--warning-bg: hsl(64, 100%, 6%);--warning-border: hsl(60, 100%, 12%);--warning-text: hsl(46, 87%, 65%);--error-bg: hsl(358, 76%, 10%);--error-border: hsl(357, 89%, 16%);--error-text: hsl(358, 100%, 81%)}[data-sonner-toaster][data-theme=dark] [data-sonner-toast] [data-close-button]{background:var(--normal-bg);border-color:var(--normal-border);color:var(--normal-text)}[data-sonner-toaster][data-theme=dark] [data-sonner-toast] [data-close-button]:hover{background:var(--normal-bg-hover);border-color:var(--normal-border-hover)}[data-rich-colors=true][data-sonner-toast][data-type=success],[data-rich-colors=true][data-sonner-toast][data-type=success] [data-close-button]{background:var(--success-bg);border-color:var(--success-border);color:var(--success-text)}[data-rich-colors=true][data-sonner-toast][data-type=info],[data-rich-colors=true][data-sonner-toast][data-type=info] [data-close-button]{background:var(--info-bg);border-color:var(--info-border);color:var(--info-text)}[data-rich-colors=true][data-sonner-toast][data-type=warning],[data-rich-colors=true][data-sonner-toast][data-type=warning] [data-close-button]{background:var(--warning-bg);border-color:var(--warning-border);color:var(--warning-text)}[data-rich-colors=true][data-sonner-toast][data-type=error],[data-rich-colors=true][data-sonner-toast][data-type=error] [data-close-button]{background:var(--error-bg);border-color:var(--error-border);color:var(--error-text)}.sonner-loading-wrapper{--size: 16px;height:var(--size);width:var(--size);position:absolute;inset:0;z-index:10}.sonner-loading-wrapper[data-visible=false]{transform-origin:center;animation:sonner-fade-out .2s ease forwards}.sonner-spinner{position:relative;top:50%;left:50%;height:var(--size);width:var(--size)}.sonner-loading-bar{animation:sonner-spin 1.2s linear infinite;background:var(--gray11);border-radius:6px;height:8%;left:-10%;position:absolute;top:-3.9%;width:24%}.sonner-loading-bar:nth-child(1){animation-delay:-1.2s;transform:rotate(.0001deg) translate(146%)}.sonner-loading-bar:nth-child(2){animation-delay:-1.1s;transform:rotate(30deg) translate(146%)}.sonner-loading-bar:nth-child(3){animation-delay:-1s;transform:rotate(60deg) translate(146%)}.sonner-loading-bar:nth-child(4){animation-delay:-.9s;transform:rotate(90deg) translate(146%)}.sonner-loading-bar:nth-child(5){animation-delay:-.8s;transform:rotate(120deg) translate(146%)}.sonner-loading-bar:nth-child(6){animation-delay:-.7s;transform:rotate(150deg) translate(146%)}.sonner-loading-bar:nth-child(7){animation-delay:-.6s;transform:rotate(180deg) translate(146%)}.sonner-loading-bar:nth-child(8){animation-delay:-.5s;transform:rotate(210deg) translate(146%)}.sonner-loading-bar:nth-child(9){animation-delay:-.4s;transform:rotate(240deg) translate(146%)}.sonner-loading-bar:nth-child(10){animation-delay:-.3s;transform:rotate(270deg) translate(146%)}.sonner-loading-bar:nth-child(11){animation-delay:-.2s;transform:rotate(300deg) translate(146%)}.sonner-loading-bar:nth-child(12){animation-delay:-.1s;transform:rotate(330deg) translate(146%)}@keyframes sonner-fade-in{0%{opacity:0;transform:scale(.8)}to{opacity:1;transform:scale(1)}}@keyframes sonner-fade-out{0%{opacity:1;transform:scale(1)}to{opacity:0;transform:scale(.8)}}@keyframes sonner-spin{0%{opacity:1}to{opacity:.15}}@media (prefers-reduced-motion){[data-sonner-toast],[data-sonner-toast]>*,.sonner-loading-bar{transition:none!important;animation:none!important}}.sonner-loader{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);transform-origin:center;transition:opacity .2s,transform .2s}.sonner-loader[data-visible=false]{opacity:0;transform:scale(.8) translate(-50%,-50%)}
</style><style type="text/css">:where(html[dir="ltr"]),:where([data-sonner-toaster][dir="ltr"]){--toast-icon-margin-start: -3px;--toast-icon-margin-end: 4px;--toast-svg-margin-start: -1px;--toast-svg-margin-end: 0px;--toast-button-margin-start: auto;--toast-button-margin-end: 0;--toast-close-button-start: 0;--toast-close-button-end: unset;--toast-close-button-transform: translate(-35%, -35%)}:where(html[dir="rtl"]),:where([data-sonner-toaster][dir="rtl"]){--toast-icon-margin-start: 4px;--toast-icon-margin-end: -3px;--toast-svg-margin-start: 0px;--toast-svg-margin-end: -1px;--toast-button-margin-start: 0;--toast-button-margin-end: auto;--toast-close-button-start: unset;--toast-close-button-end: 0;--toast-close-button-transform: translate(35%, -35%)}:where([data-sonner-toaster]){position:fixed;width:var(--width);font-family:ui-sans-serif,system-ui,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Arial,Noto Sans,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol,Noto Color Emoji;--gray1: hsl(0, 0%, 99%);--gray2: hsl(0, 0%, 97.3%);--gray3: hsl(0, 0%, 95.1%);--gray4: hsl(0, 0%, 93%);--gray5: hsl(0, 0%, 90.9%);--gray6: hsl(0, 0%, 88.7%);--gray7: hsl(0, 0%, 85.8%);--gray8: hsl(0, 0%, 78%);--gray9: hsl(0, 0%, 56.1%);--gray10: hsl(0, 0%, 52.3%);--gray11: hsl(0, 0%, 43.5%);--gray12: hsl(0, 0%, 9%);--border-radius: 8px;box-sizing:border-box;padding:0;margin:0;list-style:none;outline:none;z-index:999999999;transition:transform .4s ease}:where([data-sonner-toaster][data-lifted="true"]){transform:translateY(-10px)}@media (hover: none) and (pointer: coarse){:where([data-sonner-toaster][data-lifted="true"]){transform:none}}:where([data-sonner-toaster][data-x-position="right"]){right:var(--offset-right)}:where([data-sonner-toaster][data-x-position="left"]){left:var(--offset-left)}:where([data-sonner-toaster][data-x-position="center"]){left:50%;transform:translate(-50%)}:where([data-sonner-toaster][data-y-position="top"]){top:var(--offset-top)}:where([data-sonner-toaster][data-y-position="bottom"]){bottom:var(--offset-bottom)}:where([data-sonner-toast]){--y: translateY(100%);--lift-amount: calc(var(--lift) * var(--gap));z-index:var(--z-index);position:absolute;opacity:0;transform:var(--y);filter:blur(0);touch-action:none;transition:transform .4s,opacity .4s,height .4s,box-shadow .2s;box-sizing:border-box;outline:none;overflow-wrap:anywhere}:where([data-sonner-toast][data-styled="true"]){padding:16px;background:var(--normal-bg);border:1px solid var(--normal-border);color:var(--normal-text);border-radius:var(--border-radius);box-shadow:0 4px 12px #0000001a;width:var(--width);font-size:13px;display:flex;align-items:center;gap:6px}:where([data-sonner-toast]:focus-visible){box-shadow:0 4px 12px #0000001a,0 0 0 2px #0003}:where([data-sonner-toast][data-y-position="top"]){top:0;--y: translateY(-100%);--lift: 1;--lift-amount: calc(1 * var(--gap))}:where([data-sonner-toast][data-y-position="bottom"]){bottom:0;--y: translateY(100%);--lift: -1;--lift-amount: calc(var(--lift) * var(--gap))}:where([data-sonner-toast]) :where([data-description]){font-weight:400;line-height:1.4;color:inherit}:where([data-sonner-toast]) :where([data-title]){font-weight:500;line-height:1.5;color:inherit}:where([data-sonner-toast]) :where([data-icon]){display:flex;height:16px;width:16px;position:relative;justify-content:flex-start;align-items:center;flex-shrink:0;margin-left:var(--toast-icon-margin-start);margin-right:var(--toast-icon-margin-end)}:where([data-sonner-toast][data-promise="true"]) :where([data-icon])>svg{opacity:0;transform:scale(.8);transform-origin:center;animation:sonner-fade-in .3s ease forwards}:where([data-sonner-toast]) :where([data-icon])>*{flex-shrink:0}:where([data-sonner-toast]) :where([data-icon]) svg{margin-left:var(--toast-svg-margin-start);margin-right:var(--toast-svg-margin-end)}:where([data-sonner-toast]) :where([data-content]){display:flex;flex-direction:column;gap:2px}[data-sonner-toast][data-styled=true] [data-button]{border-radius:4px;padding-left:8px;padding-right:8px;height:24px;font-size:12px;color:var(--normal-bg);background:var(--normal-text);margin-left:var(--toast-button-margin-start);margin-right:var(--toast-button-margin-end);border:none;cursor:pointer;outline:none;display:flex;align-items:center;flex-shrink:0;transition:opacity .4s,box-shadow .2s}:where([data-sonner-toast]) :where([data-button]):focus-visible{box-shadow:0 0 0 2px #0006}:where([data-sonner-toast]) :where([data-button]):first-of-type{margin-left:var(--toast-button-margin-start);margin-right:var(--toast-button-margin-end)}:where([data-sonner-toast]) :where([data-cancel]){color:var(--normal-text);background:rgba(0,0,0,.08)}:where([data-sonner-toast][data-theme="dark"]) :where([data-cancel]){background:rgba(255,255,255,.3)}:where([data-sonner-toast]) :where([data-close-button]){position:absolute;left:var(--toast-close-button-start);right:var(--toast-close-button-end);top:0;height:20px;width:20px;display:flex;justify-content:center;align-items:center;padding:0;color:var(--gray12);border:1px solid var(--gray4);transform:var(--toast-close-button-transform);border-radius:50%;cursor:pointer;z-index:1;transition:opacity .1s,background .2s,border-color .2s}[data-sonner-toast] [data-close-button]{background:var(--gray1)}:where([data-sonner-toast]) :where([data-close-button]):focus-visible{box-shadow:0 4px 12px #0000001a,0 0 0 2px #0003}:where([data-sonner-toast]) :where([data-disabled="true"]){cursor:not-allowed}:where([data-sonner-toast]):hover :where([data-close-button]):hover{background:var(--gray2);border-color:var(--gray5)}:where([data-sonner-toast][data-swiping="true"]):before{content:"";position:absolute;left:-50%;right:-50%;height:100%;z-index:-1}:where([data-sonner-toast][data-y-position="top"][data-swiping="true"]):before{bottom:50%;transform:scaleY(3) translateY(50%)}:where([data-sonner-toast][data-y-position="bottom"][data-swiping="true"]):before{top:50%;transform:scaleY(3) translateY(-50%)}:where([data-sonner-toast][data-swiping="false"][data-removed="true"]):before{content:"";position:absolute;inset:0;transform:scaleY(2)}:where([data-sonner-toast]):after{content:"";position:absolute;left:0;height:calc(var(--gap) + 1px);bottom:100%;width:100%}:where([data-sonner-toast][data-mounted="true"]){--y: translateY(0);opacity:1}:where([data-sonner-toast][data-expanded="false"][data-front="false"]){--scale: var(--toasts-before) * .05 + 1;--y: translateY(calc(var(--lift-amount) * var(--toasts-before))) scale(calc(-1 * var(--scale)));height:var(--front-toast-height)}:where([data-sonner-toast])>*{transition:opacity .4s}:where([data-sonner-toast][data-expanded="false"][data-front="false"][data-styled="true"])>*{opacity:0}:where([data-sonner-toast][data-visible="false"]){opacity:0;pointer-events:none}:where([data-sonner-toast][data-mounted="true"][data-expanded="true"]){--y: translateY(calc(var(--lift) * var(--offset)));height:var(--initial-height)}:where([data-sonner-toast][data-removed="true"][data-front="true"][data-swipe-out="false"]){--y: translateY(calc(var(--lift) * -100%));opacity:0}:where([data-sonner-toast][data-removed="true"][data-front="false"][data-swipe-out="false"][data-expanded="true"]){--y: translateY(calc(var(--lift) * var(--offset) + var(--lift) * -100%));opacity:0}:where([data-sonner-toast][data-removed="true"][data-front="false"][data-swipe-out="false"][data-expanded="false"]){--y: translateY(40%);opacity:0;transition:transform .5s,opacity .2s}:where([data-sonner-toast][data-removed="true"][data-front="false"]):before{height:calc(var(--initial-height) + 20%)}[data-sonner-toast][data-swiping=true]{transform:var(--y) translateY(var(--swipe-amount-y, 0px)) translate(var(--swipe-amount-x, 0px));transition:none}[data-sonner-toast][data-swiped=true]{user-select:none}[data-sonner-toast][data-swipe-out=true][data-y-position=bottom],[data-sonner-toast][data-swipe-out=true][data-y-position=top]{animation-duration:.2s;animation-timing-function:ease-out;animation-fill-mode:forwards}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=left]{animation-name:swipe-out-left}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=right]{animation-name:swipe-out-right}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=up]{animation-name:swipe-out-up}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=down]{animation-name:swipe-out-down}@keyframes swipe-out-left{0%{transform:var(--y) translate(var(--swipe-amount-x));opacity:1}to{transform:var(--y) translate(calc(var(--swipe-amount-x) - 100%));opacity:0}}@keyframes swipe-out-right{0%{transform:var(--y) translate(var(--swipe-amount-x));opacity:1}to{transform:var(--y) translate(calc(var(--swipe-amount-x) + 100%));opacity:0}}@keyframes swipe-out-up{0%{transform:var(--y) translateY(var(--swipe-amount-y));opacity:1}to{transform:var(--y) translateY(calc(var(--swipe-amount-y) - 100%));opacity:0}}@keyframes swipe-out-down{0%{transform:var(--y) translateY(var(--swipe-amount-y));opacity:1}to{transform:var(--y) translateY(calc(var(--swipe-amount-y) + 100%));opacity:0}}@media (max-width: 600px){[data-sonner-toaster]{position:fixed;right:var(--mobile-offset-right);left:var(--mobile-offset-left);width:100%}[data-sonner-toaster][dir=rtl]{left:calc(var(--mobile-offset-left) * -1)}[data-sonner-toaster] [data-sonner-toast]{left:0;right:0;width:calc(100% - var(--mobile-offset-left) * 2)}[data-sonner-toaster][data-x-position=left]{left:var(--mobile-offset-left)}[data-sonner-toaster][data-y-position=bottom]{bottom:var(--mobile-offset-bottom)}[data-sonner-toaster][data-y-position=top]{top:var(--mobile-offset-top)}[data-sonner-toaster][data-x-position=center]{left:var(--mobile-offset-left);right:var(--mobile-offset-right);transform:none}}[data-sonner-toaster][data-theme=light]{--normal-bg: #fff;--normal-border: var(--gray4);--normal-text: var(--gray12);--success-bg: hsl(143, 85%, 96%);--success-border: hsl(145, 92%, 91%);--success-text: hsl(140, 100%, 27%);--info-bg: hsl(208, 100%, 97%);--info-border: hsl(221, 91%, 91%);--info-text: hsl(210, 92%, 45%);--warning-bg: hsl(49, 100%, 97%);--warning-border: hsl(49, 91%, 91%);--warning-text: hsl(31, 92%, 45%);--error-bg: hsl(359, 100%, 97%);--error-border: hsl(359, 100%, 94%);--error-text: hsl(360, 100%, 45%)}[data-sonner-toaster][data-theme=light] [data-sonner-toast][data-invert=true]{--normal-bg: #000;--normal-border: hsl(0, 0%, 20%);--normal-text: var(--gray1)}[data-sonner-toaster][data-theme=dark] [data-sonner-toast][data-invert=true]{--normal-bg: #fff;--normal-border: var(--gray3);--normal-text: var(--gray12)}[data-sonner-toaster][data-theme=dark]{--normal-bg: #000;--normal-bg-hover: hsl(0, 0%, 12%);--normal-border: hsl(0, 0%, 20%);--normal-border-hover: hsl(0, 0%, 25%);--normal-text: var(--gray1);--success-bg: hsl(150, 100%, 6%);--success-border: hsl(147, 100%, 12%);--success-text: hsl(150, 86%, 65%);--info-bg: hsl(215, 100%, 6%);--info-border: hsl(223, 100%, 12%);--info-text: hsl(216, 87%, 65%);--warning-bg: hsl(64, 100%, 6%);--warning-border: hsl(60, 100%, 12%);--warning-text: hsl(46, 87%, 65%);--error-bg: hsl(358, 76%, 10%);--error-border: hsl(357, 89%, 16%);--error-text: hsl(358, 100%, 81%)}[data-sonner-toaster][data-theme=dark] [data-sonner-toast] [data-close-button]{background:var(--normal-bg);border-color:var(--normal-border);color:var(--normal-text)}[data-sonner-toaster][data-theme=dark] [data-sonner-toast] [data-close-button]:hover{background:var(--normal-bg-hover);border-color:var(--normal-border-hover)}[data-rich-colors=true][data-sonner-toast][data-type=success],[data-rich-colors=true][data-sonner-toast][data-type=success] [data-close-button]{background:var(--success-bg);border-color:var(--success-border);color:var(--success-text)}[data-rich-colors=true][data-sonner-toast][data-type=info],[data-rich-colors=true][data-sonner-toast][data-type=info] [data-close-button]{background:var(--info-bg);border-color:var(--info-border);color:var(--info-text)}[data-rich-colors=true][data-sonner-toast][data-type=warning],[data-rich-colors=true][data-sonner-toast][data-type=warning] [data-close-button]{background:var(--warning-bg);border-color:var(--warning-border);color:var(--warning-text)}[data-rich-colors=true][data-sonner-toast][data-type=error],[data-rich-colors=true][data-sonner-toast][data-type=error] [data-close-button]{background:var(--error-bg);border-color:var(--error-border);color:var(--error-text)}.sonner-loading-wrapper{--size: 16px;height:var(--size);width:var(--size);position:absolute;inset:0;z-index:10}.sonner-loading-wrapper[data-visible=false]{transform-origin:center;animation:sonner-fade-out .2s ease forwards}.sonner-spinner{position:relative;top:50%;left:50%;height:var(--size);width:var(--size)}.sonner-loading-bar{animation:sonner-spin 1.2s linear infinite;background:var(--gray11);border-radius:6px;height:8%;left:-10%;position:absolute;top:-3.9%;width:24%}.sonner-loading-bar:nth-child(1){animation-delay:-1.2s;transform:rotate(.0001deg) translate(146%)}.sonner-loading-bar:nth-child(2){animation-delay:-1.1s;transform:rotate(30deg) translate(146%)}.sonner-loading-bar:nth-child(3){animation-delay:-1s;transform:rotate(60deg) translate(146%)}.sonner-loading-bar:nth-child(4){animation-delay:-.9s;transform:rotate(90deg) translate(146%)}.sonner-loading-bar:nth-child(5){animation-delay:-.8s;transform:rotate(120deg) translate(146%)}.sonner-loading-bar:nth-child(6){animation-delay:-.7s;transform:rotate(150deg) translate(146%)}.sonner-loading-bar:nth-child(7){animation-delay:-.6s;transform:rotate(180deg) translate(146%)}.sonner-loading-bar:nth-child(8){animation-delay:-.5s;transform:rotate(210deg) translate(146%)}.sonner-loading-bar:nth-child(9){animation-delay:-.4s;transform:rotate(240deg) translate(146%)}.sonner-loading-bar:nth-child(10){animation-delay:-.3s;transform:rotate(270deg) translate(146%)}.sonner-loading-bar:nth-child(11){animation-delay:-.2s;transform:rotate(300deg) translate(146%)}.sonner-loading-bar:nth-child(12){animation-delay:-.1s;transform:rotate(330deg) translate(146%)}@keyframes sonner-fade-in{0%{opacity:0;transform:scale(.8)}to{opacity:1;transform:scale(1)}}@keyframes sonner-fade-out{0%{opacity:1;transform:scale(1)}to{opacity:0;transform:scale(.8)}}@keyframes sonner-spin{0%{opacity:1}to{opacity:.15}}@media (prefers-reduced-motion){[data-sonner-toast],[data-sonner-toast]>*,.sonner-loading-bar{transition:none!important;animation:none!important}}.sonner-loader{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);transform-origin:center;transition:opacity .2s,transform .2s}.sonner-loader[data-visible=false]{opacity:0;transform:scale(.8) translate(-50%,-50%)}
</style><script type="application/ld+json" data-blog-post="true">{"@context":"https://schema.org","@type":"BlogPosting","headline":"Self-Managed Elasticsearch - VM and Bare Metal Production Guide","description":"Complete guide to self-managed Elasticsearch on VM and bare metal with multi-node automation, performance tuning, hardware sizing, and operational procedures.","url":"https://thisiskushal31.github.io/blog/self-managed-elasticsearch-vm-bare-metal-production-guide","datePublished":"2025-08-24","author":{"@type":"Person","name":"Kushal Gupta","url":"https://thisiskushal31.github.io"},"publisher":{"@type":"Person","name":"Kushal Gupta"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://thisiskushal31.github.io/blog/self-managed-elasticsearch-vm-bare-metal-production-guide"}}</script></head>

  <body style="font-family: 'Inter', sans-serif;">
    <div id="root"><div class="min-h-screen bg-background"><main><div class="min-h-screen bg-background"><div class="fixed top-0 left-0 right-0 z-50 bg-card/80 backdrop-blur-md border-b border-border shadow-card transition-all duration-300 ease-in-out transform translate-y-0 opacity-100"><div class="max-w-7xl mx-auto px-3 py-2"><div class="flex items-center justify-between"><div class="flex items-center gap-2"><a class="flex items-center gap-2 hover:opacity-80 transition-opacity" href="#/"><div class="w-8 h-8 rounded-full overflow-hidden bg-teal-500 flex items-center justify-center"><img src="/blog/profile.jpeg" alt="Kushal Gupta" class="w-full h-full object-cover"></div><div class="flex flex-col"><span class="font-bold text-sm text-foreground">Kushal Gupta</span><span class="text-xs text-muted-foreground">Tech Blog</span></div></a></div><div class="flex items-center space-x-3"><a href="https://github.com/thisiskushal31" target="_blank" rel="noopener noreferrer" class="p-2 text-gray-600 hover:text-gray-900 bg-gray-50 hover:bg-gray-100 dark:text-gray-300 dark:hover:text-gray-100 dark:bg-gray-800 dark:hover:bg-gray-700 rounded-lg border border-gray-200 hover:border-gray-300 dark:border-gray-700 dark:hover:border-gray-600 transition-all duration-200 hover:scale-110 hover:shadow-md" title="GitHub"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-github w-4 h-4"><path d="M15 22v-4a4.8 4.8 0 0 0-1-3.5c3 0 6-2 6-5.5.08-1.25-.27-2.48-1-3.5.28-1.15.28-2.35 0-3.5 0 0-1 0-3 1.5-2.64-.5-5.36-.5-8 0C6 2 5 2 5 2c-.3 1.15-.3 2.35 0 3.5A5.403 5.403 0 0 0 4 9c0 3.5 3 5.5 6 5.5-.39.49-.68 1.05-.85 1.65-.17.6-.22 1.23-.15 1.85v4"></path><path d="M9 18c-4.51 2-5-2-7-2"></path></svg></a><a href="https://www.linkedin.com/in/thisiskushalgupta/" target="_blank" rel="noopener noreferrer" class="p-2 text-blue-600 hover:text-blue-700 bg-blue-50 hover:bg-blue-100 dark:text-blue-400 dark:hover:text-blue-300 dark:bg-blue-900/20 dark:hover:bg-blue-900/30 rounded-lg border border-blue-200 hover:border-blue-300 dark:border-blue-800 dark:hover:border-blue-700 transition-all duration-200 hover:scale-110 hover:shadow-md" title="LinkedIn"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-linkedin w-4 h-4"><path d="M16 8a6 6 0 0 1 6 6v7h-4v-7a2 2 0 0 0-2-2 2 2 0 0 0-2 2v7h-4v-7a6 6 0 0 1 6-6z"></path><rect width="4" height="12" x="2" y="9"></rect><circle cx="4" cy="4" r="2"></circle></svg></a><a href="https://thisiskushal31.github.io/link/" target="_blank" rel="noopener noreferrer" class="p-2 text-purple-600 hover:text-purple-700 bg-purple-50 hover:bg-purple-100 dark:text-purple-400 dark:hover:text-purple-300 dark:bg-purple-900/20 dark:hover:bg-purple-900/30 rounded-lg border border-purple-200 hover:border-purple-300 dark:border-purple-800 dark:hover:border-purple-700 transition-all duration-200 hover:scale-110 hover:shadow-md" title="My Profile &amp; Links"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-external-link w-4 h-4"><path d="M15 3h6v6"></path><path d="M10 14 21 3"></path><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path></svg></a><a href="#" class="p-2 text-gray-600 hover:text-gray-900 bg-gray-50 hover:bg-gray-100 dark:text-gray-300 dark:hover:text-gray-100 dark:bg-gray-800 dark:hover:bg-gray-700 rounded-lg border border-gray-200 hover:border-gray-300 dark:border-gray-700 dark:hover:border-gray-600 transition-all duration-200 hover:scale-110 hover:shadow-md" title="Copy Link"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy w-4 h-4"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></a><button class="p-2 text-gray-600 hover:text-gray-900 bg-gray-50 hover:bg-gray-100 dark:text-gray-300 dark:hover:text-gray-100 dark:bg-gray-800 dark:hover:bg-gray-700 rounded-lg border border-gray-200 hover:border-gray-300 dark:border-gray-700 dark:hover:border-gray-600 transition-all duration-200 hover:scale-110 hover:shadow-md" title="Switch to dark mode"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-moon w-4 h-4"><path d="M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z"></path></svg></button></div></div></div></div><div class="fixed bottom-6 right-6 z-50 flex flex-col gap-3"><button class="w-12 h-12 bg-teal-600 hover:bg-teal-700 text-white rounded-full shadow-lg hover:shadow-xl transition-all duration-300 hover:scale-110 flex items-center justify-center border border-teal-500" title="Go to Home"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-house w-5 h-5"><path d="M15 21v-8a1 1 0 0 0-1-1h-4a1 1 0 0 0-1 1v8"></path><path d="M3 10a2 2 0 0 1 .709-1.528l7-5.999a2 2 0 0 1 2.582 0l7 5.999A2 2 0 0 1 21 10v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path></svg></button></div><div class="relative w-full h-64 md:h-80 lg:h-96 overflow-hidden -mt-16 pt-16"><img src="/blog/blogImages/elasticsearch-deployment-guide.png" alt="Self-Managed Elasticsearch - VM and Bare Metal Production Guide" class="w-full h-full object-cover"><div class="absolute inset-0 bg-gradient-to-t from-black/20 to-transparent"></div></div><header class="py-12 px-4 hero-gradient "><div class="max-w-4xl mx-auto"><a class="inline-flex items-center text-muted-foreground hover:text-primary transition-colors duration-200 mb-8 group" href="#/blog"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-arrow-left w-4 h-4 mr-2 group-hover:-translate-x-1 transition-transform duration-200"><path d="m12 19-7-7 7-7"></path><path d="M19 12H5"></path></svg>Back to Blog</a><div class="space-y-6"><div class="flex flex-wrap gap-2"><span class="tag"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-tag w-3 h-3 mr-1"><path d="M12.586 2.586A2 2 0 0 0 11.172 2H4a2 2 0 0 0-2 2v7.172a2 2 0 0 0 .586 1.414l8.704 8.704a2.426 2.426 0 0 0 3.42 0l6.58-6.58a2.426 2.426 0 0 0 0-3.42z"></path><circle cx="7.5" cy="7.5" r=".5" fill="currentColor"></circle></svg>Self-Managed</span><span class="tag"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-tag w-3 h-3 mr-1"><path d="M12.586 2.586A2 2 0 0 0 11.172 2H4a2 2 0 0 0-2 2v7.172a2 2 0 0 0 .586 1.414l8.704 8.704a2.426 2.426 0 0 0 3.42 0l6.58-6.58a2.426 2.426 0 0 0 0-3.42z"></path><circle cx="7.5" cy="7.5" r=".5" fill="currentColor"></circle></svg>Infrastructure</span></div><h1 class="text-4xl md:text-5xl font-bold text-foreground leading-tight">Self-Managed Elasticsearch - VM and Bare Metal Production Guide</h1><p class="text-xl text-muted-foreground leading-relaxed">Complete guide to self-managed Elasticsearch on VM and bare metal with multi-node automation, performance tuning, hardware sizing, and operational procedures.</p><div class="flex flex-wrap items-center gap-6 text-muted-foreground"><div class="flex items-center space-x-2"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-calendar w-4 h-4"><path d="M8 2v4"></path><path d="M16 2v4"></path><rect width="18" height="18" x="3" y="4" rx="2"></rect><path d="M3 10h18"></path></svg><span>August 24, 2025</span></div><div class="flex items-center space-x-2"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-clock w-4 h-4"><circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline></svg><span>4 min read</span></div><button class="flex items-center space-x-2 hover:text-primary transition-colors duration-200"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-share2 w-4 h-4"><circle cx="18" cy="5" r="3"></circle><circle cx="6" cy="12" r="3"></circle><circle cx="18" cy="19" r="3"></circle><line x1="8.59" x2="15.42" y1="13.51" y2="17.49"></line><line x1="15.41" x2="8.59" y1="6.51" y2="10.49"></line></svg><span>Share</span></button></div></div></div></header><article class="py-12 px-4"><div class="max-w-4xl mx-auto"><div class="glass-card p-8 md:p-12"><div class="blog-markdown"><div>
        <h1 id="self-managed-elasticsearch-vm-and-bare-metal-production-guide" class="group relative scroll-mt-20 text-3xl font-bold mb-4 mt-6 border-b border-gray-200 dark:border-gray-700 pb-2">
          <a class="anchor absolute -ml-10 flex items-center opacity-0 group-hover:opacity-100 transition-opacity duration-200" aria-label="Link to this section" href="#self-managed-elasticsearch-vm-and-bare-metal-production-guide">
            <svg class="octicon octicon-link" viewBox="0 0 16 16" aria-hidden="true">
              <path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path>
            </svg>
          </a>
          <span>Self-Managed Elasticsearch: VM and Bare Metal Production Guide</span>
        <a href="#/blog/self-managed-elasticsearch-vm-bare-metal-production-guide#self-managed-elasticsearch-vm-and-bare-metal-production-guide" class="header-link" style="opacity: 0; margin-left: 8px; text-decoration: none; color: rgb(107, 114, 128); transition: opacity 0.2s; cursor: pointer;">#</a></h1>
      
<p><em>Building production-grade self-managed clusters with advanced optimization techniques</em></p>
<hr>

        <h2 id="the-case-for-maximum-control" class="group relative scroll-mt-20 text-2xl font-semibold mb-4 mt-6 border-b border-gray-200 dark:border-gray-700 pb-2">
          <a class="anchor absolute -ml-10 flex items-center opacity-0 group-hover:opacity-100 transition-opacity duration-200" aria-label="Link to this section" href="#the-case-for-maximum-control">
            <svg class="octicon octicon-link" viewBox="0 0 16 16" aria-hidden="true">
              <path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path>
            </svg>
          </a>
          <span>The Case for Maximum Control</span>
        <a href="#/blog/self-managed-elasticsearch-vm-bare-metal-production-guide#the-case-for-maximum-control" class="header-link" style="opacity: 0; margin-left: 8px; text-decoration: none; color: rgb(107, 114, 128); transition: opacity 0.2s; cursor: pointer;">#</a></h2>
      
<p>Self-managed Elasticsearch deployments represent the pinnacle of infrastructure control, offering unmatched performance optimization, cost efficiency at scale, and complete customization freedom. This comprehensive guide takes you from basic cluster setup to advanced production optimization techniques that can deliver 40-60% cost savings and superior performance compared to managed solutions.</p>

        <h2 id="tl-dr" class="group relative scroll-mt-20 text-2xl font-semibold mb-4 mt-6 border-b border-gray-200 dark:border-gray-700 pb-2">
          <a class="anchor absolute -ml-10 flex items-center opacity-0 group-hover:opacity-100 transition-opacity duration-200" aria-label="Link to this section" href="#tldr">
            <svg class="octicon octicon-link" viewBox="0 0 16 16" aria-hidden="true">
              <path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path>
            </svg>
          </a>
          <span>TL;DR</span>
        <a href="#/blog/self-managed-elasticsearch-vm-bare-metal-production-guide#tl-dr" class="header-link" style="opacity: 0; margin-left: 8px; text-decoration: none; color: rgb(107, 114, 128); transition: opacity 0.2s; cursor: pointer;">#</a></h2>
      
<ul>
<li><strong>What:</strong> Complete guide to self-managed Elasticsearch on VMs and bare metal with production optimizations</li>
<li><strong>When to use:</strong> When you need maximum control, have dedicated ops team, or want to minimize costs at scale</li>
<li><strong>Reading time:</strong> 3 minutes</li>
<li><strong>Implementation time:</strong> 1-2 days for basic setup, 1-2 weeks for production optimization</li>
<li><strong>Key takeaway:</strong> 40-60% cost savings vs managed services, but requires significant operational expertise and 24/7 monitoring</li>
<li><strong>Skip if:</strong> You're a small team, need quick deployment, or prefer managed services for reliability</li>
</ul>
<p><strong>Why Choose Self-Managed:</strong></p>
<ul>
<li>Complete hardware and software stack control</li>
<li>Maximum performance through custom optimization</li>
<li>Significant cost savings at scale (typically 40-60% vs managed)</li>
<li>Full security and compliance customization</li>
<li>No vendor lock-in or feature limitations</li>
</ul>
<p><strong>What You'll Master:</strong></p>
<ul>
<li>Production-ready multi-node cluster architecture</li>
<li>Advanced performance tuning for VMs and bare metal</li>
<li>Automated deployment and configuration management</li>
<li>Hardware sizing and capacity planning</li>
<li>Operational procedures and monitoring</li>
</ul>
<hr>

        <h2 id="architecture-foundation" class="group relative scroll-mt-20 text-2xl font-semibold mb-4 mt-6 border-b border-gray-200 dark:border-gray-700 pb-2">
          <a class="anchor absolute -ml-10 flex items-center opacity-0 group-hover:opacity-100 transition-opacity duration-200" aria-label="Link to this section" href="#architecture-foundation">
            <svg class="octicon octicon-link" viewBox="0 0 16 16" aria-hidden="true">
              <path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path>
            </svg>
          </a>
          <span>Architecture Foundation</span>
        <a href="#/blog/self-managed-elasticsearch-vm-bare-metal-production-guide#architecture-foundation" class="header-link" style="opacity: 0; margin-left: 8px; text-decoration: none; color: rgb(107, 114, 128); transition: opacity 0.2s; cursor: pointer;">#</a></h2>
      
<blockquote class="border-l-4 border-gray-300 dark:border-gray-600 pl-4 my-4 text-gray-600 dark:text-gray-400">
<p> <strong>Understanding Elasticsearch architecture?</strong> Check out my <a href="https://thisiskushal31.github.io/dochub/#/databases/nosql/elasticsearch/README.md#overview--getting-started" target="_blank" rel="noopener noreferrer">Elasticsearch Overview &amp; Getting Started Deep Dive</a> for detailed component explanations and cluster setup.</p>
</blockquote>

        <h3 id="production-cluster-design-principles" class="group relative scroll-mt-20 text-xl font-semibold mb-3 mt-5">
          <a class="anchor absolute -ml-10 flex items-center opacity-0 group-hover:opacity-100 transition-opacity duration-200" aria-label="Link to this section" href="#production-cluster-design-principles">
            <svg class="octicon octicon-link" viewBox="0 0 16 16" aria-hidden="true">
              <path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path>
            </svg>
          </a>
          <span>Production Cluster Design Principles</span>
        <a href="#/blog/self-managed-elasticsearch-vm-bare-metal-production-guide#production-cluster-design-principles" class="header-link" style="opacity: 0; margin-left: 8px; text-decoration: none; color: rgb(107, 114, 128); transition: opacity 0.2s; cursor: pointer;">#</a></h3>
      
<div class="highlight highlight-yaml notranslate" style="background-color: transparent !important; border: none !important; border-radius: 0px !important; padding: 0px !important; margin: 0px !important;">
<pre class="notranslate language-yaml" tabindex="0" style="border-radius: 0.75rem !important; padding: 16px !important; margin: 16px 0px !important; overflow-x: auto !important; font-size: 14px !important; line-height: 1.5 !important; white-space: pre-wrap !important; overflow-wrap: normal !important; text-wrap-style: initial !important; word-break: normal !important;"><code class="language-yaml" style="background: transparent !important; border: none !important; border-radius: 0px !important; font-family: ui-monospace, SFMono-Regular, &quot;SF Mono&quot;, Consolas, &quot;Liberation Mono&quot;, Menlo, monospace !important; font-size: 15px !important; line-height: 1.6 !important; padding: 0px !important; font-weight: 500 !important; text-rendering: geometricprecision !important; -webkit-font-smoothing: subpixel-antialiased !important; letter-spacing: 0.025em !important; white-space: pre-wrap !important; overflow-wrap: normal !important; text-wrap-style: initial !important; word-break: normal !important;"><span class="token comment"># Recommended production architecture</span>
<span class="token key atrule">production_architecture</span><span class="token punctuation">:</span>
  <span class="token key atrule">cluster_size</span><span class="token punctuation">:</span> <span class="token string">"minimum 3 nodes, optimal 6-12 nodes"</span>
  <span class="token key atrule">node_roles</span><span class="token punctuation">:</span>
    <span class="token key atrule">master_eligible</span><span class="token punctuation">:</span> <span class="token number">3</span>  <span class="token comment"># Odd number for quorum</span>
    <span class="token key atrule">data_hot</span><span class="token punctuation">:</span> 3<span class="token punctuation">-</span><span class="token number">6</span>      <span class="token comment"># Based on ingestion volume</span>
    <span class="token key atrule">data_warm</span><span class="token punctuation">:</span> 2<span class="token punctuation">-</span><span class="token number">4</span>     <span class="token comment"># For older data</span>
    <span class="token key atrule">data_cold</span><span class="token punctuation">:</span> 1<span class="token punctuation">-</span><span class="token number">2</span>     <span class="token comment"># For archived data</span>
    <span class="token key atrule">coordinating</span><span class="token punctuation">:</span> <span class="token number">2</span>    <span class="token comment"># For query distribution</span>
    <span class="token key atrule">ingest</span><span class="token punctuation">:</span> <span class="token number">2</span>          <span class="token comment"># For data processing</span>
  
  <span class="token key atrule">availability_zones</span><span class="token punctuation">:</span> <span class="token number">3</span>  <span class="token comment"># For fault tolerance</span>
  <span class="token key atrule">network_tiers</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token string">"Management network (SSH, monitoring)"</span>
    <span class="token punctuation">-</span> <span class="token string">"Elasticsearch cluster communication"</span> 
    <span class="token punctuation">-</span> <span class="token string">"Client access network"</span>
</code></pre>
</div>

        <h3 id="hardware-specifications-by-node-type" class="group relative scroll-mt-20 text-xl font-semibold mb-3 mt-5">
          <a class="anchor absolute -ml-10 flex items-center opacity-0 group-hover:opacity-100 transition-opacity duration-200" aria-label="Link to this section" href="#hardware-specifications-by-node-type">
            <svg class="octicon octicon-link" viewBox="0 0 16 16" aria-hidden="true">
              <path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path>
            </svg>
          </a>
          <span>Hardware Specifications by Node Type</span>
        <a href="#/blog/self-managed-elasticsearch-vm-bare-metal-production-guide#hardware-specifications-by-node-type" class="header-link" style="opacity: 0; margin-left: 8px; text-decoration: none; color: rgb(107, 114, 128); transition: opacity 0.2s; cursor: pointer;">#</a></h3>
      
<div class="highlight highlight-yaml notranslate" style="background-color: transparent !important; border: none !important; border-radius: 0px !important; padding: 0px !important; margin: 0px !important;">
<pre class="notranslate language-yaml" tabindex="0" style="border-radius: 0.75rem !important; padding: 16px !important; margin: 16px 0px !important; overflow-x: auto !important; font-size: 14px !important; line-height: 1.5 !important; white-space: pre-wrap !important; overflow-wrap: normal !important; text-wrap-style: initial !important; word-break: normal !important;"><code class="language-yaml" style="background: transparent !important; border: none !important; border-radius: 0px !important; font-family: ui-monospace, SFMono-Regular, &quot;SF Mono&quot;, Consolas, &quot;Liberation Mono&quot;, Menlo, monospace !important; font-size: 15px !important; line-height: 1.6 !important; padding: 0px !important; font-weight: 500 !important; text-rendering: geometricprecision !important; -webkit-font-smoothing: subpixel-antialiased !important; letter-spacing: 0.025em !important; white-space: pre-wrap !important; overflow-wrap: normal !important; text-wrap-style: initial !important; word-break: normal !important;"><span class="token comment"># Optimized hardware specifications</span>
<span class="token key atrule">hardware_specs</span><span class="token punctuation">:</span>
  <span class="token key atrule">master_nodes</span><span class="token punctuation">:</span>
    <span class="token key atrule">purpose</span><span class="token punctuation">:</span> <span class="token string">"Cluster coordination and metadata management"</span>
    <span class="token key atrule">cpu</span><span class="token punctuation">:</span> <span class="token string">"4-8 cores, high frequency"</span>
    <span class="token key atrule">memory</span><span class="token punctuation">:</span> <span class="token string">"8-16GB"</span>
    <span class="token key atrule">storage</span><span class="token punctuation">:</span> <span class="token string">"100-200GB SSD (OS + logs)"</span>
    <span class="token key atrule">network</span><span class="token punctuation">:</span> <span class="token string">"1Gbps minimum"</span>
    
  <span class="token key atrule">data_hot_nodes</span><span class="token punctuation">:</span>
    <span class="token key atrule">purpose</span><span class="token punctuation">:</span> <span class="token string">"Active indexing and recent data queries"</span>
    <span class="token key atrule">cpu</span><span class="token punctuation">:</span> <span class="token string">"16-32 cores"</span>
    <span class="token key atrule">memory</span><span class="token punctuation">:</span> <span class="token string">"64-128GB"</span>
    <span class="token key atrule">storage</span><span class="token punctuation">:</span> <span class="token string">"2-8TB NVMe SSD"</span>
    <span class="token key atrule">network</span><span class="token punctuation">:</span> <span class="token string">"10Gbps recommended"</span>
    
  <span class="token key atrule">data_warm_nodes</span><span class="token punctuation">:</span>
    <span class="token key atrule">purpose</span><span class="token punctuation">:</span> <span class="token string">"Older data with moderate query frequency"</span>
    <span class="token key atrule">cpu</span><span class="token punctuation">:</span> <span class="token string">"8-16 cores"</span>
    <span class="token key atrule">memory</span><span class="token punctuation">:</span> <span class="token string">"32-64GB"</span>
    <span class="token key atrule">storage</span><span class="token punctuation">:</span> <span class="token string">"4-16TB SATA SSD"</span>
    <span class="token key atrule">network</span><span class="token punctuation">:</span> <span class="token string">"1-10Gbps"</span>
    
  <span class="token key atrule">data_cold_nodes</span><span class="token punctuation">:</span>
    <span class="token key atrule">purpose</span><span class="token punctuation">:</span> <span class="token string">"Archived data with infrequent access"</span>
    <span class="token key atrule">cpu</span><span class="token punctuation">:</span> <span class="token string">"4-8 cores"</span>
    <span class="token key atrule">memory</span><span class="token punctuation">:</span> <span class="token string">"16-32GB"</span>
    <span class="token key atrule">storage</span><span class="token punctuation">:</span> <span class="token string">"8-32TB HDD"</span>
    <span class="token key atrule">network</span><span class="token punctuation">:</span> <span class="token string">"1Gbps"</span>
    
  <span class="token key atrule">coordinating_nodes</span><span class="token punctuation">:</span>
    <span class="token key atrule">purpose</span><span class="token punctuation">:</span> <span class="token string">"Query routing and result aggregation"</span>
    <span class="token key atrule">cpu</span><span class="token punctuation">:</span> <span class="token string">"8-16 cores"</span>
    <span class="token key atrule">memory</span><span class="token punctuation">:</span> <span class="token string">"16-32GB"</span>
    <span class="token key atrule">storage</span><span class="token punctuation">:</span> <span class="token string">"100GB SSD"</span>
    <span class="token key atrule">network</span><span class="token punctuation">:</span> <span class="token string">"10Gbps"</span>
</code></pre>
</div>
<hr>

        <h2 id="virtual-machine-deployment" class="group relative scroll-mt-20 text-2xl font-semibold mb-4 mt-6 border-b border-gray-200 dark:border-gray-700 pb-2">
          <a class="anchor absolute -ml-10 flex items-center opacity-0 group-hover:opacity-100 transition-opacity duration-200" aria-label="Link to this section" href="#virtual-machine-deployment">
            <svg class="octicon octicon-link" viewBox="0 0 16 16" aria-hidden="true">
              <path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path>
            </svg>
          </a>
          <span>Virtual Machine Deployment</span>
        <a href="#/blog/self-managed-elasticsearch-vm-bare-metal-production-guide#virtual-machine-deployment" class="header-link" style="opacity: 0; margin-left: 8px; text-decoration: none; color: rgb(107, 114, 128); transition: opacity 0.2s; cursor: pointer;">#</a></h2>
      
<blockquote class="border-l-4 border-gray-300 dark:border-gray-600 pl-4 my-4 text-gray-600 dark:text-gray-400">
<p> <strong>Need detailed configuration guidance?</strong> See my <a href="https://thisiskushal31.github.io/dochub/#/databases/nosql/elasticsearch/README.md#overview--getting-started" target="_blank" rel="noopener noreferrer">Elasticsearch Overview &amp; Getting Started Deep Dive</a> for comprehensive setup instructions and cluster configuration.</p>
</blockquote>

        <h3 id="vm-infrastructure-setup" class="group relative scroll-mt-20 text-xl font-semibold mb-3 mt-5">
          <a class="anchor absolute -ml-10 flex items-center opacity-0 group-hover:opacity-100 transition-opacity duration-200" aria-label="Link to this section" href="#vm-infrastructure-setup">
            <svg class="octicon octicon-link" viewBox="0 0 16 16" aria-hidden="true">
              <path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path>
            </svg>
          </a>
          <span>VM Infrastructure Setup</span>
        <a href="#/blog/self-managed-elasticsearch-vm-bare-metal-production-guide#vm-infrastructure-setup" class="header-link" style="opacity: 0; margin-left: 8px; text-decoration: none; color: rgb(107, 114, 128); transition: opacity 0.2s; cursor: pointer;">#</a></h3>
      
<div class="highlight highlight-bash notranslate" style="background-color: transparent !important; border: none !important; border-radius: 0px !important; padding: 0px !important; margin: 0px !important;">
<pre class="notranslate language-bash" tabindex="0" style="border-radius: 0.75rem !important; padding: 16px !important; margin: 16px 0px !important; overflow-x: auto !important; font-size: 14px !important; line-height: 1.5 !important; white-space: pre-wrap !important; overflow-wrap: normal !important; text-wrap-style: initial !important; word-break: normal !important;"><code class="language-bash" style="background: transparent !important; border: none !important; border-radius: 0px !important; font-family: ui-monospace, SFMono-Regular, &quot;SF Mono&quot;, Consolas, &quot;Liberation Mono&quot;, Menlo, monospace !important; font-size: 15px !important; line-height: 1.6 !important; padding: 0px !important; font-weight: 500 !important; text-rendering: geometricprecision !important; -webkit-font-smoothing: subpixel-antialiased !important; letter-spacing: 0.025em !important; white-space: pre-wrap !important; overflow-wrap: normal !important; text-wrap-style: initial !important; word-break: normal !important;"><span class="token shebang important">#!/bin/bash</span>
<span class="token comment"># VM provisioning script for production Elasticsearch cluster</span>

<span class="token comment"># Configuration variables</span>
<span class="token assign-left variable">CLUSTER_NAME</span><span class="token operator">=</span><span class="token string">"production-es"</span>
<span class="token assign-left variable">ES_VERSION</span><span class="token operator">=</span><span class="token string">"9.1.5"</span>
<span class="token assign-left variable">NODES</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token string">"es-master-01"</span> <span class="token string">"es-master-02"</span> <span class="token string">"es-master-03"</span> <span class="token string">"es-data-01"</span> <span class="token string">"es-data-02"</span> <span class="token string">"es-data-03"</span><span class="token punctuation">)</span>
<span class="token assign-left variable">VM_SIZES</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token string">"Standard_D4s_v3"</span> <span class="token string">"Standard_D4s_v3"</span> <span class="token string">"Standard_D4s_v3"</span> <span class="token string">"Standard_D16s_v3"</span> <span class="token string">"Standard_D16s_v3"</span> <span class="token string">"Standard_D16s_v3"</span><span class="token punctuation">)</span>

<span class="token comment"># Create resource group and network</span>
az group create <span class="token parameter variable">--name</span> <span class="token variable">${CLUSTER_NAME}</span>-rg <span class="token parameter variable">--location</span> eastus

az network vnet create <span class="token punctuation">\</span>
  --resource-group <span class="token variable">${CLUSTER_NAME}</span>-rg <span class="token punctuation">\</span>
  <span class="token parameter variable">--name</span> <span class="token variable">${CLUSTER_NAME}</span>-vnet <span class="token punctuation">\</span>
  --address-prefix <span class="token number">10.0</span>.0.0/16 <span class="token punctuation">\</span>
  --subnet-name es-subnet <span class="token punctuation">\</span>
  --subnet-prefix <span class="token number">10.0</span>.1.0/24

<span class="token comment"># Create availability set</span>
az vm availability-set create <span class="token punctuation">\</span>
  --resource-group <span class="token variable">${CLUSTER_NAME}</span>-rg <span class="token punctuation">\</span>
  <span class="token parameter variable">--name</span> <span class="token variable">${CLUSTER_NAME}</span>-avset <span class="token punctuation">\</span>
  --platform-fault-domain-count <span class="token number">3</span> <span class="token punctuation">\</span>
  --platform-update-domain-count <span class="token number">5</span>

<span class="token comment"># Provision VMs</span>
<span class="token keyword">for</span> <span class="token for-or-select variable">i</span> <span class="token keyword">in</span> <span class="token string">"<span class="token variable">${<span class="token operator">!</span>NODES<span class="token punctuation">[</span>@<span class="token punctuation">]</span>}</span>"</span><span class="token punctuation">;</span> <span class="token keyword">do</span>
  <span class="token assign-left variable">NODE_NAME</span><span class="token operator">=</span><span class="token variable">${NODES<span class="token punctuation">[</span>$i<span class="token punctuation">]</span>}</span>
  <span class="token assign-left variable">VM_SIZE</span><span class="token operator">=</span><span class="token variable">${VM_SIZES<span class="token punctuation">[</span>$i<span class="token punctuation">]</span>}</span>
  
  az vm create <span class="token punctuation">\</span>
    --resource-group <span class="token variable">${CLUSTER_NAME}</span>-rg <span class="token punctuation">\</span>
    <span class="token parameter variable">--name</span> <span class="token variable">$NODE_NAME</span> <span class="token punctuation">\</span>
    --availability-set <span class="token variable">${CLUSTER_NAME}</span>-avset <span class="token punctuation">\</span>
    <span class="token parameter variable">--image</span> Ubuntu2204 <span class="token punctuation">\</span>
    <span class="token parameter variable">--size</span> <span class="token variable">$VM_SIZE</span> <span class="token punctuation">\</span>
    --admin-username esadmin <span class="token punctuation">\</span>
    --ssh-key-values ~/.ssh/id_rsa.pub <span class="token punctuation">\</span>
    --vnet-name <span class="token variable">${CLUSTER_NAME}</span>-vnet <span class="token punctuation">\</span>
    <span class="token parameter variable">--subnet</span> es-subnet <span class="token punctuation">\</span>
    --private-ip-address <span class="token number">10.0</span>.1.<span class="token variable"><span class="token variable">$((</span><span class="token number">10</span> <span class="token operator">+</span> $i<span class="token variable">))</span></span> <span class="token punctuation">\</span>
    --storage-sku Premium_LRS <span class="token punctuation">\</span>
    --os-disk-size-gb <span class="token number">100</span> <span class="token punctuation">\</span>
    --data-disk-sizes-gb <span class="token number">1024</span>
<span class="token keyword">done</span>

<span class="token comment"># Configure load balancer for client access</span>
az network lb create <span class="token punctuation">\</span>
  --resource-group <span class="token variable">${CLUSTER_NAME}</span>-rg <span class="token punctuation">\</span>
  <span class="token parameter variable">--name</span> <span class="token variable">${CLUSTER_NAME}</span>-lb <span class="token punctuation">\</span>
  <span class="token parameter variable">--sku</span> Standard <span class="token punctuation">\</span>
  --vnet-name <span class="token variable">${CLUSTER_NAME}</span>-vnet <span class="token punctuation">\</span>
  <span class="token parameter variable">--subnet</span> es-subnet <span class="token punctuation">\</span>
  --backend-pool-name es-backend-pool <span class="token punctuation">\</span>
  --frontend-ip-name es-frontend-ip
</code></pre>
</div>

        <h3 id="vm-operating-system-optimization" class="group relative scroll-mt-20 text-xl font-semibold mb-3 mt-5">
          <a class="anchor absolute -ml-10 flex items-center opacity-0 group-hover:opacity-100 transition-opacity duration-200" aria-label="Link to this section" href="#vm-operating-system-optimization">
            <svg class="octicon octicon-link" viewBox="0 0 16 16" aria-hidden="true">
              <path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path>
            </svg>
          </a>
          <span>VM Operating System Optimization</span>
        <a href="#/blog/self-managed-elasticsearch-vm-bare-metal-production-guide#vm-operating-system-optimization" class="header-link" style="opacity: 0; margin-left: 8px; text-decoration: none; color: rgb(107, 114, 128); transition: opacity 0.2s; cursor: pointer;">#</a></h3>
      
<div class="highlight highlight-bash notranslate" style="background-color: transparent !important; border: none !important; border-radius: 0px !important; padding: 0px !important; margin: 0px !important;">
<pre class="notranslate language-bash" tabindex="0" style="border-radius: 0.75rem !important; padding: 16px !important; margin: 16px 0px !important; overflow-x: auto !important; font-size: 14px !important; line-height: 1.5 !important; white-space: pre-wrap !important; overflow-wrap: normal !important; text-wrap-style: initial !important; word-break: normal !important;"><code class="language-bash" style="background: transparent !important; border: none !important; border-radius: 0px !important; font-family: ui-monospace, SFMono-Regular, &quot;SF Mono&quot;, Consolas, &quot;Liberation Mono&quot;, Menlo, monospace !important; font-size: 15px !important; line-height: 1.6 !important; padding: 0px !important; font-weight: 500 !important; text-rendering: geometricprecision !important; -webkit-font-smoothing: subpixel-antialiased !important; letter-spacing: 0.025em !important; white-space: pre-wrap !important; overflow-wrap: normal !important; text-wrap-style: initial !important; word-break: normal !important;"><span class="token shebang important">#!/bin/bash</span>
<span class="token comment"># VM optimization script for Elasticsearch</span>

<span class="token comment"># System limits configuration</span>
<span class="token function">cat</span> <span class="token operator">&gt;&gt;</span> /etc/security/limits.conf <span class="token operator">&lt;&lt;</span> <span class="token string">EOF
elasticsearch soft memlock unlimited
elasticsearch hard memlock unlimited
elasticsearch soft nofile 65536
elasticsearch hard nofile 65536
elasticsearch soft nproc 4096
elasticsearch hard nproc 4096
EOF</span>

<span class="token comment"># Kernel parameters for Elasticsearch</span>
<span class="token function">cat</span> <span class="token operator">&gt;&gt;</span> /etc/sysctl.conf <span class="token operator">&lt;&lt;</span> <span class="token string">EOF
# Elasticsearch optimizations
vm.max_map_count=262144
vm.swappiness=1
fs.file-max=65536
net.core.somaxconn=1024
net.core.netdev_max_backlog=5000
net.core.rmem_default=262144
net.core.rmem_max=16777216
net.core.wmem_default=262144
net.core.wmem_max=16777216
net.ipv4.tcp_keepalive_time=120
net.ipv4.tcp_keepalive_intvl=30
net.ipv4.tcp_keepalive_probes=8
net.ipv4.tcp_rmem=4096 87380 16777216
net.ipv4.tcp_wmem=4096 65536 16777216
EOF</span>

<span class="token function">sysctl</span> <span class="token parameter variable">-p</span>

<span class="token comment"># Disable swap</span>
swapoff <span class="token parameter variable">-a</span>
<span class="token function">sed</span> <span class="token parameter variable">-i</span> <span class="token string">'/ swap / s/^\(.*\)$/#\1/g'</span> /etc/fstab

<span class="token comment"># Configure disk scheduler for SSDs</span>
<span class="token builtin class-name">echo</span> <span class="token string">'ACTION=="add|change", KERNEL=="nvme[0-9]*", ATTR{queue/scheduler}="none"'</span> <span class="token operator">&gt;</span> /etc/udev/rules.d/60-elasticsearch-ssd.rules
<span class="token builtin class-name">echo</span> <span class="token string">'ACTION=="add|change", KERNEL=="sd[a-z]", ATTR{queue/rotational}=="0", ATTR{queue/scheduler}="none"'</span> <span class="token operator">&gt;&gt;</span> /etc/udev/rules.d/60-elasticsearch-ssd.rules

<span class="token comment"># Install required packages</span>
<span class="token function">apt-get</span> update
<span class="token function">apt-get</span> <span class="token function">install</span> <span class="token parameter variable">-y</span> openjdk-17-jdk <span class="token function">curl</span> <span class="token function">wget</span> gnupg2

<span class="token comment"># Set JAVA_HOME</span>
<span class="token builtin class-name">echo</span> <span class="token string">'export JAVA_HOME=/usr/lib/jvm/java-17-openjdk-amd64'</span> <span class="token operator">&gt;&gt;</span> /etc/environment
<span class="token builtin class-name">source</span> /etc/environment
</code></pre>
</div>

        <h3 id="elasticsearch-installation-and-configuration" class="group relative scroll-mt-20 text-xl font-semibold mb-3 mt-5">
          <a class="anchor absolute -ml-10 flex items-center opacity-0 group-hover:opacity-100 transition-opacity duration-200" aria-label="Link to this section" href="#elasticsearch-installation-and-configuration">
            <svg class="octicon octicon-link" viewBox="0 0 16 16" aria-hidden="true">
              <path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path>
            </svg>
          </a>
          <span>Elasticsearch Installation and Configuration</span>
        <a href="#/blog/self-managed-elasticsearch-vm-bare-metal-production-guide#elasticsearch-installation-and-configuration" class="header-link" style="opacity: 0; margin-left: 8px; text-decoration: none; color: rgb(107, 114, 128); transition: opacity 0.2s; cursor: pointer;">#</a></h3>
      
<div class="highlight highlight-bash notranslate" style="background-color: transparent !important; border: none !important; border-radius: 0px !important; padding: 0px !important; margin: 0px !important;">
<pre class="notranslate language-bash" tabindex="0" style="border-radius: 0.75rem !important; padding: 16px !important; margin: 16px 0px !important; overflow-x: auto !important; font-size: 14px !important; line-height: 1.5 !important; white-space: pre-wrap !important; overflow-wrap: normal !important; text-wrap-style: initial !important; word-break: normal !important;"><code class="language-bash" style="background: transparent !important; border: none !important; border-radius: 0px !important; font-family: ui-monospace, SFMono-Regular, &quot;SF Mono&quot;, Consolas, &quot;Liberation Mono&quot;, Menlo, monospace !important; font-size: 15px !important; line-height: 1.6 !important; padding: 0px !important; font-weight: 500 !important; text-rendering: geometricprecision !important; -webkit-font-smoothing: subpixel-antialiased !important; letter-spacing: 0.025em !important; white-space: pre-wrap !important; overflow-wrap: normal !important; text-wrap-style: initial !important; word-break: normal !important;"><span class="token shebang important">#!/bin/bash</span>
<span class="token comment"># Elasticsearch installation script</span>

<span class="token comment"># Add Elastic repository</span>
<span class="token function">wget</span> <span class="token parameter variable">-qO</span> - https://artifacts.elastic.co/GPG-KEY-elasticsearch <span class="token operator">|</span> apt-key <span class="token function">add</span> -
<span class="token builtin class-name">echo</span> <span class="token string">"deb https://artifacts.elastic.co/packages/9.x/apt stable main"</span> <span class="token operator">&gt;</span> /etc/apt/sources.list.d/elastic-9.x.list

<span class="token comment"># Install Elasticsearch</span>
<span class="token function">apt-get</span> update
<span class="token function">apt-get</span> <span class="token function">install</span> <span class="token parameter variable">-y</span> <span class="token assign-left variable">elasticsearch</span><span class="token operator">=</span><span class="token number">9.1</span>.5

<span class="token comment"># Create data and logs directories</span>
<span class="token function">mkdir</span> <span class="token parameter variable">-p</span> /var/lib/elasticsearch/data
<span class="token function">mkdir</span> <span class="token parameter variable">-p</span> /var/log/elasticsearch
<span class="token function">chown</span> <span class="token parameter variable">-R</span> elasticsearch:elasticsearch /var/lib/elasticsearch
<span class="token function">chown</span> <span class="token parameter variable">-R</span> elasticsearch:elasticsearch /var/log/elasticsearch

<span class="token comment"># Configure Elasticsearch</span>
<span class="token function">cat</span> <span class="token operator">&gt;</span> /etc/elasticsearch/elasticsearch.yml <span class="token operator">&lt;&lt;</span> <span class="token string">'EOF'
# Cluster configuration
cluster.name: production-cluster
node.name: ${HOSTNAME}

# Network configuration
network.host: 0.0.0.0
http.port: 9200
transport.port: 9300

# Discovery settings
discovery.seed_hosts: 
  - "10.0.1.10:9300"
  - "10.0.1.11:9300"
  - "10.0.1.12:9300"
cluster.initial_cluster_manager_nodes:
  - "es-master-01"
  - "es-master-02"
  - "es-master-03"

# Path configuration
path.data: /var/lib/elasticsearch/data
path.logs: /var/log/elasticsearch

# Memory configuration
bootstrap.memory_lock: true

# Performance settings
indices.memory.index_buffer_size: 20%
indices.memory.min_index_buffer_size: 96mb
indices.queries.cache.size: 20%
indices.fielddata.cache.size: 30%

# Cluster settings
cluster.routing.allocation.disk.watermark.low: 85%
cluster.routing.allocation.disk.watermark.high: 90%
cluster.routing.allocation.disk.watermark.flood_stage: 95%
cluster.routing.allocation.awareness.attributes: rack_id
cluster.max_shards_per_node: 2000

# Thread pool configuration
thread_pool.write.queue_size: 1000
thread_pool.search.queue_size: 10000

# Security configuration
xpack.security.enabled: true
xpack.security.transport.ssl.enabled: true
xpack.security.transport.ssl.verification_mode: certificate
xpack.security.http.ssl.enabled: true

# Monitoring
xpack.monitoring.enabled: true
xpack.monitoring.collection.enabled: true
EOF</span>

<span class="token comment"># Configure JVM options</span>
<span class="token function">cat</span> <span class="token operator">&gt;</span> /etc/elasticsearch/jvm.options.d/heap.options <span class="token operator">&lt;&lt;</span> <span class="token string">EOF
# Set heap size (50% of available RAM, max 32GB)
-Xms32g
-Xmx32g

# G1GC configuration for large heaps
-XX:+UseG1GC
-XX:G1HeapRegionSize=32m
-XX:+UnlockExperimentalVMOptions
-XX:+UseTransparentHugePages
-XX:+AlwaysPreTouch
-XX:+DisableExplicitGC

# GC logging
-Xlog:gc*,gc+age=trace,safepoint:gc.log:time,level,tags
-XX:+UseGCLogFileRotation
-XX:NumberOfGCLogFiles=32
-XX:GCLogFileSize=128m
EOF</span>

<span class="token comment"># Set node-specific configuration based on hostname</span>
<span class="token keyword">case</span> <span class="token variable">${<span class="token environment constant">HOSTNAME</span>}</span> <span class="token keyword">in</span>
  es-master-*<span class="token punctuation">)</span>
    <span class="token builtin class-name">echo</span> <span class="token string">"node.roles: [cluster_manager]"</span> <span class="token operator">&gt;&gt;</span> /etc/elasticsearch/elasticsearch.yml
    <span class="token builtin class-name">echo</span> <span class="token string">"node.attr.rack_id: master"</span> <span class="token operator">&gt;&gt;</span> /etc/elasticsearch/elasticsearch.yml
    <span class="token punctuation">;</span><span class="token punctuation">;</span>
  es-data-*<span class="token punctuation">)</span>
    <span class="token builtin class-name">echo</span> <span class="token string">"node.roles: [data_hot, data_content, ingest]"</span> <span class="token operator">&gt;&gt;</span> /etc/elasticsearch/elasticsearch.yml
    <span class="token builtin class-name">echo</span> <span class="token string">"node.attr.rack_id: data_hot"</span> <span class="token operator">&gt;&gt;</span> /etc/elasticsearch/elasticsearch.yml
    <span class="token punctuation">;</span><span class="token punctuation">;</span>
  es-warm-*<span class="token punctuation">)</span>
    <span class="token builtin class-name">echo</span> <span class="token string">"node.roles: [data_warm]"</span> <span class="token operator">&gt;&gt;</span> /etc/elasticsearch/elasticsearch.yml
    <span class="token builtin class-name">echo</span> <span class="token string">"node.attr.rack_id: data_warm"</span> <span class="token operator">&gt;&gt;</span> /etc/elasticsearch/elasticsearch.yml
    <span class="token punctuation">;</span><span class="token punctuation">;</span>
<span class="token keyword">esac</span>

<span class="token comment"># Enable and start Elasticsearch</span>
systemctl daemon-reload
systemctl <span class="token builtin class-name">enable</span> elasticsearch
systemctl start elasticsearch
</code></pre>
</div>
<hr>

        <h2 id="bare-metal-deployment" class="group relative scroll-mt-20 text-2xl font-semibold mb-4 mt-6 border-b border-gray-200 dark:border-gray-700 pb-2">
          <a class="anchor absolute -ml-10 flex items-center opacity-0 group-hover:opacity-100 transition-opacity duration-200" aria-label="Link to this section" href="#bare-metal-deployment">
            <svg class="octicon octicon-link" viewBox="0 0 16 16" aria-hidden="true">
              <path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path>
            </svg>
          </a>
          <span>Bare Metal Deployment</span>
        <a href="#/blog/self-managed-elasticsearch-vm-bare-metal-production-guide#bare-metal-deployment" class="header-link" style="opacity: 0; margin-left: 8px; text-decoration: none; color: rgb(107, 114, 128); transition: opacity 0.2s; cursor: pointer;">#</a></h2>
      

        <h3 id="hardware-procurement-and-setup" class="group relative scroll-mt-20 text-xl font-semibold mb-3 mt-5">
          <a class="anchor absolute -ml-10 flex items-center opacity-0 group-hover:opacity-100 transition-opacity duration-200" aria-label="Link to this section" href="#hardware-procurement-and-setup">
            <svg class="octicon octicon-link" viewBox="0 0 16 16" aria-hidden="true">
              <path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path>
            </svg>
          </a>
          <span>Hardware Procurement and Setup</span>
        <a href="#/blog/self-managed-elasticsearch-vm-bare-metal-production-guide#hardware-procurement-and-setup" class="header-link" style="opacity: 0; margin-left: 8px; text-decoration: none; color: rgb(107, 114, 128); transition: opacity 0.2s; cursor: pointer;">#</a></h3>
      
<div class="highlight highlight-yaml notranslate" style="background-color: transparent !important; border: none !important; border-radius: 0px !important; padding: 0px !important; margin: 0px !important;">
<pre class="notranslate language-yaml" tabindex="0" style="border-radius: 0.75rem !important; padding: 16px !important; margin: 16px 0px !important; overflow-x: auto !important; font-size: 14px !important; line-height: 1.5 !important; white-space: pre-wrap !important; overflow-wrap: normal !important; text-wrap-style: initial !important; word-break: normal !important;"><code class="language-yaml" style="background: transparent !important; border: none !important; border-radius: 0px !important; font-family: ui-monospace, SFMono-Regular, &quot;SF Mono&quot;, Consolas, &quot;Liberation Mono&quot;, Menlo, monospace !important; font-size: 15px !important; line-height: 1.6 !important; padding: 0px !important; font-weight: 500 !important; text-rendering: geometricprecision !important; -webkit-font-smoothing: subpixel-antialiased !important; letter-spacing: 0.025em !important; white-space: pre-wrap !important; overflow-wrap: normal !important; text-wrap-style: initial !important; word-break: normal !important;"><span class="token comment"># Bare metal server specifications for high-performance deployment</span>
<span class="token key atrule">bare_metal_specs</span><span class="token punctuation">:</span>
  <span class="token key atrule">master_nodes</span><span class="token punctuation">:</span>
    <span class="token key atrule">cpu</span><span class="token punctuation">:</span> <span class="token string">"Intel Xeon Gold 6248R (24 cores, 3.0GHz)"</span>
    <span class="token key atrule">memory</span><span class="token punctuation">:</span> <span class="token string">"128GB DDR4-3200 ECC"</span>
    <span class="token key atrule">storage</span><span class="token punctuation">:</span> 
      <span class="token key atrule">os</span><span class="token punctuation">:</span> <span class="token string">"2x 480GB NVMe SSD (RAID 1)"</span>
      <span class="token key atrule">data</span><span class="token punctuation">:</span> <span class="token string">"Not applicable for master-only nodes"</span>
    <span class="token key atrule">network</span><span class="token punctuation">:</span> <span class="token string">"Dual 25GbE with bonding"</span>
    
  <span class="token key atrule">data_hot_nodes</span><span class="token punctuation">:</span>
    <span class="token key atrule">cpu</span><span class="token punctuation">:</span> <span class="token string">"AMD EPYC 7543 (32 cores, 2.8GHz)"</span>
    <span class="token key atrule">memory</span><span class="token punctuation">:</span> <span class="token string">"256GB DDR4-3200 ECC"</span>
    <span class="token key atrule">storage</span><span class="token punctuation">:</span>
      <span class="token key atrule">os</span><span class="token punctuation">:</span> <span class="token string">"2x 960GB NVMe SSD (RAID 1)"</span>
      <span class="token key atrule">data</span><span class="token punctuation">:</span> <span class="token string">"8x 3.84TB NVMe SSD (RAID 0 or JBOD)"</span>
    <span class="token key atrule">network</span><span class="token punctuation">:</span> <span class="token string">"Dual 25GbE with bonding"</span>
    
  <span class="token key atrule">data_warm_nodes</span><span class="token punctuation">:</span>
    <span class="token key atrule">cpu</span><span class="token punctuation">:</span> <span class="token string">"Intel Xeon Silver 4316 (20 cores, 2.3GHz)"</span>
    <span class="token key atrule">memory</span><span class="token punctuation">:</span> <span class="token string">"128GB DDR4-2933 ECC"</span>
    <span class="token key atrule">storage</span><span class="token punctuation">:</span>
      <span class="token key atrule">os</span><span class="token punctuation">:</span> <span class="token string">"2x 480GB SATA SSD (RAID 1)"</span>
      <span class="token key atrule">data</span><span class="token punctuation">:</span> <span class="token string">"12x 7.68TB SATA SSD"</span>
    <span class="token key atrule">network</span><span class="token punctuation">:</span> <span class="token string">"Dual 10GbE with bonding"</span>
</code></pre>
</div>

        <h3 id="numa-optimization-for-bare-metal" class="group relative scroll-mt-20 text-xl font-semibold mb-3 mt-5">
          <a class="anchor absolute -ml-10 flex items-center opacity-0 group-hover:opacity-100 transition-opacity duration-200" aria-label="Link to this section" href="#numa-optimization-for-bare-metal">
            <svg class="octicon octicon-link" viewBox="0 0 16 16" aria-hidden="true">
              <path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path>
            </svg>
          </a>
          <span>NUMA Optimization for Bare Metal</span>
        <a href="#/blog/self-managed-elasticsearch-vm-bare-metal-production-guide#numa-optimization-for-bare-metal" class="header-link" style="opacity: 0; margin-left: 8px; text-decoration: none; color: rgb(107, 114, 128); transition: opacity 0.2s; cursor: pointer;">#</a></h3>
      
<div class="highlight highlight-bash notranslate" style="background-color: transparent !important; border: none !important; border-radius: 0px !important; padding: 0px !important; margin: 0px !important;">
<pre class="notranslate language-bash" tabindex="0" style="border-radius: 0.75rem !important; padding: 16px !important; margin: 16px 0px !important; overflow-x: auto !important; font-size: 14px !important; line-height: 1.5 !important; white-space: pre-wrap !important; overflow-wrap: normal !important; text-wrap-style: initial !important; word-break: normal !important;"><code class="language-bash" style="background: transparent !important; border: none !important; border-radius: 0px !important; font-family: ui-monospace, SFMono-Regular, &quot;SF Mono&quot;, Consolas, &quot;Liberation Mono&quot;, Menlo, monospace !important; font-size: 15px !important; line-height: 1.6 !important; padding: 0px !important; font-weight: 500 !important; text-rendering: geometricprecision !important; -webkit-font-smoothing: subpixel-antialiased !important; letter-spacing: 0.025em !important; white-space: pre-wrap !important; overflow-wrap: normal !important; text-wrap-style: initial !important; word-break: normal !important;"><span class="token shebang important">#!/bin/bash</span>
<span class="token comment"># NUMA optimization script for bare metal Elasticsearch</span>

<span class="token comment"># Check NUMA topology</span>
numactl <span class="token parameter variable">--hardware</span>
lscpu <span class="token operator">|</span> <span class="token function">grep</span> NUMA

<span class="token comment"># Configure NUMA settings</span>
<span class="token function">cat</span> <span class="token operator">&gt;</span> /etc/systemd/system/elasticsearch.service.d/numa.conf <span class="token operator">&lt;&lt;</span> <span class="token string">EOF
[Service]
ExecStart=
ExecStart=/usr/share/elasticsearch/bin/systemd-entrypoint -p \<span class="token variable">${PID_DIR}</span>/elasticsearch.pid --quiet
Environment=ES_JAVA_OPTS=-server
Environment=NUMA_POLICY=interleave
ExecStartPre=/bin/bash -c 'echo never &gt; /sys/kernel/mm/transparent_hugepage/enabled'
ExecStartPre=/bin/bash -c 'echo never &gt; /sys/kernel/mm/transparent_hugepage/defrag'
LimitMEMLOCK=infinity
EOF</span>

<span class="token comment"># CPU affinity and NUMA binding</span>
<span class="token function">cat</span> <span class="token operator">&gt;</span> /usr/local/bin/elasticsearch-numa-start.sh <span class="token operator">&lt;&lt;</span> <span class="token string">'EOF'
#!/bin/bash

# Get NUMA topology
NUMA_NODES=$(numactl --hardware | grep "available:" | awk '{print $2}')
CPU_CORES=$(nproc)
CORES_PER_NUMA=$((CPU_CORES / NUMA_NODES))

# Bind Elasticsearch to specific NUMA nodes for optimal performance
if [ "$NUMA_NODES" -gt 1 ]; then
    # Use first NUMA node for master nodes
    if [[ $(hostname) == *"master"* ]]; then
        NUMA_BIND="numactl --cpunodebind=0 --membind=0"
    # Distribute data nodes across NUMA nodes
    elif [[ $(hostname) == *"data-01"* ]] || [[ $(hostname) == *"data-02"* ]]; then
        NUMA_BIND="numactl --cpunodebind=0 --membind=0"
    else
        NUMA_BIND="numactl --cpunodebind=1 --membind=1"
    fi
else
    NUMA_BIND=""
fi

# Start Elasticsearch with NUMA optimization
$NUMA_BIND /usr/share/elasticsearch/bin/elasticsearch
EOF</span>

<span class="token function">chmod</span> +x /usr/local/bin/elasticsearch-numa-start.sh

<span class="token comment"># Update systemd service to use NUMA script</span>
<span class="token function">sed</span> <span class="token parameter variable">-i</span> <span class="token string">'s|ExecStart=.*|ExecStart=/usr/local/bin/elasticsearch-numa-start.sh|'</span> /etc/systemd/system/elasticsearch.service

systemctl daemon-reload
</code></pre>
</div>

        <h3 id="storage-optimization-for-bare-metal" class="group relative scroll-mt-20 text-xl font-semibold mb-3 mt-5">
          <a class="anchor absolute -ml-10 flex items-center opacity-0 group-hover:opacity-100 transition-opacity duration-200" aria-label="Link to this section" href="#storage-optimization-for-bare-metal">
            <svg class="octicon octicon-link" viewBox="0 0 16 16" aria-hidden="true">
              <path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path>
            </svg>
          </a>
          <span>Storage Optimization for Bare Metal</span>
        <a href="#/blog/self-managed-elasticsearch-vm-bare-metal-production-guide#storage-optimization-for-bare-metal" class="header-link" style="opacity: 0; margin-left: 8px; text-decoration: none; color: rgb(107, 114, 128); transition: opacity 0.2s; cursor: pointer;">#</a></h3>
      
<div class="highlight highlight-bash notranslate" style="background-color: transparent !important; border: none !important; border-radius: 0px !important; padding: 0px !important; margin: 0px !important;">
<pre class="notranslate language-bash" tabindex="0" style="border-radius: 0.75rem !important; padding: 16px !important; margin: 16px 0px !important; overflow-x: auto !important; font-size: 14px !important; line-height: 1.5 !important; white-space: pre-wrap !important; overflow-wrap: normal !important; text-wrap-style: initial !important; word-break: normal !important;"><code class="language-bash" style="background: transparent !important; border: none !important; border-radius: 0px !important; font-family: ui-monospace, SFMono-Regular, &quot;SF Mono&quot;, Consolas, &quot;Liberation Mono&quot;, Menlo, monospace !important; font-size: 15px !important; line-height: 1.6 !important; padding: 0px !important; font-weight: 500 !important; text-rendering: geometricprecision !important; -webkit-font-smoothing: subpixel-antialiased !important; letter-spacing: 0.025em !important; white-space: pre-wrap !important; overflow-wrap: normal !important; text-wrap-style: initial !important; word-break: normal !important;"><span class="token shebang important">#!/bin/bash</span>
<span class="token comment"># Advanced storage optimization for bare metal Elasticsearch</span>

<span class="token comment"># NVMe optimization</span>
<span class="token keyword">for</span> <span class="token for-or-select variable">device</span> <span class="token keyword">in</span> /dev/nvme*n1<span class="token punctuation">;</span> <span class="token keyword">do</span>
    <span class="token comment"># Set optimal queue depth</span>
    <span class="token builtin class-name">echo</span> <span class="token number">32</span> <span class="token operator">&gt;</span> /sys/block/<span class="token variable"><span class="token variable">$(</span><span class="token function">basename</span> $device<span class="token variable">)</span></span>/queue/nr_requests
    
    <span class="token comment"># Disable scheduler for NVMe (already optimal)</span>
    <span class="token builtin class-name">echo</span> none <span class="token operator">&gt;</span> /sys/block/<span class="token variable"><span class="token variable">$(</span><span class="token function">basename</span> $device<span class="token variable">)</span></span>/queue/scheduler
    
    <span class="token comment"># Optimize read-ahead</span>
    <span class="token builtin class-name">echo</span> <span class="token number">256</span> <span class="token operator">&gt;</span> /sys/block/<span class="token variable"><span class="token variable">$(</span><span class="token function">basename</span> $device<span class="token variable">)</span></span>/queue/read_ahead_kb
    
    <span class="token comment"># Enable NCQ</span>
    <span class="token builtin class-name">echo</span> <span class="token number">1</span> <span class="token operator">&gt;</span> /sys/block/<span class="token variable"><span class="token variable">$(</span><span class="token function">basename</span> $device<span class="token variable">)</span></span>/queue/nomerges
<span class="token keyword">done</span>

<span class="token comment"># Create optimized filesystems</span>
<span class="token function-name function">create_elasticsearch_filesystem</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token builtin class-name">local</span> <span class="token assign-left variable">device</span><span class="token operator">=</span><span class="token variable">$1</span>
    <span class="token builtin class-name">local</span> <span class="token assign-left variable">mount_point</span><span class="token operator">=</span><span class="token variable">$2</span>
    
    <span class="token comment"># Create XFS filesystem with optimizations for Elasticsearch</span>
    mkfs.xfs <span class="token parameter variable">-f</span> <span class="token parameter variable">-L</span> elasticsearch-data <span class="token punctuation">\</span>
        <span class="token parameter variable">-d</span> <span class="token assign-left variable">agcount</span><span class="token operator">=</span><span class="token number">32</span>,su<span class="token operator">=</span>64k,sw<span class="token operator">=</span><span class="token number">1</span> <span class="token punctuation">\</span>
        <span class="token parameter variable">-l</span> <span class="token assign-left variable">version</span><span class="token operator">=</span><span class="token number">2</span>,su<span class="token operator">=</span>64k <span class="token punctuation">\</span>
        <span class="token parameter variable">-n</span> <span class="token assign-left variable">version</span><span class="token operator">=</span>ci <span class="token punctuation">\</span>
        <span class="token variable">$device</span>
    
    <span class="token comment"># Create mount point</span>
    <span class="token function">mkdir</span> <span class="token parameter variable">-p</span> <span class="token variable">$mount_point</span>
    
    <span class="token comment"># Add to fstab with optimal mount options</span>
    <span class="token builtin class-name">echo</span> <span class="token string">"<span class="token variable">$device</span> <span class="token variable">$mount_point</span> xfs defaults,noatime,nodiratime,nobarrier,logbufs=8,logbsize=256k,largeio,inode64,swalloc 0 2"</span> <span class="token operator">&gt;&gt;</span> /etc/fstab
    
    <span class="token comment"># Mount filesystem</span>
    <span class="token function">mount</span> <span class="token variable">$mount_point</span>
    
    <span class="token comment"># Set ownership</span>
    <span class="token function">chown</span> elasticsearch:elasticsearch <span class="token variable">$mount_point</span>
<span class="token punctuation">}</span>

<span class="token comment"># Create data filesystems</span>
<span class="token keyword">for</span> <span class="token for-or-select variable">i</span> <span class="token keyword">in</span> <span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">..</span><span class="token number">8</span><span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token keyword">do</span>
    create_elasticsearch_filesystem /dev/nvme<span class="token variable">${i}</span>n1 /data/elasticsearch-<span class="token variable">${i}</span>
<span class="token keyword">done</span>

<span class="token comment"># Configure Elasticsearch to use multiple data paths</span>
<span class="token function">cat</span> <span class="token operator">&gt;&gt;</span> /etc/elasticsearch/elasticsearch.yml <span class="token operator">&lt;&lt;</span> <span class="token string">EOF
path.data:
  - /data/elasticsearch-1
  - /data/elasticsearch-2
  - /data/elasticsearch-3
  - /data/elasticsearch-4
  - /data/elasticsearch-5
  - /data/elasticsearch-6
  - /data/elasticsearch-7
  - /data/elasticsearch-8
EOF</span>
</code></pre>
</div>
<hr>

        <h2 id="advanced-performance-tuning" class="group relative scroll-mt-20 text-2xl font-semibold mb-4 mt-6 border-b border-gray-200 dark:border-gray-700 pb-2">
          <a class="anchor absolute -ml-10 flex items-center opacity-0 group-hover:opacity-100 transition-opacity duration-200" aria-label="Link to this section" href="#advanced-performance-tuning">
            <svg class="octicon octicon-link" viewBox="0 0 16 16" aria-hidden="true">
              <path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path>
            </svg>
          </a>
          <span>Advanced Performance Tuning</span>
        <a href="#/blog/self-managed-elasticsearch-vm-bare-metal-production-guide#advanced-performance-tuning" class="header-link" style="opacity: 0; margin-left: 8px; text-decoration: none; color: rgb(107, 114, 128); transition: opacity 0.2s; cursor: pointer;">#</a></h2>
      

        <h3 id="jvm-optimization" class="group relative scroll-mt-20 text-xl font-semibold mb-3 mt-5">
          <a class="anchor absolute -ml-10 flex items-center opacity-0 group-hover:opacity-100 transition-opacity duration-200" aria-label="Link to this section" href="#jvm-optimization">
            <svg class="octicon octicon-link" viewBox="0 0 16 16" aria-hidden="true">
              <path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path>
            </svg>
          </a>
          <span>JVM Optimization</span>
        <a href="#/blog/self-managed-elasticsearch-vm-bare-metal-production-guide#jvm-optimization" class="header-link" style="opacity: 0; margin-left: 8px; text-decoration: none; color: rgb(107, 114, 128); transition: opacity 0.2s; cursor: pointer;">#</a></h3>
      
<div class="highlight highlight-bash notranslate" style="background-color: transparent !important; border: none !important; border-radius: 0px !important; padding: 0px !important; margin: 0px !important;">
<pre class="notranslate language-bash" tabindex="0" style="border-radius: 0.75rem !important; padding: 16px !important; margin: 16px 0px !important; overflow-x: auto !important; font-size: 14px !important; line-height: 1.5 !important; white-space: pre-wrap !important; overflow-wrap: normal !important; text-wrap-style: initial !important; word-break: normal !important;"><code class="language-bash" style="background: transparent !important; border: none !important; border-radius: 0px !important; font-family: ui-monospace, SFMono-Regular, &quot;SF Mono&quot;, Consolas, &quot;Liberation Mono&quot;, Menlo, monospace !important; font-size: 15px !important; line-height: 1.6 !important; padding: 0px !important; font-weight: 500 !important; text-rendering: geometricprecision !important; -webkit-font-smoothing: subpixel-antialiased !important; letter-spacing: 0.025em !important; white-space: pre-wrap !important; overflow-wrap: normal !important; text-wrap-style: initial !important; word-break: normal !important;"><span class="token comment"># Advanced JVM tuning for high-performance deployments</span>
<span class="token function">cat</span> <span class="token operator">&gt;</span> /etc/elasticsearch/jvm.options.d/production.options <span class="token operator">&lt;&lt;</span> <span class="token string">EOF
# Heap sizing (machine has 256GB RAM, using 128GB for ES)
-Xms128g
-Xmx128g

# G1GC optimization for large heaps
-XX:+UseG1GC
-XX:G1HeapRegionSize=32m
-XX:MaxGCPauseMillis=50
-XX:G1NewSizePercent=20
-XX:G1MaxNewSizePercent=30
-XX:G1HeapWastePercent=5
-XX:G1MixedGCCountTarget=8
-XX:InitiatingHeapOccupancyPercent=25
-XX:G1MixedGCLiveThresholdPercent=85
-XX:G1OldCSetRegionThresholdPercent=10

# Memory optimization
-XX:+UnlockExperimentalVMOptions
-XX:+UseTransparentHugePages
-XX:+AlwaysPreTouch
-XX:+DisableExplicitGC
-XX:+OptimizeStringConcat

# Performance optimizations
-XX:+UseStringDeduplication
-XX:+UnlockDiagnosticVMOptions
-XX:+DebugNonSafepoints

# GC logging for monitoring
-Xlog:gc*,gc+age=trace,safepoint:gc.log:time,level,tags:filecount=32,filesize=128m

# JIT compilation optimization
-XX:+TieredCompilation
-XX:+UseCodeCacheFlushing
-XX:ReservedCodeCacheSize=512m
-XX:InitialCodeCacheSize=64m

# Networking optimization
-Djava.net.preferIPv4Stack=true
-Dfile.encoding=UTF-8
EOF</span>
</code></pre>
</div>

        <h3 id="elasticsearch-cluster-optimization" class="group relative scroll-mt-20 text-xl font-semibold mb-3 mt-5">
          <a class="anchor absolute -ml-10 flex items-center opacity-0 group-hover:opacity-100 transition-opacity duration-200" aria-label="Link to this section" href="#elasticsearch-cluster-optimization">
            <svg class="octicon octicon-link" viewBox="0 0 16 16" aria-hidden="true">
              <path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path>
            </svg>
          </a>
          <span>Elasticsearch Cluster Optimization</span>
        <a href="#/blog/self-managed-elasticsearch-vm-bare-metal-production-guide#elasticsearch-cluster-optimization" class="header-link" style="opacity: 0; margin-left: 8px; text-decoration: none; color: rgb(107, 114, 128); transition: opacity 0.2s; cursor: pointer;">#</a></h3>
      
<div class="highlight highlight-yaml notranslate" style="background-color: transparent !important; border: none !important; border-radius: 0px !important; padding: 0px !important; margin: 0px !important;">
<pre class="notranslate language-yaml" tabindex="0" style="border-radius: 0.75rem !important; padding: 16px !important; margin: 16px 0px !important; overflow-x: auto !important; font-size: 14px !important; line-height: 1.5 !important; white-space: pre-wrap !important; overflow-wrap: normal !important; text-wrap-style: initial !important; word-break: normal !important;"><code class="language-yaml" style="background: transparent !important; border: none !important; border-radius: 0px !important; font-family: ui-monospace, SFMono-Regular, &quot;SF Mono&quot;, Consolas, &quot;Liberation Mono&quot;, Menlo, monospace !important; font-size: 15px !important; line-height: 1.6 !important; padding: 0px !important; font-weight: 500 !important; text-rendering: geometricprecision !important; -webkit-font-smoothing: subpixel-antialiased !important; letter-spacing: 0.025em !important; white-space: pre-wrap !important; overflow-wrap: normal !important; text-wrap-style: initial !important; word-break: normal !important;"><span class="token comment"># Advanced cluster settings for high-performance deployments</span>
PUT /_cluster/settings
<span class="token punctuation">{</span>
  <span class="token key atrule">"persistent"</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
    <span class="token comment"># Search performance</span>
    <span class="token key atrule">"search.max_buckets"</span><span class="token punctuation">:</span> <span class="token number">100000</span><span class="token punctuation">,</span>
    <span class="token key atrule">"indices.queries.cache.size"</span><span class="token punctuation">:</span> <span class="token string">"25%"</span><span class="token punctuation">,</span>
    <span class="token key atrule">"indices.fielddata.cache.size"</span><span class="token punctuation">:</span> <span class="token string">"40%"</span><span class="token punctuation">,</span>
    <span class="token key atrule">"indices.breaker.fielddata.limit"</span><span class="token punctuation">:</span> <span class="token string">"60%"</span><span class="token punctuation">,</span>
    <span class="token key atrule">"indices.breaker.request.limit"</span><span class="token punctuation">:</span> <span class="token string">"60%"</span><span class="token punctuation">,</span>
    <span class="token key atrule">"indices.breaker.total.limit"</span><span class="token punctuation">:</span> <span class="token string">"95%"</span><span class="token punctuation">,</span>
    
    <span class="token comment"># Indexing performance</span>
    <span class="token key atrule">"indices.memory.index_buffer_size"</span><span class="token punctuation">:</span> <span class="token string">"25%"</span><span class="token punctuation">,</span>
    <span class="token key atrule">"indices.memory.min_index_buffer_size"</span><span class="token punctuation">:</span> <span class="token string">"128mb"</span><span class="token punctuation">,</span>
    <span class="token key atrule">"indices.store.throttle.type"</span><span class="token punctuation">:</span> <span class="token string">"none"</span><span class="token punctuation">,</span>
    
    <span class="token comment"># Cluster stability and performance</span>
    <span class="token key atrule">"cluster.routing.allocation.cluster_concurrent_rebalance"</span><span class="token punctuation">:</span> <span class="token number">8</span><span class="token punctuation">,</span>
    <span class="token key atrule">"cluster.routing.allocation.node_concurrent_recoveries"</span><span class="token punctuation">:</span> <span class="token number">8</span><span class="token punctuation">,</span>
    <span class="token key atrule">"cluster.routing.allocation.node_initial_primaries_recoveries"</span><span class="token punctuation">:</span> <span class="token number">16</span><span class="token punctuation">,</span>
    <span class="token key atrule">"cluster.routing.allocation.disk.include_relocations"</span><span class="token punctuation">:</span> <span class="token boolean important">false</span><span class="token punctuation">,</span>
    <span class="token key atrule">"cluster.routing.rebalance.enable"</span><span class="token punctuation">:</span> <span class="token string">"all"</span><span class="token punctuation">,</span>
    <span class="token key atrule">"cluster.routing.allocation.allow_rebalance"</span><span class="token punctuation">:</span> <span class="token string">"indices_all_active"</span><span class="token punctuation">,</span>
    
    <span class="token comment"># Thread pool optimization</span>
    <span class="token key atrule">"thread_pool.write.queue_size"</span><span class="token punctuation">:</span> <span class="token number">2000</span><span class="token punctuation">,</span>
    <span class="token key atrule">"thread_pool.search.queue_size"</span><span class="token punctuation">:</span> <span class="token number">10000</span><span class="token punctuation">,</span>
    <span class="token key atrule">"thread_pool.get.queue_size"</span><span class="token punctuation">:</span> <span class="token number">1000</span><span class="token punctuation">,</span>
    <span class="token key atrule">"thread_pool.analyze.queue_size"</span><span class="token punctuation">:</span> <span class="token number">1000</span><span class="token punctuation">,</span>
    
    <span class="token comment"># Network optimization</span>
    <span class="token key atrule">"transport.tcp.compress"</span><span class="token punctuation">:</span> <span class="token boolean important">true</span><span class="token punctuation">,</span>
    <span class="token key atrule">"http.compression"</span><span class="token punctuation">:</span> <span class="token boolean important">true</span><span class="token punctuation">,</span>
    <span class="token key atrule">"http.compression_level"</span><span class="token punctuation">:</span> <span class="token number">6</span><span class="token punctuation">,</span>
    
    <span class="token comment"># Monitoring and diagnostics</span>
    <span class="token key atrule">"cluster.info.update.interval"</span><span class="token punctuation">:</span> <span class="token string">"30s"</span><span class="token punctuation">,</span>
    <span class="token key atrule">"cluster.service.slow_task_logging_threshold"</span><span class="token punctuation">:</span> <span class="token string">"10s"</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
</div>

        <h3 id="index-template-optimization" class="group relative scroll-mt-20 text-xl font-semibold mb-3 mt-5">
          <a class="anchor absolute -ml-10 flex items-center opacity-0 group-hover:opacity-100 transition-opacity duration-200" aria-label="Link to this section" href="#index-template-optimization">
            <svg class="octicon octicon-link" viewBox="0 0 16 16" aria-hidden="true">
              <path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path>
            </svg>
          </a>
          <span>Index Template Optimization</span>
        <a href="#/blog/self-managed-elasticsearch-vm-bare-metal-production-guide#index-template-optimization" class="header-link" style="opacity: 0; margin-left: 8px; text-decoration: none; color: rgb(107, 114, 128); transition: opacity 0.2s; cursor: pointer;">#</a></h3>
      
<div class="highlight highlight-bash notranslate" style="background-color: transparent !important; border: none !important; border-radius: 0px !important; padding: 0px !important; margin: 0px !important;">
<pre class="notranslate language-bash" tabindex="0" style="border-radius: 0.75rem !important; padding: 16px !important; margin: 16px 0px !important; overflow-x: auto !important; font-size: 14px !important; line-height: 1.5 !important; white-space: pre-wrap !important; overflow-wrap: normal !important; text-wrap-style: initial !important; word-break: normal !important;"><code class="language-bash" style="background: transparent !important; border: none !important; border-radius: 0px !important; font-family: ui-monospace, SFMono-Regular, &quot;SF Mono&quot;, Consolas, &quot;Liberation Mono&quot;, Menlo, monospace !important; font-size: 15px !important; line-height: 1.6 !important; padding: 0px !important; font-weight: 500 !important; text-rendering: geometricprecision !important; -webkit-font-smoothing: subpixel-antialiased !important; letter-spacing: 0.025em !important; white-space: pre-wrap !important; overflow-wrap: normal !important; text-wrap-style: initial !important; word-break: normal !important;"><span class="token comment"># High-performance index template for time-series data</span>
PUT /_index_template/high_performance_logs
<span class="token punctuation">{</span>
  <span class="token string">"index_patterns"</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span><span class="token string">"logs-*"</span><span class="token punctuation">]</span>,
  <span class="token string">"template"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
    <span class="token string">"settings"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
      <span class="token string">"number_of_shards"</span><span class="token builtin class-name">:</span> <span class="token number">6</span>,
      <span class="token string">"number_of_replicas"</span><span class="token builtin class-name">:</span> <span class="token number">1</span>,
      <span class="token string">"refresh_interval"</span><span class="token builtin class-name">:</span> <span class="token string">"10s"</span>,
      <span class="token string">"index"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
        <span class="token string">"codec"</span><span class="token builtin class-name">:</span> <span class="token string">"best_compression"</span>,
        <span class="token string">"mapping"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
          <span class="token string">"total_fields"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
            <span class="token string">"limit"</span><span class="token builtin class-name">:</span> <span class="token string">"2000"</span>
          <span class="token punctuation">}</span>,
          <span class="token string">"depth"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
            <span class="token string">"limit"</span><span class="token builtin class-name">:</span> <span class="token string">"20"</span>
          <span class="token punctuation">}</span>,
          <span class="token string">"nested_fields"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
            <span class="token string">"limit"</span><span class="token builtin class-name">:</span> <span class="token string">"100"</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>,
        <span class="token string">"max_result_window"</span><span class="token builtin class-name">:</span> <span class="token number">50000</span>,
        <span class="token string">"max_rescore_window"</span><span class="token builtin class-name">:</span> <span class="token number">10000</span>,
        <span class="token string">"blocks"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
          <span class="token string">"read_only_allow_delete"</span><span class="token builtin class-name">:</span> <span class="token boolean">false</span>
        <span class="token punctuation">}</span>,
        <span class="token string">"query"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
          <span class="token string">"default_field"</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span>
            <span class="token string">"message"</span>,
            <span class="token string">"error.message"</span>,
            <span class="token string">"log.message"</span>
          <span class="token punctuation">]</span>
        <span class="token punctuation">}</span>,
        <span class="token string">"sort"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
          <span class="token string">"field"</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span><span class="token string">"@timestamp"</span><span class="token punctuation">]</span>,
          <span class="token string">"order"</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span><span class="token string">"desc"</span><span class="token punctuation">]</span>
        <span class="token punctuation">}</span>,
        <span class="token string">"lifecycle"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
          <span class="token string">"name"</span><span class="token builtin class-name">:</span> <span class="token string">"high_performance_policy"</span>,
          <span class="token string">"rollover_alias"</span><span class="token builtin class-name">:</span> <span class="token string">"logs"</span>
        <span class="token punctuation">}</span>,
        <span class="token string">"routing"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
          <span class="token string">"allocation"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
            <span class="token string">"require"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
              <span class="token string">"box_type"</span><span class="token builtin class-name">:</span> <span class="token string">"hot"</span>
            <span class="token punctuation">}</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>,
        <span class="token string">"merge"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
          <span class="token string">"policy"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
            <span class="token string">"max_merge_at_once"</span><span class="token builtin class-name">:</span> <span class="token number">10</span>,
            <span class="token string">"segments_per_tier"</span><span class="token builtin class-name">:</span> <span class="token number">10</span>,
            <span class="token string">"max_merged_segment"</span><span class="token builtin class-name">:</span> <span class="token string">"5gb"</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>,
        <span class="token string">"translog"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
          <span class="token string">"durability"</span><span class="token builtin class-name">:</span> <span class="token string">"async"</span>,
          <span class="token string">"flush_threshold_size"</span><span class="token builtin class-name">:</span> <span class="token string">"1gb"</span>,
          <span class="token string">"sync_interval"</span><span class="token builtin class-name">:</span> <span class="token string">"30s"</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>,
    <span class="token string">"mappings"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
      <span class="token string">"dynamic_templates"</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span>
          <span class="token string">"strings_as_keywords"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
            <span class="token string">"match_mapping_type"</span><span class="token builtin class-name">:</span> <span class="token string">"string"</span>,
            <span class="token string">"match"</span><span class="token builtin class-name">:</span> <span class="token string">"*_id"</span>,
            <span class="token string">"mapping"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
              <span class="token string">"type"</span><span class="token builtin class-name">:</span> <span class="token string">"keyword"</span>,
              <span class="token string">"ignore_above"</span><span class="token builtin class-name">:</span> <span class="token number">256</span>,
              <span class="token string">"doc_values"</span><span class="token builtin class-name">:</span> <span class="token boolean">true</span>
            <span class="token punctuation">}</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>,
        <span class="token punctuation">{</span>
          <span class="token string">"strings_as_text"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
            <span class="token string">"match_mapping_type"</span><span class="token builtin class-name">:</span> <span class="token string">"string"</span>,
            <span class="token string">"mapping"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
              <span class="token string">"type"</span><span class="token builtin class-name">:</span> <span class="token string">"text"</span>,
              <span class="token string">"analyzer"</span><span class="token builtin class-name">:</span> <span class="token string">"standard"</span>,
              <span class="token string">"fields"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
                <span class="token string">"keyword"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
                  <span class="token string">"type"</span><span class="token builtin class-name">:</span> <span class="token string">"keyword"</span>,
                  <span class="token string">"ignore_above"</span><span class="token builtin class-name">:</span> <span class="token number">256</span>,
                  <span class="token string">"doc_values"</span><span class="token builtin class-name">:</span> <span class="token boolean">true</span>
                <span class="token punctuation">}</span>
              <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>,
        <span class="token punctuation">{</span>
          <span class="token string">"longs_as_integers"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
            <span class="token string">"match_mapping_type"</span><span class="token builtin class-name">:</span> <span class="token string">"long"</span>,
            <span class="token string">"mapping"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
              <span class="token string">"type"</span><span class="token builtin class-name">:</span> <span class="token string">"integer"</span>
            <span class="token punctuation">}</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">]</span>,
      <span class="token string">"properties"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
        <span class="token string">"@timestamp"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
          <span class="token string">"type"</span><span class="token builtin class-name">:</span> <span class="token string">"date"</span>,
          <span class="token string">"format"</span><span class="token builtin class-name">:</span> <span class="token string">"strict_date_optional_time||epoch_millis"</span>
        <span class="token punctuation">}</span>,
        <span class="token string">"level"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
          <span class="token string">"type"</span><span class="token builtin class-name">:</span> <span class="token string">"keyword"</span>
        <span class="token punctuation">}</span>,
        <span class="token string">"service"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
          <span class="token string">"properties"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
            <span class="token string">"name"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
              <span class="token string">"type"</span><span class="token builtin class-name">:</span> <span class="token string">"keyword"</span>
            <span class="token punctuation">}</span>,
            <span class="token string">"version"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
              <span class="token string">"type"</span><span class="token builtin class-name">:</span> <span class="token string">"keyword"</span>
            <span class="token punctuation">}</span>,
            <span class="token string">"environment"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
              <span class="token string">"type"</span><span class="token builtin class-name">:</span> <span class="token string">"keyword"</span>
            <span class="token punctuation">}</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>,
        <span class="token string">"host"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
          <span class="token string">"properties"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
            <span class="token string">"name"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
              <span class="token string">"type"</span><span class="token builtin class-name">:</span> <span class="token string">"keyword"</span>
            <span class="token punctuation">}</span>,
            <span class="token string">"ip"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
              <span class="token string">"type"</span><span class="token builtin class-name">:</span> <span class="token string">"ip"</span>
            <span class="token punctuation">}</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>,
        <span class="token string">"metrics"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
          <span class="token string">"properties"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
            <span class="token string">"cpu_usage"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
              <span class="token string">"type"</span><span class="token builtin class-name">:</span> <span class="token string">"scaled_float"</span>,
              <span class="token string">"scaling_factor"</span><span class="token builtin class-name">:</span> <span class="token number">100</span>
            <span class="token punctuation">}</span>,
            <span class="token string">"memory_usage"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
              <span class="token string">"type"</span><span class="token builtin class-name">:</span> <span class="token string">"scaled_float"</span>, 
              <span class="token string">"scaling_factor"</span><span class="token builtin class-name">:</span> <span class="token number">100</span>
            <span class="token punctuation">}</span>,
            <span class="token string">"response_time"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
              <span class="token string">"type"</span><span class="token builtin class-name">:</span> <span class="token string">"float"</span>
            <span class="token punctuation">}</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>,
  <span class="token string">"priority"</span><span class="token builtin class-name">:</span> <span class="token number">100</span>
<span class="token punctuation">}</span>
</code></pre>
</div>
<hr>

        <h2 id="automation-and-configuration-management" class="group relative scroll-mt-20 text-2xl font-semibold mb-4 mt-6 border-b border-gray-200 dark:border-gray-700 pb-2">
          <a class="anchor absolute -ml-10 flex items-center opacity-0 group-hover:opacity-100 transition-opacity duration-200" aria-label="Link to this section" href="#automation-and-configuration-management">
            <svg class="octicon octicon-link" viewBox="0 0 16 16" aria-hidden="true">
              <path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path>
            </svg>
          </a>
          <span>Automation and Configuration Management</span>
        <a href="#/blog/self-managed-elasticsearch-vm-bare-metal-production-guide#automation-and-configuration-management" class="header-link" style="opacity: 0; margin-left: 8px; text-decoration: none; color: rgb(107, 114, 128); transition: opacity 0.2s; cursor: pointer;">#</a></h2>
      

        <h3 id="ansible-playbook-for-cluster-deployment" class="group relative scroll-mt-20 text-xl font-semibold mb-3 mt-5">
          <a class="anchor absolute -ml-10 flex items-center opacity-0 group-hover:opacity-100 transition-opacity duration-200" aria-label="Link to this section" href="#ansible-playbook-for-cluster-deployment">
            <svg class="octicon octicon-link" viewBox="0 0 16 16" aria-hidden="true">
              <path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path>
            </svg>
          </a>
          <span>Ansible Playbook for Cluster Deployment</span>
        <a href="#/blog/self-managed-elasticsearch-vm-bare-metal-production-guide#ansible-playbook-for-cluster-deployment" class="header-link" style="opacity: 0; margin-left: 8px; text-decoration: none; color: rgb(107, 114, 128); transition: opacity 0.2s; cursor: pointer;">#</a></h3>
      
<div class="highlight highlight-yaml notranslate" style="background-color: transparent !important; border: none !important; border-radius: 0px !important; padding: 0px !important; margin: 0px !important;">
<pre class="notranslate language-yaml" tabindex="0" style="border-radius: 0.75rem !important; padding: 16px !important; margin: 16px 0px !important; overflow-x: auto !important; font-size: 14px !important; line-height: 1.5 !important; white-space: pre-wrap !important; overflow-wrap: normal !important; text-wrap-style: initial !important; word-break: normal !important;"><code class="language-yaml" style="background: transparent !important; border: none !important; border-radius: 0px !important; font-family: ui-monospace, SFMono-Regular, &quot;SF Mono&quot;, Consolas, &quot;Liberation Mono&quot;, Menlo, monospace !important; font-size: 15px !important; line-height: 1.6 !important; padding: 0px !important; font-weight: 500 !important; text-rendering: geometricprecision !important; -webkit-font-smoothing: subpixel-antialiased !important; letter-spacing: 0.025em !important; white-space: pre-wrap !important; overflow-wrap: normal !important; text-wrap-style: initial !important; word-break: normal !important;"><span class="token comment"># ansible/elasticsearch-cluster.yml</span>
<span class="token punctuation">---</span>
<span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Deploy Elasticsearch Cluster
  <span class="token key atrule">hosts</span><span class="token punctuation">:</span> elasticsearch_nodes
  <span class="token key atrule">become</span><span class="token punctuation">:</span> yes
  <span class="token key atrule">vars</span><span class="token punctuation">:</span>
    <span class="token key atrule">elasticsearch_version</span><span class="token punctuation">:</span> <span class="token string">"9.1.5"</span>
    <span class="token key atrule">cluster_name</span><span class="token punctuation">:</span> <span class="token string">"production-cluster"</span>
    <span class="token key atrule">data_dir</span><span class="token punctuation">:</span> <span class="token string">"/var/lib/elasticsearch"</span>
    <span class="token key atrule">log_dir</span><span class="token punctuation">:</span> <span class="token string">"/var/log/elasticsearch"</span>
    
  <span class="token key atrule">tasks</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Install system prerequisites
      <span class="token key atrule">package</span><span class="token punctuation">:</span>
        <span class="token key atrule">name</span><span class="token punctuation">:</span>
          <span class="token punctuation">-</span> openjdk<span class="token punctuation">-</span>17<span class="token punctuation">-</span>jdk
          <span class="token punctuation">-</span> curl
          <span class="token punctuation">-</span> wget
          <span class="token punctuation">-</span> gnupg2
        <span class="token key atrule">state</span><span class="token punctuation">:</span> present
        
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Configure system limits
      <span class="token key atrule">blockinfile</span><span class="token punctuation">:</span>
        <span class="token key atrule">path</span><span class="token punctuation">:</span> /etc/security/limits.conf
        <span class="token key atrule">block</span><span class="token punctuation">:</span> <span class="token punctuation">|</span><span class="token scalar string">
          elasticsearch soft memlock unlimited
          elasticsearch hard memlock unlimited
          elasticsearch soft nofile 65536
          elasticsearch hard nofile 65536
          elasticsearch soft nproc 4096
          elasticsearch hard nproc 4096</span>
          
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Configure kernel parameters
      <span class="token key atrule">sysctl</span><span class="token punctuation">:</span>
        <span class="token key atrule">name</span><span class="token punctuation">:</span> <span class="token string">"{{ item.key }}"</span>
        <span class="token key atrule">value</span><span class="token punctuation">:</span> <span class="token string">"{{ item.value }}"</span>
        <span class="token key atrule">state</span><span class="token punctuation">:</span> present
        <span class="token key atrule">reload</span><span class="token punctuation">:</span> yes
      <span class="token key atrule">loop</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token punctuation">{</span> <span class="token key atrule">key</span><span class="token punctuation">:</span> <span class="token string">'vm.max_map_count'</span><span class="token punctuation">,</span> <span class="token key atrule">value</span><span class="token punctuation">:</span> <span class="token string">'262144'</span> <span class="token punctuation">}</span>
        <span class="token punctuation">-</span> <span class="token punctuation">{</span> <span class="token key atrule">key</span><span class="token punctuation">:</span> <span class="token string">'vm.swappiness'</span><span class="token punctuation">,</span> <span class="token key atrule">value</span><span class="token punctuation">:</span> <span class="token string">'1'</span> <span class="token punctuation">}</span>
        <span class="token punctuation">-</span> <span class="token punctuation">{</span> <span class="token key atrule">key</span><span class="token punctuation">:</span> <span class="token string">'fs.file-max'</span><span class="token punctuation">,</span> <span class="token key atrule">value</span><span class="token punctuation">:</span> <span class="token string">'65536'</span> <span class="token punctuation">}</span>
        <span class="token punctuation">-</span> <span class="token punctuation">{</span> <span class="token key atrule">key</span><span class="token punctuation">:</span> <span class="token string">'net.core.somaxconn'</span><span class="token punctuation">,</span> <span class="token key atrule">value</span><span class="token punctuation">:</span> <span class="token string">'1024'</span> <span class="token punctuation">}</span>
        
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Disable swap
      <span class="token key atrule">shell</span><span class="token punctuation">:</span> <span class="token punctuation">|</span><span class="token scalar string">
        swapoff -a
        sed -i '/ swap / s/^\(.*\)$/#\1/g' /etc/fstab</span>
        
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Add Elasticsearch repository
      <span class="token key atrule">shell</span><span class="token punctuation">:</span> <span class="token punctuation">|</span><span class="token scalar string">
        wget -qO - https://artifacts.elastic.co/GPG-KEY-elasticsearch | apt-key add -
        echo "deb https://artifacts.elastic.co/packages/9.x/apt stable main" &gt; /etc/apt/sources.list.d/elastic-9.x.list</span>
        
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Install Elasticsearch
      <span class="token key atrule">package</span><span class="token punctuation">:</span>
        <span class="token key atrule">name</span><span class="token punctuation">:</span> <span class="token string">"elasticsearch={{ elasticsearch_version }}"</span>
        <span class="token key atrule">state</span><span class="token punctuation">:</span> present
        <span class="token key atrule">update_cache</span><span class="token punctuation">:</span> yes
        
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Create data and log directories
      <span class="token key atrule">file</span><span class="token punctuation">:</span>
        <span class="token key atrule">path</span><span class="token punctuation">:</span> <span class="token string">"{{ item }}"</span>
        <span class="token key atrule">state</span><span class="token punctuation">:</span> directory
        <span class="token key atrule">owner</span><span class="token punctuation">:</span> elasticsearch
        <span class="token key atrule">group</span><span class="token punctuation">:</span> elasticsearch
        <span class="token key atrule">mode</span><span class="token punctuation">:</span> <span class="token string">'0755'</span>
      <span class="token key atrule">loop</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token string">"{{ data_dir }}/data"</span>
        <span class="token punctuation">-</span> <span class="token string">"{{ log_dir }}"</span>
        
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Generate Elasticsearch configuration
      <span class="token key atrule">template</span><span class="token punctuation">:</span>
        <span class="token key atrule">src</span><span class="token punctuation">:</span> elasticsearch.yml.j2
        <span class="token key atrule">dest</span><span class="token punctuation">:</span> /etc/elasticsearch/elasticsearch.yml
        <span class="token key atrule">owner</span><span class="token punctuation">:</span> root
        <span class="token key atrule">group</span><span class="token punctuation">:</span> elasticsearch
        <span class="token key atrule">mode</span><span class="token punctuation">:</span> <span class="token string">'0660'</span>
      <span class="token key atrule">notify</span><span class="token punctuation">:</span> restart elasticsearch
      
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Configure JVM options
      <span class="token key atrule">template</span><span class="token punctuation">:</span>
        <span class="token key atrule">src</span><span class="token punctuation">:</span> jvm.options.j2
        <span class="token key atrule">dest</span><span class="token punctuation">:</span> /etc/elasticsearch/jvm.options.d/production.options
        <span class="token key atrule">owner</span><span class="token punctuation">:</span> root
        <span class="token key atrule">group</span><span class="token punctuation">:</span> elasticsearch
        <span class="token key atrule">mode</span><span class="token punctuation">:</span> <span class="token string">'0660'</span>
      <span class="token key atrule">notify</span><span class="token punctuation">:</span> restart elasticsearch
      
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Start and enable Elasticsearch
      <span class="token key atrule">systemd</span><span class="token punctuation">:</span>
        <span class="token key atrule">name</span><span class="token punctuation">:</span> elasticsearch
        <span class="token key atrule">state</span><span class="token punctuation">:</span> started
        <span class="token key atrule">enabled</span><span class="token punctuation">:</span> yes
        <span class="token key atrule">daemon_reload</span><span class="token punctuation">:</span> yes
        
  <span class="token key atrule">handlers</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> restart elasticsearch
      <span class="token key atrule">systemd</span><span class="token punctuation">:</span>
        <span class="token key atrule">name</span><span class="token punctuation">:</span> elasticsearch
        <span class="token key atrule">state</span><span class="token punctuation">:</span> restarted
</code></pre>
</div>

        <h3 id="terraform-infrastructure-as-code" class="group relative scroll-mt-20 text-xl font-semibold mb-3 mt-5">
          <a class="anchor absolute -ml-10 flex items-center opacity-0 group-hover:opacity-100 transition-opacity duration-200" aria-label="Link to this section" href="#terraform-infrastructure-as-code">
            <svg class="octicon octicon-link" viewBox="0 0 16 16" aria-hidden="true">
              <path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path>
            </svg>
          </a>
          <span>Terraform Infrastructure as Code</span>
        <a href="#/blog/self-managed-elasticsearch-vm-bare-metal-production-guide#terraform-infrastructure-as-code" class="header-link" style="opacity: 0; margin-left: 8px; text-decoration: none; color: rgb(107, 114, 128); transition: opacity 0.2s; cursor: pointer;">#</a></h3>
      
<div class="highlight highlight-hcl notranslate" style="background-color: transparent !important; border: none !important; border-radius: 0px !important; padding: 0px !important; margin: 0px !important;">
<pre class="notranslate language-hcl" tabindex="0" style="border-radius: 0.75rem !important; padding: 16px !important; margin: 16px 0px !important; overflow-x: auto !important; font-size: 14px !important; line-height: 1.5 !important; white-space: pre-wrap !important; overflow-wrap: normal !important; text-wrap-style: initial !important; word-break: normal !important;"><code class="language-hcl" style="background: transparent !important; border: none !important; border-radius: 0px !important; font-family: ui-monospace, SFMono-Regular, &quot;SF Mono&quot;, Consolas, &quot;Liberation Mono&quot;, Menlo, monospace !important; font-size: 15px !important; line-height: 1.6 !important; padding: 0px !important; font-weight: 500 !important; text-rendering: geometricprecision !important; -webkit-font-smoothing: subpixel-antialiased !important; letter-spacing: 0.025em !important; white-space: pre-wrap !important; overflow-wrap: normal !important; text-wrap-style: initial !important; word-break: normal !important;"># terraform/elasticsearch-cluster.tf
terraform {
  required_providers {
    aws = {
      source  = "hashicorp/aws"
      version = "~&gt; 5.0"
    }
  }
}

variable "cluster_name" {
  description = "Elasticsearch cluster name"
  type        = string
  default     = "production-es"
}

variable "instance_types" {
  description = "Instance types for different node roles"
  type = object({
    master = string
    data   = string
    warm   = string
  })
  default = {
    master = "m6i.xlarge"
    data   = "r6i.4xlarge"
    warm   = "m6i.2xlarge"
  }
}

# VPC and networking
resource "aws_vpc" "elasticsearch_vpc" {
  cidr_block           = "10.0.0.0/16"
  enable_dns_hostnames = true
  enable_dns_support   = true
  
  tags = {
    Name = "${var.cluster_name}-vpc"
  }
}

resource "aws_subnet" "elasticsearch_subnet" {
  count             = 3
  vpc_id            = aws_vpc.elasticsearch_vpc.id
  cidr_block        = "10.0.${count.index + 1}.0/24"
  availability_zone = data.aws_availability_zones.available.names[count.index]
  
  tags = {
    Name = "${var.cluster_name}-subnet-${count.index + 1}"
  }
}

# Security group
resource "aws_security_group" "elasticsearch_sg" {
  name_prefix = "${var.cluster_name}-sg"
  vpc_id      = aws_vpc.elasticsearch_vpc.id

  ingress {
    from_port   = 9200
    to_port     = 9200
    protocol    = "tcp"
    cidr_blocks = ["10.0.0.0/16"]
  }

  ingress {
    from_port   = 9300
    to_port     = 9300
    protocol    = "tcp"
    cidr_blocks = ["10.0.0.0/16"]
  }

  ingress {
    from_port   = 22
    to_port     = 22
    protocol    = "tcp"
    cidr_blocks = ["10.0.0.0/16"]
  }

  egress {
    from_port   = 0
    to_port     = 0
    protocol    = "-1"
    cidr_blocks = ["0.0.0.0/0"]
  }

  tags = {
    Name = "${var.cluster_name}-sg"
  }
}

# Launch template for master nodes
resource "aws_launch_template" "elasticsearch_master" {
  name_prefix   = "${var.cluster_name}-master"
  image_id      = data.aws_ami.ubuntu.id
  instance_type = var.instance_types.master
  key_name      = aws_key_pair.elasticsearch_key.key_name

  vpc_security_group_ids = [aws_security_group.elasticsearch_sg.id]

  block_device_mappings {
    device_name = "/dev/sda1"
    ebs {
      volume_size = 100
      volume_type = "gp3"
      encrypted   = true
    }
  }

  user_data = base64encode(templatefile("${path.module}/user_data_master.sh", {
    cluster_name = var.cluster_name
  }))

  tag_specifications {
    resource_type = "instance"
    tags = {
      Name = "${var.cluster_name}-master"
      Role = "master"
    }
  }
}

# Launch template for data nodes
resource "aws_launch_template" "elasticsearch_data" {
  name_prefix   = "${var.cluster_name}-data"
  image_id      = data.aws_ami.ubuntu.id
  instance_type = var.instance_types.data
  key_name      = aws_key_pair.elasticsearch_key.key_name

  vpc_security_group_ids = [aws_security_group.elasticsearch_sg.id]

  block_device_mappings {
    device_name = "/dev/sda1"
    ebs {
      volume_size = 100
      volume_type = "gp3"
      encrypted   = true
    }
  }

  block_device_mappings {
    device_name = "/dev/xvdf"
    ebs {
      volume_size = 1000
      volume_type = "gp3"
      iops        = 3000
      throughput  = 250
      encrypted   = true
    }
  }

  user_data = base64encode(templatefile("${path.module}/user_data_data.sh", {
    cluster_name = var.cluster_name
  }))

  tag_specifications {
    resource_type = "instance"
    tags = {
      Name = "${var.cluster_name}-data"
      Role = "data"
    }
  }
}

# Auto Scaling Groups
resource "aws_autoscaling_group" "elasticsearch_master" {
  name                = "${var.cluster_name}-master-asg"
  vpc_zone_identifier = aws_subnet.elasticsearch_subnet[*].id
  target_group_arns   = []
  health_check_type   = "EC2"
  health_check_grace_period = 300

  min_size         = 3
  max_size         = 3
  desired_capacity = 3

  launch_template {
    id      = aws_launch_template.elasticsearch_master.id
    version = "$Latest"
  }

  tag {
    key                 = "Name"
    value               = "${var.cluster_name}-master"
    propagate_at_launch = true
  }
}

resource "aws_autoscaling_group" "elasticsearch_data" {
  name                = "${var.cluster_name}-data-asg"
  vpc_zone_identifier = aws_subnet.elasticsearch_subnet[*].id
  target_group_arns   = []
  health_check_type   = "EC2"
  health_check_grace_period = 300

  min_size         = 3
  max_size         = 6
  desired_capacity = 3

  launch_template {
    id      = aws_launch_template.elasticsearch_data.id
    version = "$Latest"
  }

  tag {
    key                 = "Name"
    value               = "${var.cluster_name}-data"
    propagate_at_launch = true
  }
}

# Data sources
data "aws_availability_zones" "available" {
  state = "available"
}

data "aws_ami" "ubuntu" {
  most_recent = true
  owners      = ["099720109477"] # Canonical

  filter {
    name   = "name"
    values = ["ubuntu/images/hvm-ssd/ubuntu-jammy-22.04-amd64-server-*"]
  }
}

# Output values
output "vpc_id" {
  value = aws_vpc.elasticsearch_vpc.id
}

output "subnet_ids" {
  value = aws_subnet.elasticsearch_subnet[*].id
}
</code></pre>
</div>
<hr>

        <h2 id="capacity-planning-and-sizing" class="group relative scroll-mt-20 text-2xl font-semibold mb-4 mt-6 border-b border-gray-200 dark:border-gray-700 pb-2">
          <a class="anchor absolute -ml-10 flex items-center opacity-0 group-hover:opacity-100 transition-opacity duration-200" aria-label="Link to this section" href="#capacity-planning-and-sizing">
            <svg class="octicon octicon-link" viewBox="0 0 16 16" aria-hidden="true">
              <path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path>
            </svg>
          </a>
          <span>Capacity Planning and Sizing</span>
        <a href="#/blog/self-managed-elasticsearch-vm-bare-metal-production-guide#capacity-planning-and-sizing" class="header-link" style="opacity: 0; margin-left: 8px; text-decoration: none; color: rgb(107, 114, 128); transition: opacity 0.2s; cursor: pointer;">#</a></h2>
      

        <h3 id="resource-calculation-framework" class="group relative scroll-mt-20 text-xl font-semibold mb-3 mt-5">
          <a class="anchor absolute -ml-10 flex items-center opacity-0 group-hover:opacity-100 transition-opacity duration-200" aria-label="Link to this section" href="#resource-calculation-framework">
            <svg class="octicon octicon-link" viewBox="0 0 16 16" aria-hidden="true">
              <path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path>
            </svg>
          </a>
          <span>Resource Calculation Framework</span>
        <a href="#/blog/self-managed-elasticsearch-vm-bare-metal-production-guide#resource-calculation-framework" class="header-link" style="opacity: 0; margin-left: 8px; text-decoration: none; color: rgb(107, 114, 128); transition: opacity 0.2s; cursor: pointer;">#</a></h3>
      
<div class="highlight highlight-python notranslate" style="background-color: transparent !important; border: none !important; border-radius: 0px !important; padding: 0px !important; margin: 0px !important;">
<pre class="notranslate language-python" tabindex="0" style="border-radius: 0.75rem !important; padding: 16px !important; margin: 16px 0px !important; overflow-x: auto !important; font-size: 14px !important; line-height: 1.5 !important; white-space: pre-wrap !important; overflow-wrap: normal !important; text-wrap-style: initial !important; word-break: normal !important;"><code class="language-python" style="background: transparent !important; border: none !important; border-radius: 0px !important; font-family: ui-monospace, SFMono-Regular, &quot;SF Mono&quot;, Consolas, &quot;Liberation Mono&quot;, Menlo, monospace !important; font-size: 15px !important; line-height: 1.6 !important; padding: 0px !important; font-weight: 500 !important; text-rendering: geometricprecision !important; -webkit-font-smoothing: subpixel-antialiased !important; letter-spacing: 0.025em !important; white-space: pre-wrap !important; overflow-wrap: normal !important; text-wrap-style: initial !important; word-break: normal !important;"><span class="token comment">#!/usr/bin/env python3</span>
<span class="token comment"># elasticsearch_sizing_calculator.py</span>

<span class="token keyword">import</span> math
<span class="token keyword">import</span> json

<span class="token keyword">class</span> <span class="token class-name">ElasticsearchSizingCalculator</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>overhead_factors <span class="token operator">=</span> <span class="token punctuation">{</span>
            <span class="token string">'indexing_overhead'</span><span class="token punctuation">:</span> <span class="token number">1.15</span><span class="token punctuation">,</span>  <span class="token comment"># 15% overhead for indexing</span>
            <span class="token string">'replica_factor'</span><span class="token punctuation">:</span> <span class="token number">2.0</span><span class="token punctuation">,</span>      <span class="token comment"># Primary + 1 replica</span>
            <span class="token string">'os_reserved'</span><span class="token punctuation">:</span> <span class="token number">0.85</span><span class="token punctuation">,</span>        <span class="token comment"># Reserve 15% for OS</span>
            <span class="token string">'growth_buffer'</span><span class="token punctuation">:</span> <span class="token number">1.3</span>        <span class="token comment"># 30% growth buffer</span>
        <span class="token punctuation">}</span>
    
    <span class="token keyword">def</span> <span class="token function">calculate_storage_requirements</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> daily_data_gb<span class="token punctuation">,</span> retention_days<span class="token punctuation">,</span> 
                                     compression_ratio<span class="token operator">=</span><span class="token number">0.3</span><span class="token punctuation">,</span> shard_overhead<span class="token operator">=</span><span class="token number">0.1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""Calculate storage requirements with all overhead factors"""</span>
        
        <span class="token comment"># Base storage calculation</span>
        raw_storage <span class="token operator">=</span> daily_data_gb <span class="token operator">*</span> retention_days
        
        <span class="token comment"># Apply compression</span>
        compressed_storage <span class="token operator">=</span> raw_storage <span class="token operator">*</span> compression_ratio
        
        <span class="token comment"># Add shard overhead (segments, translog, etc.)</span>
        storage_with_overhead <span class="token operator">=</span> compressed_storage <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">+</span> shard_overhead<span class="token punctuation">)</span>
        
        <span class="token comment"># Apply replica factor</span>
        storage_with_replicas <span class="token operator">=</span> storage_with_overhead <span class="token operator">*</span> self<span class="token punctuation">.</span>overhead_factors<span class="token punctuation">[</span><span class="token string">'replica_factor'</span><span class="token punctuation">]</span>
        
        <span class="token comment"># Add growth buffer</span>
        total_storage <span class="token operator">=</span> storage_with_replicas <span class="token operator">*</span> self<span class="token punctuation">.</span>overhead_factors<span class="token punctuation">[</span><span class="token string">'growth_buffer'</span><span class="token punctuation">]</span>
        
        <span class="token keyword">return</span> <span class="token punctuation">{</span>
            <span class="token string">'raw_storage_gb'</span><span class="token punctuation">:</span> raw_storage<span class="token punctuation">,</span>
            <span class="token string">'compressed_storage_gb'</span><span class="token punctuation">:</span> compressed_storage<span class="token punctuation">,</span>
            <span class="token string">'storage_with_overhead_gb'</span><span class="token punctuation">:</span> storage_with_overhead<span class="token punctuation">,</span>
            <span class="token string">'storage_with_replicas_gb'</span><span class="token punctuation">:</span> storage_with_replicas<span class="token punctuation">,</span>
            <span class="token string">'total_storage_required_gb'</span><span class="token punctuation">:</span> total_storage
        <span class="token punctuation">}</span>
    
    <span class="token keyword">def</span> <span class="token function">calculate_memory_requirements</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> total_storage_gb<span class="token punctuation">,</span> heap_to_storage_ratio<span class="token operator">=</span><span class="token number">0.02</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""Calculate JVM heap and total memory requirements"""</span>
        
        <span class="token comment"># JVM heap sizing (typically 2-5% of total data)</span>
        heap_gb <span class="token operator">=</span> total_storage_gb <span class="token operator">*</span> heap_to_storage_ratio
        
        <span class="token comment"># Cap heap at 32GB for compressed OOPs</span>
        <span class="token keyword">if</span> heap_gb <span class="token operator">&gt;</span> <span class="token number">32</span><span class="token punctuation">:</span>
            heap_gb <span class="token operator">=</span> <span class="token number">32</span>
        
        <span class="token comment"># Total memory (heap + OS cache + overhead)</span>
        total_memory_gb <span class="token operator">=</span> heap_gb <span class="token operator">*</span> <span class="token number">2.5</span>  <span class="token comment"># Leave 60% for OS cache</span>
        
        <span class="token keyword">return</span> <span class="token punctuation">{</span>
            <span class="token string">'heap_size_gb'</span><span class="token punctuation">:</span> heap_gb<span class="token punctuation">,</span>
            <span class="token string">'total_memory_gb'</span><span class="token punctuation">:</span> total_memory_gb<span class="token punctuation">,</span>
            <span class="token string">'os_cache_gb'</span><span class="token punctuation">:</span> total_memory_gb <span class="token operator">-</span> heap_gb
        <span class="token punctuation">}</span>
    
    <span class="token keyword">def</span> <span class="token function">calculate_node_count</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> total_storage_gb<span class="token punctuation">,</span> total_memory_gb<span class="token punctuation">,</span> 
                           max_storage_per_node<span class="token operator">=</span><span class="token number">6000</span><span class="token punctuation">,</span> max_memory_per_node<span class="token operator">=</span><span class="token number">256</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""Calculate required number of nodes"""</span>
        
        nodes_by_storage <span class="token operator">=</span> math<span class="token punctuation">.</span>ceil<span class="token punctuation">(</span>total_storage_gb <span class="token operator">/</span> max_storage_per_node<span class="token punctuation">)</span>
        nodes_by_memory <span class="token operator">=</span> math<span class="token punctuation">.</span>ceil<span class="token punctuation">(</span>total_memory_gb <span class="token operator">/</span> max_memory_per_node<span class="token punctuation">)</span>
        
        <span class="token comment"># Take the higher requirement</span>
        required_nodes <span class="token operator">=</span> <span class="token builtin">max</span><span class="token punctuation">(</span>nodes_by_storage<span class="token punctuation">,</span> nodes_by_memory<span class="token punctuation">)</span>
        
        <span class="token comment"># Ensure minimum 3 nodes for HA</span>
        required_nodes <span class="token operator">=</span> <span class="token builtin">max</span><span class="token punctuation">(</span>required_nodes<span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span>
        
        <span class="token keyword">return</span> <span class="token punctuation">{</span>
            <span class="token string">'nodes_by_storage'</span><span class="token punctuation">:</span> nodes_by_storage<span class="token punctuation">,</span>
            <span class="token string">'nodes_by_memory'</span><span class="token punctuation">:</span> nodes_by_memory<span class="token punctuation">,</span>
            <span class="token string">'recommended_nodes'</span><span class="token punctuation">:</span> required_nodes<span class="token punctuation">,</span>
            <span class="token string">'storage_per_node_gb'</span><span class="token punctuation">:</span> total_storage_gb <span class="token operator">/</span> required_nodes<span class="token punctuation">,</span>
            <span class="token string">'memory_per_node_gb'</span><span class="token punctuation">:</span> total_memory_gb <span class="token operator">/</span> required_nodes
        <span class="token punctuation">}</span>
    
    <span class="token keyword">def</span> <span class="token function">calculate_shard_configuration</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> total_storage_gb<span class="token punctuation">,</span> target_shard_size_gb<span class="token operator">=</span><span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""Calculate optimal shard configuration"""</span>
        
        primary_shards <span class="token operator">=</span> math<span class="token punctuation">.</span>ceil<span class="token punctuation">(</span>total_storage_gb <span class="token operator">/</span> target_shard_size_gb<span class="token punctuation">)</span>
        
        <span class="token comment"># Ensure reasonable shard count (not too many small shards)</span>
        <span class="token keyword">if</span> primary_shards <span class="token operator">&gt;</span> <span class="token number">100</span><span class="token punctuation">:</span>
            primary_shards <span class="token operator">=</span> <span class="token number">100</span>
            actual_shard_size <span class="token operator">=</span> total_storage_gb <span class="token operator">/</span> primary_shards
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            actual_shard_size <span class="token operator">=</span> target_shard_size_gb
        
        <span class="token keyword">return</span> <span class="token punctuation">{</span>
            <span class="token string">'primary_shards'</span><span class="token punctuation">:</span> primary_shards<span class="token punctuation">,</span>
            <span class="token string">'actual_shard_size_gb'</span><span class="token punctuation">:</span> actual_shard_size<span class="token punctuation">,</span>
            <span class="token string">'total_shards_with_replicas'</span><span class="token punctuation">:</span> primary_shards <span class="token operator">*</span> <span class="token number">2</span>
        <span class="token punctuation">}</span>
    
    <span class="token keyword">def</span> <span class="token function">generate_sizing_report</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> daily_data_gb<span class="token punctuation">,</span> retention_days<span class="token punctuation">,</span> 
                             query_rate_per_second<span class="token operator">=</span><span class="token number">100</span><span class="token punctuation">,</span> indexing_rate_per_second<span class="token operator">=</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""Generate comprehensive sizing report"""</span>
        
        <span class="token comment"># Storage calculations</span>
        storage <span class="token operator">=</span> self<span class="token punctuation">.</span>calculate_storage_requirements<span class="token punctuation">(</span>daily_data_gb<span class="token punctuation">,</span> retention_days<span class="token punctuation">)</span>
        
        <span class="token comment"># Memory calculations</span>
        memory <span class="token operator">=</span> self<span class="token punctuation">.</span>calculate_memory_requirements<span class="token punctuation">(</span>storage<span class="token punctuation">[</span><span class="token string">'total_storage_required_gb'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        
        <span class="token comment"># Node count calculations</span>
        nodes <span class="token operator">=</span> self<span class="token punctuation">.</span>calculate_node_count<span class="token punctuation">(</span>
            storage<span class="token punctuation">[</span><span class="token string">'total_storage_required_gb'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> 
            memory<span class="token punctuation">[</span><span class="token string">'total_memory_gb'</span><span class="token punctuation">]</span>
        <span class="token punctuation">)</span>
        
        <span class="token comment"># Shard configuration</span>
        shards <span class="token operator">=</span> self<span class="token punctuation">.</span>calculate_shard_configuration<span class="token punctuation">(</span>storage<span class="token punctuation">[</span><span class="token string">'total_storage_required_gb'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        
        <span class="token comment"># Performance estimates</span>
        performance <span class="token operator">=</span> <span class="token punctuation">{</span>
            <span class="token string">'estimated_query_capacity_per_node'</span><span class="token punctuation">:</span> <span class="token number">50</span><span class="token punctuation">,</span>  <span class="token comment"># queries/second</span>
            <span class="token string">'estimated_indexing_capacity_per_node'</span><span class="token punctuation">:</span> <span class="token number">5000</span><span class="token punctuation">,</span>  <span class="token comment"># docs/second</span>
            <span class="token string">'total_query_capacity'</span><span class="token punctuation">:</span> nodes<span class="token punctuation">[</span><span class="token string">'recommended_nodes'</span><span class="token punctuation">]</span> <span class="token operator">*</span> <span class="token number">50</span><span class="token punctuation">,</span>
            <span class="token string">'total_indexing_capacity'</span><span class="token punctuation">:</span> nodes<span class="token punctuation">[</span><span class="token string">'recommended_nodes'</span><span class="token punctuation">]</span> <span class="token operator">*</span> <span class="token number">5000</span><span class="token punctuation">,</span>
            <span class="token string">'meets_query_requirements'</span><span class="token punctuation">:</span> nodes<span class="token punctuation">[</span><span class="token string">'recommended_nodes'</span><span class="token punctuation">]</span> <span class="token operator">*</span> <span class="token number">50</span> <span class="token operator">&gt;=</span> query_rate_per_second<span class="token punctuation">,</span>
            <span class="token string">'meets_indexing_requirements'</span><span class="token punctuation">:</span> nodes<span class="token punctuation">[</span><span class="token string">'recommended_nodes'</span><span class="token punctuation">]</span> <span class="token operator">*</span> <span class="token number">5000</span> <span class="token operator">&gt;=</span> indexing_rate_per_second
        <span class="token punctuation">}</span>
        
        <span class="token keyword">return</span> <span class="token punctuation">{</span>
            <span class="token string">'input_parameters'</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
                <span class="token string">'daily_data_gb'</span><span class="token punctuation">:</span> daily_data_gb<span class="token punctuation">,</span>
                <span class="token string">'retention_days'</span><span class="token punctuation">:</span> retention_days<span class="token punctuation">,</span>
                <span class="token string">'query_rate_per_second'</span><span class="token punctuation">:</span> query_rate_per_second<span class="token punctuation">,</span>
                <span class="token string">'indexing_rate_per_second'</span><span class="token punctuation">:</span> indexing_rate_per_second
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token string">'storage_requirements'</span><span class="token punctuation">:</span> storage<span class="token punctuation">,</span>
            <span class="token string">'memory_requirements'</span><span class="token punctuation">:</span> memory<span class="token punctuation">,</span>
            <span class="token string">'node_requirements'</span><span class="token punctuation">:</span> nodes<span class="token punctuation">,</span>
            <span class="token string">'shard_configuration'</span><span class="token punctuation">:</span> shards<span class="token punctuation">,</span>
            <span class="token string">'performance_estimates'</span><span class="token punctuation">:</span> performance
        <span class="token punctuation">}</span>

<span class="token comment"># Example usage</span>
<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>
    calculator <span class="token operator">=</span> ElasticsearchSizingCalculator<span class="token punctuation">(</span><span class="token punctuation">)</span>
    
    <span class="token comment"># Example: 100GB daily data, 30 days retention</span>
    report <span class="token operator">=</span> calculator<span class="token punctuation">.</span>generate_sizing_report<span class="token punctuation">(</span>
        daily_data_gb<span class="token operator">=</span><span class="token number">100</span><span class="token punctuation">,</span>
        retention_days<span class="token operator">=</span><span class="token number">30</span><span class="token punctuation">,</span>
        query_rate_per_second<span class="token operator">=</span><span class="token number">500</span><span class="token punctuation">,</span>
        indexing_rate_per_second<span class="token operator">=</span><span class="token number">10000</span>
    <span class="token punctuation">)</span>
    
    <span class="token keyword">print</span><span class="token punctuation">(</span>json<span class="token punctuation">.</span>dumps<span class="token punctuation">(</span>report<span class="token punctuation">,</span> indent<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre>
</div>

        <h3 id="hardware-sizing-matrix" class="group relative scroll-mt-20 text-xl font-semibold mb-3 mt-5">
          <a class="anchor absolute -ml-10 flex items-center opacity-0 group-hover:opacity-100 transition-opacity duration-200" aria-label="Link to this section" href="#hardware-sizing-matrix">
            <svg class="octicon octicon-link" viewBox="0 0 16 16" aria-hidden="true">
              <path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path>
            </svg>
          </a>
          <span>Hardware Sizing Matrix</span>
        <a href="#/blog/self-managed-elasticsearch-vm-bare-metal-production-guide#hardware-sizing-matrix" class="header-link" style="opacity: 0; margin-left: 8px; text-decoration: none; color: rgb(107, 114, 128); transition: opacity 0.2s; cursor: pointer;">#</a></h3>
      
<div class="highlight highlight-yaml notranslate" style="background-color: transparent !important; border: none !important; border-radius: 0px !important; padding: 0px !important; margin: 0px !important;">
<pre class="notranslate language-yaml" tabindex="0" style="border-radius: 0.75rem !important; padding: 16px !important; margin: 16px 0px !important; overflow-x: auto !important; font-size: 14px !important; line-height: 1.5 !important; white-space: pre-wrap !important; overflow-wrap: normal !important; text-wrap-style: initial !important; word-break: normal !important;"><code class="language-yaml" style="background: transparent !important; border: none !important; border-radius: 0px !important; font-family: ui-monospace, SFMono-Regular, &quot;SF Mono&quot;, Consolas, &quot;Liberation Mono&quot;, Menlo, monospace !important; font-size: 15px !important; line-height: 1.6 !important; padding: 0px !important; font-weight: 500 !important; text-rendering: geometricprecision !important; -webkit-font-smoothing: subpixel-antialiased !important; letter-spacing: 0.025em !important; white-space: pre-wrap !important; overflow-wrap: normal !important; text-wrap-style: initial !important; word-break: normal !important;"><span class="token comment"># Hardware sizing matrix for different workload patterns</span>
<span class="token key atrule">sizing_matrix</span><span class="token punctuation">:</span>
  <span class="token key atrule">small_deployment</span><span class="token punctuation">:</span>
    <span class="token key atrule">data_volume</span><span class="token punctuation">:</span> <span class="token string">"&lt; 1TB"</span>
    <span class="token key atrule">daily_ingestion</span><span class="token punctuation">:</span> <span class="token string">"&lt; 10GB"</span>
    <span class="token key atrule">query_rate</span><span class="token punctuation">:</span> <span class="token string">"&lt; 100 QPS"</span>
    <span class="token key atrule">recommended_config</span><span class="token punctuation">:</span>
      <span class="token key atrule">nodes</span><span class="token punctuation">:</span> <span class="token number">3</span>
      <span class="token key atrule">node_spec</span><span class="token punctuation">:</span>
        <span class="token key atrule">cpu</span><span class="token punctuation">:</span> <span class="token string">"8 cores"</span>
        <span class="token key atrule">memory</span><span class="token punctuation">:</span> <span class="token string">"32GB"</span>
        <span class="token key atrule">storage</span><span class="token punctuation">:</span> <span class="token string">"500GB SSD"</span>
      <span class="token key atrule">estimated_cost</span><span class="token punctuation">:</span> <span class="token string">"$2,400/month"</span>
      
  <span class="token key atrule">medium_deployment</span><span class="token punctuation">:</span>
    <span class="token key atrule">data_volume</span><span class="token punctuation">:</span> <span class="token string">"1-10TB"</span>
    <span class="token key atrule">daily_ingestion</span><span class="token punctuation">:</span> <span class="token string">"10-100GB"</span>
    <span class="token key atrule">query_rate</span><span class="token punctuation">:</span> <span class="token string">"100-1000 QPS"</span>
    <span class="token key atrule">recommended_config</span><span class="token punctuation">:</span>
      <span class="token key atrule">nodes</span><span class="token punctuation">:</span> <span class="token number">6</span>
      <span class="token key atrule">node_spec</span><span class="token punctuation">:</span>
        <span class="token key atrule">cpu</span><span class="token punctuation">:</span> <span class="token string">"16 cores"</span>
        <span class="token key atrule">memory</span><span class="token punctuation">:</span> <span class="token string">"64GB"</span>
        <span class="token key atrule">storage</span><span class="token punctuation">:</span> <span class="token string">"2TB SSD"</span>
      <span class="token key atrule">estimated_cost</span><span class="token punctuation">:</span> <span class="token string">"$8,000/month"</span>
      
  <span class="token key atrule">large_deployment</span><span class="token punctuation">:</span>
    <span class="token key atrule">data_volume</span><span class="token punctuation">:</span> <span class="token string">"10-100TB"</span>
    <span class="token key atrule">daily_ingestion</span><span class="token punctuation">:</span> <span class="token string">"100GB-1TB"</span>
    <span class="token key atrule">query_rate</span><span class="token punctuation">:</span> <span class="token string">"1000-10000 QPS"</span>
    <span class="token key atrule">recommended_config</span><span class="token punctuation">:</span>
      <span class="token key atrule">nodes</span><span class="token punctuation">:</span> <span class="token number">12</span>
      <span class="token key atrule">node_spec</span><span class="token punctuation">:</span>
        <span class="token key atrule">cpu</span><span class="token punctuation">:</span> <span class="token string">"32 cores"</span>
        <span class="token key atrule">memory</span><span class="token punctuation">:</span> <span class="token string">"128GB"</span>
        <span class="token key atrule">storage</span><span class="token punctuation">:</span> <span class="token string">"8TB SSD"</span>
      <span class="token key atrule">estimated_cost</span><span class="token punctuation">:</span> <span class="token string">"$25,000/month"</span>
      
  <span class="token key atrule">enterprise_deployment</span><span class="token punctuation">:</span>
    <span class="token key atrule">data_volume</span><span class="token punctuation">:</span> <span class="token string">"&gt; 100TB"</span>
    <span class="token key atrule">daily_ingestion</span><span class="token punctuation">:</span> <span class="token string">"&gt; 1TB"</span>
    <span class="token key atrule">query_rate</span><span class="token punctuation">:</span> <span class="token string">"&gt; 10000 QPS"</span>
    <span class="token key atrule">recommended_config</span><span class="token punctuation">:</span>
      <span class="token key atrule">nodes</span><span class="token punctuation">:</span> <span class="token string">"20+"</span>
      <span class="token key atrule">node_spec</span><span class="token punctuation">:</span>
        <span class="token key atrule">cpu</span><span class="token punctuation">:</span> <span class="token string">"64 cores"</span>
        <span class="token key atrule">memory</span><span class="token punctuation">:</span> <span class="token string">"256GB"</span>
        <span class="token key atrule">storage</span><span class="token punctuation">:</span> <span class="token string">"16TB NVMe"</span>
      <span class="token key atrule">estimated_cost</span><span class="token punctuation">:</span> <span class="token string">"$75,000+/month"</span>
</code></pre>
</div>
<hr>

        <h2 id="monitoring-and-observability" class="group relative scroll-mt-20 text-2xl font-semibold mb-4 mt-6 border-b border-gray-200 dark:border-gray-700 pb-2">
          <a class="anchor absolute -ml-10 flex items-center opacity-0 group-hover:opacity-100 transition-opacity duration-200" aria-label="Link to this section" href="#monitoring-and-observability">
            <svg class="octicon octicon-link" viewBox="0 0 16 16" aria-hidden="true">
              <path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path>
            </svg>
          </a>
          <span>Monitoring and Observability</span>
        <a href="#/blog/self-managed-elasticsearch-vm-bare-metal-production-guide#monitoring-and-observability" class="header-link" style="opacity: 0; margin-left: 8px; text-decoration: none; color: rgb(107, 114, 128); transition: opacity 0.2s; cursor: pointer;">#</a></h2>
      

        <h3 id="comprehensive-monitoring-stack" class="group relative scroll-mt-20 text-xl font-semibold mb-3 mt-5">
          <a class="anchor absolute -ml-10 flex items-center opacity-0 group-hover:opacity-100 transition-opacity duration-200" aria-label="Link to this section" href="#comprehensive-monitoring-stack">
            <svg class="octicon octicon-link" viewBox="0 0 16 16" aria-hidden="true">
              <path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path>
            </svg>
          </a>
          <span>Comprehensive Monitoring Stack</span>
        <a href="#/blog/self-managed-elasticsearch-vm-bare-metal-production-guide#comprehensive-monitoring-stack" class="header-link" style="opacity: 0; margin-left: 8px; text-decoration: none; color: rgb(107, 114, 128); transition: opacity 0.2s; cursor: pointer;">#</a></h3>
      
<div class="highlight highlight-yaml notranslate" style="background-color: transparent !important; border: none !important; border-radius: 0px !important; padding: 0px !important; margin: 0px !important;">
<pre class="notranslate language-yaml" tabindex="0" style="border-radius: 0.75rem !important; padding: 16px !important; margin: 16px 0px !important; overflow-x: auto !important; font-size: 14px !important; line-height: 1.5 !important; white-space: pre-wrap !important; overflow-wrap: normal !important; text-wrap-style: initial !important; word-break: normal !important;"><code class="language-yaml" style="background: transparent !important; border: none !important; border-radius: 0px !important; font-family: ui-monospace, SFMono-Regular, &quot;SF Mono&quot;, Consolas, &quot;Liberation Mono&quot;, Menlo, monospace !important; font-size: 15px !important; line-height: 1.6 !important; padding: 0px !important; font-weight: 500 !important; text-rendering: geometricprecision !important; -webkit-font-smoothing: subpixel-antialiased !important; letter-spacing: 0.025em !important; white-space: pre-wrap !important; overflow-wrap: normal !important; text-wrap-style: initial !important; word-break: normal !important;"><span class="token comment"># docker-compose.yml for monitoring stack</span>
<span class="token key atrule">version</span><span class="token punctuation">:</span> <span class="token string">'3.8'</span>
<span class="token key atrule">services</span><span class="token punctuation">:</span>
  <span class="token key atrule">prometheus</span><span class="token punctuation">:</span>
    <span class="token key atrule">image</span><span class="token punctuation">:</span> prom/prometheus<span class="token punctuation">:</span>latest
    <span class="token key atrule">container_name</span><span class="token punctuation">:</span> prometheus
    <span class="token key atrule">ports</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token string">"9090:9090"</span>
    <span class="token key atrule">volumes</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> ./monitoring/prometheus<span class="token punctuation">:</span>/etc/prometheus
      <span class="token punctuation">-</span> prometheus_data<span class="token punctuation">:</span>/prometheus
    <span class="token key atrule">command</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token string">'--config.file=/etc/prometheus/prometheus.yml'</span>
      <span class="token punctuation">-</span> <span class="token string">'--storage.tsdb.path=/prometheus'</span>
      <span class="token punctuation">-</span> <span class="token string">'--web.console.libraries=/etc/prometheus/console_libraries'</span>
      <span class="token punctuation">-</span> <span class="token string">'--web.console.templates=/etc/prometheus/consoles'</span>
      <span class="token punctuation">-</span> <span class="token string">'--storage.tsdb.retention.time=30d'</span>
      <span class="token punctuation">-</span> <span class="token string">'--web.enable-lifecycle'</span>
    <span class="token key atrule">networks</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> monitoring

  <span class="token key atrule">grafana</span><span class="token punctuation">:</span>
    <span class="token key atrule">image</span><span class="token punctuation">:</span> grafana/grafana<span class="token punctuation">:</span>latest
    <span class="token key atrule">container_name</span><span class="token punctuation">:</span> grafana
    <span class="token key atrule">ports</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token string">"3000:3000"</span>
    <span class="token key atrule">environment</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> GF_SECURITY_ADMIN_PASSWORD=admin123
    <span class="token key atrule">volumes</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> grafana_data<span class="token punctuation">:</span>/var/lib/grafana
      <span class="token punctuation">-</span> ./monitoring/grafana/dashboards<span class="token punctuation">:</span>/etc/grafana/provisioning/dashboards
      <span class="token punctuation">-</span> ./monitoring/grafana/datasources<span class="token punctuation">:</span>/etc/grafana/provisioning/datasources
    <span class="token key atrule">networks</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> monitoring

  <span class="token key atrule">elasticsearch_exporter</span><span class="token punctuation">:</span>
    <span class="token key atrule">image</span><span class="token punctuation">:</span> quay.io/prometheuscommunity/elasticsearch<span class="token punctuation">-</span>exporter<span class="token punctuation">:</span>latest
    <span class="token key atrule">container_name</span><span class="token punctuation">:</span> elasticsearch_exporter
    <span class="token key atrule">ports</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token string">"9114:9114"</span>
    <span class="token key atrule">command</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token string">'--es.uri=http://elasticsearch:9200'</span>
      <span class="token punctuation">-</span> <span class="token string">'--es.all'</span>
      <span class="token punctuation">-</span> <span class="token string">'--es.indices'</span>
      <span class="token punctuation">-</span> <span class="token string">'--es.shards'</span>
      <span class="token punctuation">-</span> <span class="token string">'--es.cluster_settings'</span>
    <span class="token key atrule">networks</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> monitoring

<span class="token key atrule">volumes</span><span class="token punctuation">:</span>
  <span class="token key atrule">prometheus_data</span><span class="token punctuation">:</span>
  <span class="token key atrule">grafana_data</span><span class="token punctuation">:</span>

<span class="token key atrule">networks</span><span class="token punctuation">:</span>
  <span class="token key atrule">monitoring</span><span class="token punctuation">:</span>
    <span class="token key atrule">driver</span><span class="token punctuation">:</span> bridge
</code></pre>
</div>

        <h3 id="prometheus-configuration" class="group relative scroll-mt-20 text-xl font-semibold mb-3 mt-5">
          <a class="anchor absolute -ml-10 flex items-center opacity-0 group-hover:opacity-100 transition-opacity duration-200" aria-label="Link to this section" href="#prometheus-configuration">
            <svg class="octicon octicon-link" viewBox="0 0 16 16" aria-hidden="true">
              <path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path>
            </svg>
          </a>
          <span>Prometheus Configuration</span>
        <a href="#/blog/self-managed-elasticsearch-vm-bare-metal-production-guide#prometheus-configuration" class="header-link" style="opacity: 0; margin-left: 8px; text-decoration: none; color: rgb(107, 114, 128); transition: opacity 0.2s; cursor: pointer;">#</a></h3>
      
<div class="highlight highlight-yaml notranslate" style="background-color: transparent !important; border: none !important; border-radius: 0px !important; padding: 0px !important; margin: 0px !important;">
<pre class="notranslate language-yaml" tabindex="0" style="border-radius: 0.75rem !important; padding: 16px !important; margin: 16px 0px !important; overflow-x: auto !important; font-size: 14px !important; line-height: 1.5 !important; white-space: pre-wrap !important; overflow-wrap: normal !important; text-wrap-style: initial !important; word-break: normal !important;"><code class="language-yaml" style="background: transparent !important; border: none !important; border-radius: 0px !important; font-family: ui-monospace, SFMono-Regular, &quot;SF Mono&quot;, Consolas, &quot;Liberation Mono&quot;, Menlo, monospace !important; font-size: 15px !important; line-height: 1.6 !important; padding: 0px !important; font-weight: 500 !important; text-rendering: geometricprecision !important; -webkit-font-smoothing: subpixel-antialiased !important; letter-spacing: 0.025em !important; white-space: pre-wrap !important; overflow-wrap: normal !important; text-wrap-style: initial !important; word-break: normal !important;"><span class="token comment"># monitoring/prometheus/prometheus.yml</span>
<span class="token key atrule">global</span><span class="token punctuation">:</span>
  <span class="token key atrule">scrape_interval</span><span class="token punctuation">:</span> 15s
  <span class="token key atrule">evaluation_interval</span><span class="token punctuation">:</span> 15s

<span class="token key atrule">rule_files</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token string">"elasticsearch_rules.yml"</span>

<span class="token key atrule">alerting</span><span class="token punctuation">:</span>
  <span class="token key atrule">alertmanagers</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">static_configs</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">targets</span><span class="token punctuation">:</span>
          <span class="token punctuation">-</span> alertmanager<span class="token punctuation">:</span><span class="token number">9093</span>

<span class="token key atrule">scrape_configs</span><span class="token punctuation">:</span>
  <span class="token comment"># Elasticsearch cluster metrics</span>
  <span class="token punctuation">-</span> <span class="token key atrule">job_name</span><span class="token punctuation">:</span> <span class="token string">'elasticsearch-cluster'</span>
    <span class="token key atrule">static_configs</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">targets</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token string">'es-master-01:9200'</span>
        <span class="token punctuation">-</span> <span class="token string">'es-master-02:9200'</span>
        <span class="token punctuation">-</span> <span class="token string">'es-master-03:9200'</span>
        <span class="token punctuation">-</span> <span class="token string">'es-data-01:9200'</span>
        <span class="token punctuation">-</span> <span class="token string">'es-data-02:9200'</span>
        <span class="token punctuation">-</span> <span class="token string">'es-data-03:9200'</span>
    <span class="token key atrule">metrics_path</span><span class="token punctuation">:</span> <span class="token string">'/_prometheus/metrics'</span>
    <span class="token key atrule">scrape_interval</span><span class="token punctuation">:</span> 30s

  <span class="token comment"># Node exporter for system metrics</span>
  <span class="token punctuation">-</span> <span class="token key atrule">job_name</span><span class="token punctuation">:</span> <span class="token string">'node-exporter'</span>
    <span class="token key atrule">static_configs</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">targets</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token string">'es-master-01:9100'</span>
        <span class="token punctuation">-</span> <span class="token string">'es-master-02:9100'</span>
        <span class="token punctuation">-</span> <span class="token string">'es-master-03:9100'</span>
        <span class="token punctuation">-</span> <span class="token string">'es-data-01:9100'</span>
        <span class="token punctuation">-</span> <span class="token string">'es-data-02:9100'</span>
        <span class="token punctuation">-</span> <span class="token string">'es-data-03:9100'</span>
    <span class="token key atrule">scrape_interval</span><span class="token punctuation">:</span> 15s

  <span class="token comment"># Elasticsearch exporter</span>
  <span class="token punctuation">-</span> <span class="token key atrule">job_name</span><span class="token punctuation">:</span> <span class="token string">'elasticsearch-exporter'</span>
    <span class="token key atrule">static_configs</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">targets</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token string">'elasticsearch_exporter:9114'</span>
    <span class="token key atrule">scrape_interval</span><span class="token punctuation">:</span> 30s
</code></pre>
</div>

        <h3 id="elasticsearch-alerting-rules" class="group relative scroll-mt-20 text-xl font-semibold mb-3 mt-5">
          <a class="anchor absolute -ml-10 flex items-center opacity-0 group-hover:opacity-100 transition-opacity duration-200" aria-label="Link to this section" href="#elasticsearch-alerting-rules">
            <svg class="octicon octicon-link" viewBox="0 0 16 16" aria-hidden="true">
              <path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path>
            </svg>
          </a>
          <span>Elasticsearch Alerting Rules</span>
        <a href="#/blog/self-managed-elasticsearch-vm-bare-metal-production-guide#elasticsearch-alerting-rules" class="header-link" style="opacity: 0; margin-left: 8px; text-decoration: none; color: rgb(107, 114, 128); transition: opacity 0.2s; cursor: pointer;">#</a></h3>
      
<div class="highlight highlight-yaml notranslate" style="background-color: transparent !important; border: none !important; border-radius: 0px !important; padding: 0px !important; margin: 0px !important;">
<pre class="notranslate language-yaml" tabindex="0" style="border-radius: 0.75rem !important; padding: 16px !important; margin: 16px 0px !important; overflow-x: auto !important; font-size: 14px !important; line-height: 1.5 !important; white-space: pre-wrap !important; overflow-wrap: normal !important; text-wrap-style: initial !important; word-break: normal !important;"><code class="language-yaml" style="background: transparent !important; border: none !important; border-radius: 0px !important; font-family: ui-monospace, SFMono-Regular, &quot;SF Mono&quot;, Consolas, &quot;Liberation Mono&quot;, Menlo, monospace !important; font-size: 15px !important; line-height: 1.6 !important; padding: 0px !important; font-weight: 500 !important; text-rendering: geometricprecision !important; -webkit-font-smoothing: subpixel-antialiased !important; letter-spacing: 0.025em !important; white-space: pre-wrap !important; overflow-wrap: normal !important; text-wrap-style: initial !important; word-break: normal !important;"><span class="token comment"># monitoring/prometheus/elasticsearch_rules.yml</span>
<span class="token key atrule">groups</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> elasticsearch.rules
    <span class="token key atrule">rules</span><span class="token punctuation">:</span>
      <span class="token comment"># Cluster health alerts</span>
      <span class="token punctuation">-</span> <span class="token key atrule">alert</span><span class="token punctuation">:</span> ElasticsearchClusterRed
        <span class="token key atrule">expr</span><span class="token punctuation">:</span> elasticsearch_cluster_health_status<span class="token punctuation">{</span>color="red"<span class="token punctuation">}</span> == 1
        <span class="token key atrule">for</span><span class="token punctuation">:</span> 0m
        <span class="token key atrule">labels</span><span class="token punctuation">:</span>
          <span class="token key atrule">severity</span><span class="token punctuation">:</span> critical
        <span class="token key atrule">annotations</span><span class="token punctuation">:</span>
          <span class="token key atrule">summary</span><span class="token punctuation">:</span> <span class="token string">"Elasticsearch cluster status is RED"</span>
          <span class="token key atrule">description</span><span class="token punctuation">:</span> <span class="token string">"Cluster {{ $labels.cluster }} health is RED. Some primary shards are unallocated."</span>

      <span class="token punctuation">-</span> <span class="token key atrule">alert</span><span class="token punctuation">:</span> ElasticsearchClusterYellow
        <span class="token key atrule">expr</span><span class="token punctuation">:</span> elasticsearch_cluster_health_status<span class="token punctuation">{</span>color="yellow"<span class="token punctuation">}</span> == 1
        <span class="token key atrule">for</span><span class="token punctuation">:</span> 5m
        <span class="token key atrule">labels</span><span class="token punctuation">:</span>
          <span class="token key atrule">severity</span><span class="token punctuation">:</span> warning
        <span class="token key atrule">annotations</span><span class="token punctuation">:</span>
          <span class="token key atrule">summary</span><span class="token punctuation">:</span> <span class="token string">"Elasticsearch cluster status is YELLOW"</span>
          <span class="token key atrule">description</span><span class="token punctuation">:</span> <span class="token string">"Cluster {{ $labels.cluster }} health is YELLOW. Some replica shards are unallocated."</span>

      <span class="token comment"># Performance alerts</span>
      <span class="token punctuation">-</span> <span class="token key atrule">alert</span><span class="token punctuation">:</span> ElasticsearchHighQueryLatency
        <span class="token key atrule">expr</span><span class="token punctuation">:</span> elasticsearch_indices_search_query_time_seconds <span class="token punctuation">&gt;</span> 1
        <span class="token key atrule">for</span><span class="token punctuation">:</span> 2m
        <span class="token key atrule">labels</span><span class="token punctuation">:</span>
          <span class="token key atrule">severity</span><span class="token punctuation">:</span> warning
        <span class="token key atrule">annotations</span><span class="token punctuation">:</span>
          <span class="token key atrule">summary</span><span class="token punctuation">:</span> <span class="token string">"High Elasticsearch query latency"</span>
          <span class="token key atrule">description</span><span class="token punctuation">:</span> <span class="token string">"Query latency is {{ $value }}s on {{ $labels.instance }}"</span>

      <span class="token punctuation">-</span> <span class="token key atrule">alert</span><span class="token punctuation">:</span> ElasticsearchHighIndexingLatency
        <span class="token key atrule">expr</span><span class="token punctuation">:</span> elasticsearch_indices_indexing_index_time_seconds <span class="token punctuation">&gt;</span> 0.5
        <span class="token key atrule">for</span><span class="token punctuation">:</span> 2m
        <span class="token key atrule">labels</span><span class="token punctuation">:</span>
          <span class="token key atrule">severity</span><span class="token punctuation">:</span> warning
        <span class="token key atrule">annotations</span><span class="token punctuation">:</span>
          <span class="token key atrule">summary</span><span class="token punctuation">:</span> <span class="token string">"High Elasticsearch indexing latency"</span>
          <span class="token key atrule">description</span><span class="token punctuation">:</span> <span class="token string">"Indexing latency is {{ $value }}s on {{ $labels.instance }}"</span>

      <span class="token comment"># Resource alerts</span>
      <span class="token punctuation">-</span> <span class="token key atrule">alert</span><span class="token punctuation">:</span> ElasticsearchHighHeapUsage
        <span class="token key atrule">expr</span><span class="token punctuation">:</span> elasticsearch_jvm_memory_used_bytes<span class="token punctuation">{</span>area="heap"<span class="token punctuation">}</span> / elasticsearch_jvm_memory_max_bytes<span class="token punctuation">{</span>area="heap"<span class="token punctuation">}</span> <span class="token punctuation">&gt;</span> 0.85
        <span class="token key atrule">for</span><span class="token punctuation">:</span> 2m
        <span class="token key atrule">labels</span><span class="token punctuation">:</span>
          <span class="token key atrule">severity</span><span class="token punctuation">:</span> warning
        <span class="token key atrule">annotations</span><span class="token punctuation">:</span>
          <span class="token key atrule">summary</span><span class="token punctuation">:</span> <span class="token string">"High Elasticsearch heap usage"</span>
          <span class="token key atrule">description</span><span class="token punctuation">:</span> <span class="token string">"Heap usage is {{ $value | humanizePercentage }} on {{ $labels.instance }}"</span>

      <span class="token punctuation">-</span> <span class="token key atrule">alert</span><span class="token punctuation">:</span> ElasticsearchDiskSpaceLow
        <span class="token key atrule">expr</span><span class="token punctuation">:</span> (elasticsearch_filesystem_data_size_bytes <span class="token punctuation">-</span> elasticsearch_filesystem_data_free_bytes) / elasticsearch_filesystem_data_size_bytes <span class="token punctuation">&gt;</span> 0.85
        <span class="token key atrule">for</span><span class="token punctuation">:</span> 1m
        <span class="token key atrule">labels</span><span class="token punctuation">:</span>
          <span class="token key atrule">severity</span><span class="token punctuation">:</span> warning
        <span class="token key atrule">annotations</span><span class="token punctuation">:</span>
          <span class="token key atrule">summary</span><span class="token punctuation">:</span> <span class="token string">"Elasticsearch disk space low"</span>
          <span class="token key atrule">description</span><span class="token punctuation">:</span> <span class="token string">"Disk usage is {{ $value | humanizePercentage }} on {{ $labels.instance }}"</span>

      <span class="token comment"># Node alerts</span>
      <span class="token punctuation">-</span> <span class="token key atrule">alert</span><span class="token punctuation">:</span> ElasticsearchNodeDown
        <span class="token key atrule">expr</span><span class="token punctuation">:</span> up<span class="token punctuation">{</span>job="elasticsearch<span class="token punctuation">-</span>cluster"<span class="token punctuation">}</span> == 0
        <span class="token key atrule">for</span><span class="token punctuation">:</span> 1m
        <span class="token key atrule">labels</span><span class="token punctuation">:</span>
          <span class="token key atrule">severity</span><span class="token punctuation">:</span> critical
        <span class="token key atrule">annotations</span><span class="token punctuation">:</span>
          <span class="token key atrule">summary</span><span class="token punctuation">:</span> <span class="token string">"Elasticsearch node is down"</span>
          <span class="token key atrule">description</span><span class="token punctuation">:</span> <span class="token string">"Elasticsearch node {{ $labels.instance }} is down"</span>

      <span class="token punctuation">-</span> <span class="token key atrule">alert</span><span class="token punctuation">:</span> ElasticsearchTooManyUnassignedShards
        <span class="token key atrule">expr</span><span class="token punctuation">:</span> elasticsearch_cluster_health_unassigned_shards <span class="token punctuation">&gt;</span> 0
        <span class="token key atrule">for</span><span class="token punctuation">:</span> 5m
        <span class="token key atrule">labels</span><span class="token punctuation">:</span>
          <span class="token key atrule">severity</span><span class="token punctuation">:</span> warning
        <span class="token key atrule">annotations</span><span class="token punctuation">:</span>
          <span class="token key atrule">summary</span><span class="token punctuation">:</span> <span class="token string">"Too many unassigned shards"</span>
          <span class="token key atrule">description</span><span class="token punctuation">:</span> <span class="token string">"There are {{ $value }} unassigned shards in cluster {{ $labels.cluster }}"</span>
</code></pre>
</div>

        <h3 id="custom-monitoring-script" class="group relative scroll-mt-20 text-xl font-semibold mb-3 mt-5">
          <a class="anchor absolute -ml-10 flex items-center opacity-0 group-hover:opacity-100 transition-opacity duration-200" aria-label="Link to this section" href="#custom-monitoring-script">
            <svg class="octicon octicon-link" viewBox="0 0 16 16" aria-hidden="true">
              <path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path>
            </svg>
          </a>
          <span>Custom Monitoring Script</span>
        <a href="#/blog/self-managed-elasticsearch-vm-bare-metal-production-guide#custom-monitoring-script" class="header-link" style="opacity: 0; margin-left: 8px; text-decoration: none; color: rgb(107, 114, 128); transition: opacity 0.2s; cursor: pointer;">#</a></h3>
      
<div class="highlight highlight-bash notranslate" style="background-color: transparent !important; border: none !important; border-radius: 0px !important; padding: 0px !important; margin: 0px !important;">
<pre class="notranslate language-bash" tabindex="0" style="border-radius: 0.75rem !important; padding: 16px !important; margin: 16px 0px !important; overflow-x: auto !important; font-size: 14px !important; line-height: 1.5 !important; white-space: pre-wrap !important; overflow-wrap: normal !important; text-wrap-style: initial !important; word-break: normal !important;"><code class="language-bash" style="background: transparent !important; border: none !important; border-radius: 0px !important; font-family: ui-monospace, SFMono-Regular, &quot;SF Mono&quot;, Consolas, &quot;Liberation Mono&quot;, Menlo, monospace !important; font-size: 15px !important; line-height: 1.6 !important; padding: 0px !important; font-weight: 500 !important; text-rendering: geometricprecision !important; -webkit-font-smoothing: subpixel-antialiased !important; letter-spacing: 0.025em !important; white-space: pre-wrap !important; overflow-wrap: normal !important; text-wrap-style: initial !important; word-break: normal !important;"><span class="token shebang important">#!/bin/bash</span>
<span class="token comment"># elasticsearch_health_monitor.sh</span>

<span class="token assign-left variable">CLUSTER_ENDPOINT</span><span class="token operator">=</span><span class="token string">"http://localhost:9200"</span>
<span class="token assign-left variable">SLACK_WEBHOOK</span><span class="token operator">=</span><span class="token string">"https://hooks.slack.com/services/YOUR/SLACK/WEBHOOK"</span>
<span class="token assign-left variable">LOG_FILE</span><span class="token operator">=</span><span class="token string">"/var/log/elasticsearch_monitor.log"</span>

<span class="token comment"># Function to send Slack notification</span>
<span class="token function-name function">send_slack_notification</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token builtin class-name">local</span> <span class="token assign-left variable">message</span><span class="token operator">=</span><span class="token variable">$1</span>
    <span class="token builtin class-name">local</span> <span class="token assign-left variable">color</span><span class="token operator">=</span><span class="token variable">$2</span>
    
    <span class="token function">curl</span> <span class="token parameter variable">-X</span> POST <span class="token parameter variable">-H</span> <span class="token string">'Content-type: application/json'</span> <span class="token punctuation">\</span>
        <span class="token parameter variable">--data</span> <span class="token string">"{<span class="token entity" title="\&quot;">\"</span>attachments<span class="token entity" title="\&quot;">\"</span>:[{<span class="token entity" title="\&quot;">\"</span>color<span class="token entity" title="\&quot;">\"</span>:<span class="token entity" title="\&quot;">\"</span><span class="token variable">$color</span><span class="token entity" title="\&quot;">\"</span>,<span class="token entity" title="\&quot;">\"</span>text<span class="token entity" title="\&quot;">\"</span>:<span class="token entity" title="\&quot;">\"</span><span class="token variable">$message</span><span class="token entity" title="\&quot;">\"</span>}]}"</span> <span class="token punctuation">\</span>
        <span class="token string">"<span class="token variable">$SLACK_WEBHOOK</span>"</span>
<span class="token punctuation">}</span>

<span class="token comment"># Function to log with timestamp</span>
<span class="token function-name function">log_message</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token builtin class-name">echo</span> <span class="token string">"<span class="token variable"><span class="token variable">$(</span><span class="token function">date</span> <span class="token string">'+%Y-%m-%d %H:%M:%S'</span><span class="token variable">)</span></span> - <span class="token variable">$1</span>"</span> <span class="token operator">&gt;&gt;</span> <span class="token string">"<span class="token variable">$LOG_FILE</span>"</span>
<span class="token punctuation">}</span>

<span class="token comment"># Check cluster health</span>
<span class="token function-name function">check_cluster_health</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token builtin class-name">local</span> <span class="token assign-left variable">health_response</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token function">curl</span> <span class="token parameter variable">-s</span> <span class="token string">"<span class="token variable">$CLUSTER_ENDPOINT</span>/_cluster/health"</span><span class="token variable">)</span></span>
    <span class="token builtin class-name">local</span> <span class="token assign-left variable">status</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token builtin class-name">echo</span> <span class="token string">"<span class="token variable">$health_response</span>"</span> <span class="token operator">|</span> jq <span class="token parameter variable">-r</span> <span class="token string">'.status'</span><span class="token variable">)</span></span>
    <span class="token builtin class-name">local</span> <span class="token assign-left variable">active_shards</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token builtin class-name">echo</span> <span class="token string">"<span class="token variable">$health_response</span>"</span> <span class="token operator">|</span> jq <span class="token parameter variable">-r</span> <span class="token string">'.active_shards'</span><span class="token variable">)</span></span>
    <span class="token builtin class-name">local</span> <span class="token assign-left variable">relocating_shards</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token builtin class-name">echo</span> <span class="token string">"<span class="token variable">$health_response</span>"</span> <span class="token operator">|</span> jq <span class="token parameter variable">-r</span> <span class="token string">'.relocating_shards'</span><span class="token variable">)</span></span>
    <span class="token builtin class-name">local</span> <span class="token assign-left variable">unassigned_shards</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token builtin class-name">echo</span> <span class="token string">"<span class="token variable">$health_response</span>"</span> <span class="token operator">|</span> jq <span class="token parameter variable">-r</span> <span class="token string">'.unassigned_shards'</span><span class="token variable">)</span></span>
    
    <span class="token keyword">case</span> <span class="token variable">$status</span> <span class="token keyword">in</span>
        <span class="token string">"green"</span><span class="token punctuation">)</span>
            log_message <span class="token string">"Cluster health: GREEN - <span class="token variable">$active_shards</span> active shards"</span>
            <span class="token punctuation">;</span><span class="token punctuation">;</span>
        <span class="token string">"yellow"</span><span class="token punctuation">)</span>
            log_message <span class="token string">"Cluster health: YELLOW - <span class="token variable">$unassigned_shards</span> unassigned shards"</span>
            send_slack_notification <span class="token string">" Elasticsearch cluster is YELLOW: <span class="token variable">$unassigned_shards</span> unassigned shards"</span> <span class="token string">"warning"</span>
            <span class="token punctuation">;</span><span class="token punctuation">;</span>
        <span class="token string">"red"</span><span class="token punctuation">)</span>
            log_message <span class="token string">"Cluster health: RED - Critical issue detected"</span>
            send_slack_notification <span class="token string">" Elasticsearch cluster is RED: Critical issue detected"</span> <span class="token string">"danger"</span>
            <span class="token punctuation">;</span><span class="token punctuation">;</span>
    <span class="token keyword">esac</span>
<span class="token punctuation">}</span>

<span class="token comment"># Check node performance</span>
<span class="token function-name function">check_node_performance</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token builtin class-name">local</span> <span class="token assign-left variable">nodes_stats</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token function">curl</span> <span class="token parameter variable">-s</span> <span class="token string">"<span class="token variable">$CLUSTER_ENDPOINT</span>/_nodes/stats"</span><span class="token variable">)</span></span>
    
    <span class="token comment"># Check heap usage</span>
    <span class="token builtin class-name">echo</span> <span class="token string">"<span class="token variable">$nodes_stats</span>"</span> <span class="token operator">|</span> jq <span class="token parameter variable">-r</span> <span class="token string">'.nodes | to_entries[] | 
        select(.value.jvm.mem.heap_used_percent &gt; 85) | 
        "Node " + .value.name + " heap usage: " + (.value.jvm.mem.heap_used_percent | tostring) + "%"'</span> <span class="token operator">|</span> 
    <span class="token keyword">while</span> <span class="token builtin class-name">read</span> <span class="token parameter variable">-r</span> line<span class="token punctuation">;</span> <span class="token keyword">do</span>
        <span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token parameter variable">-n</span> <span class="token string">"<span class="token variable">$line</span>"</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
            log_message <span class="token string">"High heap usage: <span class="token variable">$line</span>"</span>
            send_slack_notification <span class="token string">" <span class="token variable">$line</span>"</span> <span class="token string">"warning"</span>
        <span class="token keyword">fi</span>
    <span class="token keyword">done</span>
    
    <span class="token comment"># Check disk usage</span>
    <span class="token builtin class-name">echo</span> <span class="token string">"<span class="token variable">$nodes_stats</span>"</span> <span class="token operator">|</span> jq <span class="token parameter variable">-r</span> <span class="token string">'.nodes | to_entries[] |
        .value.fs.total | 
        select(.available_in_bytes / .total_in_bytes &lt; 0.15) |
        "Node " + .key + " disk usage critical: " + 
        (((.total_in_bytes - .available_in_bytes) / .total_in_bytes * 100) | floor | tostring) + "% used"'</span> <span class="token operator">|</span>
    <span class="token keyword">while</span> <span class="token builtin class-name">read</span> <span class="token parameter variable">-r</span> line<span class="token punctuation">;</span> <span class="token keyword">do</span>
        <span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token parameter variable">-n</span> <span class="token string">"<span class="token variable">$line</span>"</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
            log_message <span class="token string">"Critical disk usage: <span class="token variable">$line</span>"</span>
            send_slack_notification <span class="token string">" <span class="token variable">$line</span>"</span> <span class="token string">"danger"</span>
        <span class="token keyword">fi</span>
    <span class="token keyword">done</span>
<span class="token punctuation">}</span>

<span class="token comment"># Check for failed queries</span>
<span class="token function-name function">check_query_failures</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token builtin class-name">local</span> <span class="token assign-left variable">indices_stats</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token function">curl</span> <span class="token parameter variable">-s</span> <span class="token string">"<span class="token variable">$CLUSTER_ENDPOINT</span>/_stats"</span><span class="token variable">)</span></span>
    <span class="token builtin class-name">local</span> <span class="token assign-left variable">query_failures</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token builtin class-name">echo</span> <span class="token string">"<span class="token variable">$indices_stats</span>"</span> <span class="token operator">|</span> jq <span class="token parameter variable">-r</span> <span class="token string">'._all.total.search.query_failures'</span><span class="token variable">)</span></span>
    
    <span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token string">"<span class="token variable">$query_failures</span>"</span> <span class="token parameter variable">-gt</span> <span class="token number">0</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
        log_message <span class="token string">"Query failures detected: <span class="token variable">$query_failures</span>"</span>
        send_slack_notification <span class="token string">" Elasticsearch query failures: <span class="token variable">$query_failures</span> total failures"</span> <span class="token string">"warning"</span>
    <span class="token keyword">fi</span>
<span class="token punctuation">}</span>

<span class="token comment"># Main monitoring loop</span>
<span class="token function-name function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    log_message <span class="token string">"Starting Elasticsearch health check"</span>
    
    check_cluster_health
    check_node_performance
    check_query_failures
    
    log_message <span class="token string">"Health check completed"</span>
<span class="token punctuation">}</span>

<span class="token comment"># Run the monitoring</span>
main
</code></pre>
</div>
<hr>

        <h2 id="security-implementation" class="group relative scroll-mt-20 text-2xl font-semibold mb-4 mt-6 border-b border-gray-200 dark:border-gray-700 pb-2">
          <a class="anchor absolute -ml-10 flex items-center opacity-0 group-hover:opacity-100 transition-opacity duration-200" aria-label="Link to this section" href="#security-implementation">
            <svg class="octicon octicon-link" viewBox="0 0 16 16" aria-hidden="true">
              <path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path>
            </svg>
          </a>
          <span>Security Implementation</span>
        <a href="#/blog/self-managed-elasticsearch-vm-bare-metal-production-guide#security-implementation" class="header-link" style="opacity: 0; margin-left: 8px; text-decoration: none; color: rgb(107, 114, 128); transition: opacity 0.2s; cursor: pointer;">#</a></h2>
      

        <h3 id="advanced-security-configuration" class="group relative scroll-mt-20 text-xl font-semibold mb-3 mt-5">
          <a class="anchor absolute -ml-10 flex items-center opacity-0 group-hover:opacity-100 transition-opacity duration-200" aria-label="Link to this section" href="#advanced-security-configuration">
            <svg class="octicon octicon-link" viewBox="0 0 16 16" aria-hidden="true">
              <path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path>
            </svg>
          </a>
          <span>Advanced Security Configuration</span>
        <a href="#/blog/self-managed-elasticsearch-vm-bare-metal-production-guide#advanced-security-configuration" class="header-link" style="opacity: 0; margin-left: 8px; text-decoration: none; color: rgb(107, 114, 128); transition: opacity 0.2s; cursor: pointer;">#</a></h3>
      
<div class="highlight highlight-bash notranslate" style="background-color: transparent !important; border: none !important; border-radius: 0px !important; padding: 0px !important; margin: 0px !important;">
<pre class="notranslate language-bash" tabindex="0" style="border-radius: 0.75rem !important; padding: 16px !important; margin: 16px 0px !important; overflow-x: auto !important; font-size: 14px !important; line-height: 1.5 !important; white-space: pre-wrap !important; overflow-wrap: normal !important; text-wrap-style: initial !important; word-break: normal !important;"><code class="language-bash" style="background: transparent !important; border: none !important; border-radius: 0px !important; font-family: ui-monospace, SFMono-Regular, &quot;SF Mono&quot;, Consolas, &quot;Liberation Mono&quot;, Menlo, monospace !important; font-size: 15px !important; line-height: 1.6 !important; padding: 0px !important; font-weight: 500 !important; text-rendering: geometricprecision !important; -webkit-font-smoothing: subpixel-antialiased !important; letter-spacing: 0.025em !important; white-space: pre-wrap !important; overflow-wrap: normal !important; text-wrap-style: initial !important; word-break: normal !important;"><span class="token comment"># Advanced security setup script</span>
<span class="token comment">#!/bin/bash</span>

<span class="token comment"># Generate certificates for TLS</span>
./bin/elasticsearch-certutil ca <span class="token parameter variable">--silent</span> <span class="token parameter variable">--pem</span>
<span class="token function">unzip</span> elastic-stack-ca.zip
./bin/elasticsearch-certutil cert <span class="token parameter variable">--silent</span> <span class="token parameter variable">--pem</span> --ca-cert ca/ca.crt --ca-key ca/ca.key <span class="token parameter variable">--dns</span> localhost <span class="token parameter variable">--dns</span> es-master-01 <span class="token parameter variable">--dns</span> es-master-02 <span class="token parameter variable">--dns</span> es-master-03

<span class="token comment"># Configure TLS for HTTP and transport</span>
<span class="token function">cat</span> <span class="token operator">&gt;&gt;</span> /etc/elasticsearch/elasticsearch.yml <span class="token operator">&lt;&lt;</span> <span class="token string">EOF
# TLS Configuration
xpack.security.enabled: true
xpack.security.enrollment.enabled: true

# Transport layer security
xpack.security.transport.ssl.enabled: true
xpack.security.transport.ssl.verification_mode: certificate
xpack.security.transport.ssl.client_authentication: required
xpack.security.transport.ssl.keystore.path: certs/elastic-certificates.p12
xpack.security.transport.ssl.truststore.path: certs/elastic-certificates.p12

# HTTP layer security
xpack.security.http.ssl.enabled: true
xpack.security.http.ssl.keystore.path: certs/elastic-certificates.p12

# Audit logging
xpack.security.audit.enabled: true
xpack.security.audit.logfile.events.emit_request_body: true
xpack.security.audit.logfile.events.include:
  - access_denied
  - access_granted
  - anonymous_access_denied
  - authentication_failed
  - authentication_success
  - change_password
  - connection_denied
  - connection_granted
  - tampered_request
  - run_as_denied
  - run_as_granted

# IP filtering
xpack.security.http.filter.allow: ["10.0.0.0/8", "172.16.0.0/12", "192.168.0.0/16"]
xpack.security.http.filter.deny: "_all"
EOF</span>

<span class="token comment"># Set up role-based access control</span>
<span class="token function">cat</span> <span class="token operator">&gt;</span> /tmp/setup_security.sh <span class="token operator">&lt;&lt;</span> <span class="token string">'EOF'
#!/bin/bash

# Wait for Elasticsearch to start
until curl -s http://localhost:9200 &gt;/dev/null; do
    echo "Waiting for Elasticsearch..."
    sleep 5
done

# Set passwords for built-in users
/usr/share/elasticsearch/bin/elasticsearch-setup-passwords auto --batch

# Create custom roles
curl -X POST "localhost:9200/_security/role/logs_reader" \
     -H "Content-Type: application/json" \
     -u elastic:$ELASTIC_PASSWORD \
     -d '{
       "cluster": ["monitor"],
       "indices": [
         {
           "names": ["logs-*"],
           "privileges": ["read", "view_index_metadata"],
           "field_security": {
             "grant": ["*"],
             "except": ["sensitive_data"]
           },
           "query": {
             "term": {
               "department": "{{ctx.security.user.metadata.department}}"
             }
           }
         }
       ]
     }'

# Create custom role for application monitoring
curl -X POST "localhost:9200/_security/role/app_monitor" \
     -H "Content-Type: application/json" \
     -u elastic:$ELASTIC_PASSWORD \
     -d '{
       "cluster": ["monitor", "manage_ilm"],
       "indices": [
         {
           "names": ["app-*", "metrics-*"],
           "privileges": ["read", "write", "create_index", "manage"]
         }
       ]
     }'

# Create service accounts
curl -X POST "localhost:9200/_security/user/log_shipper" \
     -H "Content-Type: application/json" \
     -u elastic:$ELASTIC_PASSWORD \
     -d '{
       "password": "SecureLogShipperPassword123!",
       "roles": ["app_monitor"],
       "full_name": "Log Shipping Service",
       "metadata": {
         "department": "infrastructure"
       }
     }'

curl -X POST "localhost:9200/_security/user/readonly_analyst" \
     -H "Content-Type: application/json" \
     -u elastic:$ELASTIC_PASSWORD \
     -d '{
       "password": "AnalystReadOnlyPassword123!",
       "roles": ["logs_reader"],
       "full_name": "Data Analyst",
       "metadata": {
         "department": "analytics"
       }
     }'

echo "Security setup completed successfully"
EOF</span>

<span class="token function">chmod</span> +x /tmp/setup_security.sh
/tmp/setup_security.sh
</code></pre>
</div>

        <h3 id="network-security-configuration" class="group relative scroll-mt-20 text-xl font-semibold mb-3 mt-5">
          <a class="anchor absolute -ml-10 flex items-center opacity-0 group-hover:opacity-100 transition-opacity duration-200" aria-label="Link to this section" href="#network-security-configuration">
            <svg class="octicon octicon-link" viewBox="0 0 16 16" aria-hidden="true">
              <path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path>
            </svg>
          </a>
          <span>Network Security Configuration</span>
        <a href="#/blog/self-managed-elasticsearch-vm-bare-metal-production-guide#network-security-configuration" class="header-link" style="opacity: 0; margin-left: 8px; text-decoration: none; color: rgb(107, 114, 128); transition: opacity 0.2s; cursor: pointer;">#</a></h3>
      
<div class="highlight highlight-bash notranslate" style="background-color: transparent !important; border: none !important; border-radius: 0px !important; padding: 0px !important; margin: 0px !important;">
<pre class="notranslate language-bash" tabindex="0" style="border-radius: 0.75rem !important; padding: 16px !important; margin: 16px 0px !important; overflow-x: auto !important; font-size: 14px !important; line-height: 1.5 !important; white-space: pre-wrap !important; overflow-wrap: normal !important; text-wrap-style: initial !important; word-break: normal !important;"><code class="language-bash" style="background: transparent !important; border: none !important; border-radius: 0px !important; font-family: ui-monospace, SFMono-Regular, &quot;SF Mono&quot;, Consolas, &quot;Liberation Mono&quot;, Menlo, monospace !important; font-size: 15px !important; line-height: 1.6 !important; padding: 0px !important; font-weight: 500 !important; text-rendering: geometricprecision !important; -webkit-font-smoothing: subpixel-antialiased !important; letter-spacing: 0.025em !important; white-space: pre-wrap !important; overflow-wrap: normal !important; text-wrap-style: initial !important; word-break: normal !important;"><span class="token comment"># iptables rules for Elasticsearch security</span>
<span class="token comment">#!/bin/bash</span>

<span class="token comment"># Flush existing rules</span>
iptables <span class="token parameter variable">-F</span>
iptables <span class="token parameter variable">-X</span>
iptables <span class="token parameter variable">-t</span> nat <span class="token parameter variable">-F</span>
iptables <span class="token parameter variable">-t</span> nat <span class="token parameter variable">-X</span>

<span class="token comment"># Set default policies</span>
iptables <span class="token parameter variable">-P</span> INPUT DROP
iptables <span class="token parameter variable">-P</span> FORWARD DROP
iptables <span class="token parameter variable">-P</span> OUTPUT ACCEPT

<span class="token comment"># Allow loopback traffic</span>
iptables <span class="token parameter variable">-A</span> INPUT <span class="token parameter variable">-i</span> lo <span class="token parameter variable">-j</span> ACCEPT

<span class="token comment"># Allow established connections</span>
iptables <span class="token parameter variable">-A</span> INPUT <span class="token parameter variable">-m</span> state <span class="token parameter variable">--state</span> RELATED,ESTABLISHED <span class="token parameter variable">-j</span> ACCEPT

<span class="token comment"># Allow SSH from management network</span>
iptables <span class="token parameter variable">-A</span> INPUT <span class="token parameter variable">-p</span> tcp <span class="token parameter variable">--dport</span> <span class="token number">22</span> <span class="token parameter variable">-s</span> <span class="token number">10.0</span>.0.0/8 <span class="token parameter variable">-j</span> ACCEPT

<span class="token comment"># Allow Elasticsearch HTTP from application servers</span>
iptables <span class="token parameter variable">-A</span> INPUT <span class="token parameter variable">-p</span> tcp <span class="token parameter variable">--dport</span> <span class="token number">9200</span> <span class="token parameter variable">-s</span> <span class="token number">10.0</span>.10.0/24 <span class="token parameter variable">-j</span> ACCEPT

<span class="token comment"># Allow Elasticsearch transport between cluster nodes</span>
iptables <span class="token parameter variable">-A</span> INPUT <span class="token parameter variable">-p</span> tcp <span class="token parameter variable">--dport</span> <span class="token number">9300</span> <span class="token parameter variable">-s</span> <span class="token number">10.0</span>.1.0/24 <span class="token parameter variable">-j</span> ACCEPT

<span class="token comment"># Allow monitoring from Prometheus</span>
iptables <span class="token parameter variable">-A</span> INPUT <span class="token parameter variable">-p</span> tcp <span class="token parameter variable">--dport</span> <span class="token number">9114</span> <span class="token parameter variable">-s</span> <span class="token number">10.0</span>.5.0/24 <span class="token parameter variable">-j</span> ACCEPT

<span class="token comment"># Allow node exporter from monitoring</span>
iptables <span class="token parameter variable">-A</span> INPUT <span class="token parameter variable">-p</span> tcp <span class="token parameter variable">--dport</span> <span class="token number">9100</span> <span class="token parameter variable">-s</span> <span class="token number">10.0</span>.5.0/24 <span class="token parameter variable">-j</span> ACCEPT

<span class="token comment"># Log dropped packets</span>
iptables <span class="token parameter variable">-A</span> INPUT <span class="token parameter variable">-j</span> LOG --log-prefix <span class="token string">"DROPPED: "</span>

<span class="token comment"># Save rules</span>
iptables-save <span class="token operator">&gt;</span> /etc/iptables/rules.v4

<span class="token comment"># Create systemd service for iptables persistence</span>
<span class="token function">cat</span> <span class="token operator">&gt;</span> /etc/systemd/system/iptables-persistent.service <span class="token operator">&lt;&lt;</span> <span class="token string">EOF
[Unit]
Description=Load iptables rules
After=network.target

[Service]
Type=oneshot
ExecStart=/sbin/iptables-restore /etc/iptables/rules.v4
RemainAfterExit=yes

[Install]
WantedBy=multi-user.target
EOF</span>

systemctl <span class="token builtin class-name">enable</span> iptables-persistent
</code></pre>
</div>
<hr>

        <h2 id="backup-and-disaster-recovery" class="group relative scroll-mt-20 text-2xl font-semibold mb-4 mt-6 border-b border-gray-200 dark:border-gray-700 pb-2">
          <a class="anchor absolute -ml-10 flex items-center opacity-0 group-hover:opacity-100 transition-opacity duration-200" aria-label="Link to this section" href="#backup-and-disaster-recovery">
            <svg class="octicon octicon-link" viewBox="0 0 16 16" aria-hidden="true">
              <path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path>
            </svg>
          </a>
          <span>Backup and Disaster Recovery</span>
        <a href="#/blog/self-managed-elasticsearch-vm-bare-metal-production-guide#backup-and-disaster-recovery" class="header-link" style="opacity: 0; margin-left: 8px; text-decoration: none; color: rgb(107, 114, 128); transition: opacity 0.2s; cursor: pointer;">#</a></h2>
      

        <h3 id="automated-backup-strategy" class="group relative scroll-mt-20 text-xl font-semibold mb-3 mt-5">
          <a class="anchor absolute -ml-10 flex items-center opacity-0 group-hover:opacity-100 transition-opacity duration-200" aria-label="Link to this section" href="#automated-backup-strategy">
            <svg class="octicon octicon-link" viewBox="0 0 16 16" aria-hidden="true">
              <path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path>
            </svg>
          </a>
          <span>Automated Backup Strategy</span>
        <a href="#/blog/self-managed-elasticsearch-vm-bare-metal-production-guide#automated-backup-strategy" class="header-link" style="opacity: 0; margin-left: 8px; text-decoration: none; color: rgb(107, 114, 128); transition: opacity 0.2s; cursor: pointer;">#</a></h3>
      
<div class="highlight highlight-bash notranslate" style="background-color: transparent !important; border: none !important; border-radius: 0px !important; padding: 0px !important; margin: 0px !important;">
<pre class="notranslate language-bash" tabindex="0" style="border-radius: 0.75rem !important; padding: 16px !important; margin: 16px 0px !important; overflow-x: auto !important; font-size: 14px !important; line-height: 1.5 !important; white-space: pre-wrap !important; overflow-wrap: normal !important; text-wrap-style: initial !important; word-break: normal !important;"><code class="language-bash" style="background: transparent !important; border: none !important; border-radius: 0px !important; font-family: ui-monospace, SFMono-Regular, &quot;SF Mono&quot;, Consolas, &quot;Liberation Mono&quot;, Menlo, monospace !important; font-size: 15px !important; line-height: 1.6 !important; padding: 0px !important; font-weight: 500 !important; text-rendering: geometricprecision !important; -webkit-font-smoothing: subpixel-antialiased !important; letter-spacing: 0.025em !important; white-space: pre-wrap !important; overflow-wrap: normal !important; text-wrap-style: initial !important; word-break: normal !important;"><span class="token shebang important">#!/bin/bash</span>
<span class="token comment"># elasticsearch_backup.sh</span>

<span class="token assign-left variable">CLUSTER_ENDPOINT</span><span class="token operator">=</span><span class="token string">"http://localhost:9200"</span>
<span class="token assign-left variable">BACKUP_REPOSITORY</span><span class="token operator">=</span><span class="token string">"production_backups"</span>
<span class="token assign-left variable">S3_BUCKET</span><span class="token operator">=</span><span class="token string">"elasticsearch-backups-prod"</span>
<span class="token assign-left variable">RETENTION_DAYS</span><span class="token operator">=</span><span class="token number">30</span>
<span class="token assign-left variable">SLACK_WEBHOOK</span><span class="token operator">=</span><span class="token string">"https://hooks.slack.com/services/YOUR/SLACK/WEBHOOK"</span>

<span class="token comment"># Function to send Slack notification</span>
<span class="token function-name function">send_notification</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token builtin class-name">local</span> <span class="token assign-left variable">message</span><span class="token operator">=</span><span class="token variable">$1</span>
    <span class="token builtin class-name">local</span> <span class="token assign-left variable">color</span><span class="token operator">=</span><span class="token variable">$2</span>
    <span class="token function">curl</span> <span class="token parameter variable">-X</span> POST <span class="token parameter variable">-H</span> <span class="token string">'Content-type: application/json'</span> <span class="token punctuation">\</span>
        <span class="token parameter variable">--data</span> <span class="token string">"{<span class="token entity" title="\&quot;">\"</span>attachments<span class="token entity" title="\&quot;">\"</span>:[{<span class="token entity" title="\&quot;">\"</span>color<span class="token entity" title="\&quot;">\"</span>:<span class="token entity" title="\&quot;">\"</span><span class="token variable">$color</span><span class="token entity" title="\&quot;">\"</span>,<span class="token entity" title="\&quot;">\"</span>text<span class="token entity" title="\&quot;">\"</span>:<span class="token entity" title="\&quot;">\"</span><span class="token variable">$message</span><span class="token entity" title="\&quot;">\"</span>}]}"</span> <span class="token punctuation">\</span>
        <span class="token string">"<span class="token variable">$SLACK_WEBHOOK</span>"</span>
<span class="token punctuation">}</span>

<span class="token comment"># Function to check if repository exists</span>
<span class="token function-name function">check_repository</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token builtin class-name">local</span> <span class="token assign-left variable">repo_check</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token function">curl</span> <span class="token parameter variable">-s</span> <span class="token string">"<span class="token variable">$CLUSTER_ENDPOINT</span>/_snapshot/<span class="token variable">$BACKUP_REPOSITORY</span>"</span><span class="token variable">)</span></span>
    <span class="token keyword">if</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token variable">$repo_check</span> <span class="token operator">==</span> *<span class="token string">"repository_missing_exception"</span>* <span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
        <span class="token builtin class-name">echo</span> <span class="token string">"Repository does not exist, creating..."</span>
        create_repository
    <span class="token keyword">else</span>
        <span class="token builtin class-name">echo</span> <span class="token string">"Repository exists, proceeding with backup"</span>
    <span class="token keyword">fi</span>
<span class="token punctuation">}</span>

<span class="token comment"># Function to create backup repository</span>
<span class="token function-name function">create_repository</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">curl</span> <span class="token parameter variable">-X</span> PUT <span class="token string">"<span class="token variable">$CLUSTER_ENDPOINT</span>/_snapshot/<span class="token variable">$BACKUP_REPOSITORY</span>"</span> <span class="token punctuation">\</span>
        <span class="token parameter variable">-H</span> <span class="token string">"Content-Type: application/json"</span> <span class="token punctuation">\</span>
        <span class="token parameter variable">-d</span> <span class="token string">'{
            "type": "s3",
            "settings": {
                "bucket": "'</span><span class="token variable">$S3_BUCKET</span><span class="token string">'",
                "region": "us-west-2",
                "base_path": "elasticsearch",
                "compress": true,
                "server_side_encryption": true,
                "storage_class": "standard_ia"
            }
        }'</span>
<span class="token punctuation">}</span>

<span class="token comment"># Function to create snapshot</span>
<span class="token function-name function">create_snapshot</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token builtin class-name">local</span> <span class="token assign-left variable">snapshot_name</span><span class="token operator">=</span><span class="token string">"snapshot_<span class="token variable"><span class="token variable">$(</span><span class="token function">date</span> +%Y%m%d_%H%M%S<span class="token variable">)</span></span>"</span>
    <span class="token builtin class-name">local</span> <span class="token assign-left variable">snapshot_result</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token function">curl</span> <span class="token parameter variable">-s</span> <span class="token parameter variable">-X</span> PUT <span class="token string">"<span class="token variable">$CLUSTER_ENDPOINT</span>/_snapshot/<span class="token variable">$BACKUP_REPOSITORY</span>/<span class="token variable">$snapshot_name</span>?wait_for_completion=false"</span> <span class="token punctuation">\</span>
        <span class="token parameter variable">-H</span> <span class="token string">"Content-Type: application/json"</span> <span class="token punctuation">\</span>
        <span class="token parameter variable">-d</span> <span class="token string">'{
            "indices": "*",
            "ignore_unavailable": true,
            "include_global_state": false,
            "metadata": {
                "taken_by": "automated_backup_script",
                "taken_because": "scheduled_backup"
            }
        }'</span><span class="token variable">)</span></span>
    
    <span class="token builtin class-name">echo</span> <span class="token string">"Started snapshot: <span class="token variable">$snapshot_name</span>"</span>
    <span class="token builtin class-name">echo</span> <span class="token string">"<span class="token variable">$snapshot_result</span>"</span>
    
    <span class="token comment"># Monitor snapshot progress</span>
    monitor_snapshot <span class="token string">"<span class="token variable">$snapshot_name</span>"</span>
<span class="token punctuation">}</span>

<span class="token comment"># Function to monitor snapshot progress</span>
<span class="token function-name function">monitor_snapshot</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token builtin class-name">local</span> <span class="token assign-left variable">snapshot_name</span><span class="token operator">=</span><span class="token variable">$1</span>
    <span class="token builtin class-name">echo</span> <span class="token string">"Monitoring snapshot progress for <span class="token variable">$snapshot_name</span>"</span>
    
    <span class="token keyword">while</span> <span class="token boolean">true</span><span class="token punctuation">;</span> <span class="token keyword">do</span>
        <span class="token builtin class-name">local</span> <span class="token assign-left variable">status</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token function">curl</span> <span class="token parameter variable">-s</span> <span class="token string">"<span class="token variable">$CLUSTER_ENDPOINT</span>/_snapshot/<span class="token variable">$BACKUP_REPOSITORY</span>/<span class="token variable">$snapshot_name</span>"</span> <span class="token operator">|</span> jq <span class="token parameter variable">-r</span> <span class="token string">'.snapshots[0].state'</span><span class="token variable">)</span></span>
        
        <span class="token keyword">case</span> <span class="token variable">$status</span> <span class="token keyword">in</span>
            <span class="token string">"SUCCESS"</span><span class="token punctuation">)</span>
                <span class="token builtin class-name">echo</span> <span class="token string">"Snapshot completed successfully"</span>
                send_notification <span class="token string">" Elasticsearch backup completed: <span class="token variable">$snapshot_name</span>"</span> <span class="token string">"good"</span>
                <span class="token builtin class-name">break</span>
                <span class="token punctuation">;</span><span class="token punctuation">;</span>
            <span class="token string">"FAILED"</span><span class="token punctuation">)</span>
                <span class="token builtin class-name">echo</span> <span class="token string">"Snapshot failed"</span>
                send_notification <span class="token string">" Elasticsearch backup failed: <span class="token variable">$snapshot_name</span>"</span> <span class="token string">"danger"</span>
                <span class="token builtin class-name">exit</span> <span class="token number">1</span>
                <span class="token punctuation">;</span><span class="token punctuation">;</span>
            <span class="token string">"IN_PROGRESS"</span><span class="token punctuation">)</span>
                <span class="token builtin class-name">echo</span> <span class="token string">"Snapshot in progress..."</span>
                <span class="token function">sleep</span> <span class="token number">30</span>
                <span class="token punctuation">;</span><span class="token punctuation">;</span>
            *<span class="token punctuation">)</span>
                <span class="token builtin class-name">echo</span> <span class="token string">"Unknown status: <span class="token variable">$status</span>"</span>
                <span class="token function">sleep</span> <span class="token number">30</span>
                <span class="token punctuation">;</span><span class="token punctuation">;</span>
        <span class="token keyword">esac</span>
    <span class="token keyword">done</span>
<span class="token punctuation">}</span>

<span class="token comment"># Function to cleanup old snapshots</span>
<span class="token function-name function">cleanup_old_snapshots</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token builtin class-name">echo</span> <span class="token string">"Cleaning up snapshots older than <span class="token variable">$RETENTION_DAYS</span> days"</span>
    
    <span class="token builtin class-name">local</span> <span class="token assign-left variable">snapshots</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token function">curl</span> <span class="token parameter variable">-s</span> <span class="token string">"<span class="token variable">$CLUSTER_ENDPOINT</span>/_snapshot/<span class="token variable">$BACKUP_REPOSITORY</span>/_all"</span> <span class="token operator">|</span> <span class="token punctuation">\</span>
        jq <span class="token parameter variable">-r</span> <span class="token parameter variable">--arg</span> retention_date <span class="token string">"<span class="token variable"><span class="token variable">$(</span><span class="token function">date</span> <span class="token parameter variable">-d</span> <span class="token string">"<span class="token variable">$RETENTION_DAYS</span> days ago"</span> +%s<span class="token variable">)</span></span>"</span> <span class="token punctuation">\</span>
        '.snapshots<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">|</span> select<span class="token punctuation">(</span>.start_time_in_millis/1000 <span class="token operator">&lt;</span> <span class="token punctuation">(</span>$retention_date <span class="token operator">|</span> tonumber<span class="token variable">)</span><span class="token variable">)</span></span> <span class="token operator">|</span> .snapshot<span class="token string">')
    
    for snapshot in $snapshots; do
        echo "Deleting old snapshot: $snapshot"
        curl -X DELETE "$CLUSTER_ENDPOINT/_snapshot/$BACKUP_REPOSITORY/$snapshot"
    done
}

# Function to verify backup integrity
verify_backup() {
    echo "Verifying latest backup integrity"
    
    local latest_snapshot=$(curl -s "$CLUSTER_ENDPOINT/_snapshot/$BACKUP_REPOSITORY/_all" | \
        jq -r '</span>.snapshots <span class="token operator">|</span> sort_by<span class="token punctuation">(</span>.start_time_in_millis<span class="token punctuation">)</span> <span class="token operator">|</span> .<span class="token punctuation">[</span>-1<span class="token punctuation">]</span> <span class="token operator">|</span> .snapshot<span class="token string">')
    
    local verification=$(curl -s "$CLUSTER_ENDPOINT/_snapshot/$BACKUP_REPOSITORY/$latest_snapshot/_verify")
    local node_count=$(echo "$verification" | jq '</span>.nodes <span class="token operator">|</span> length<span class="token string">')
    
    echo "Verification completed for $latest_snapshot on $node_count nodes"
}

# Main backup function
main() {
    echo "Starting Elasticsearch backup process at $(date)"
    
    # Check cluster health before backup
    local health=$(curl -s "$CLUSTER_ENDPOINT/_cluster/health" | jq -r '</span>.status'<span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token string">"<span class="token variable">$health</span>"</span> <span class="token operator">==</span> <span class="token string">"red"</span> <span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
        <span class="token builtin class-name">echo</span> <span class="token string">"Cluster is in RED state, aborting backup"</span>
        send_notification <span class="token string">" Backup aborted: Cluster in RED state"</span> <span class="token string">"danger"</span>
        <span class="token builtin class-name">exit</span> <span class="token number">1</span>
    <span class="token keyword">fi</span>
    
    check_repository
    create_snapshot
    cleanup_old_snapshots
    verify_backup
    
    <span class="token builtin class-name">echo</span> <span class="token string">"Backup process completed at <span class="token variable"><span class="token variable">$(</span><span class="token function">date</span><span class="token variable">)</span></span>"</span>
<span class="token punctuation">}</span>

<span class="token comment"># Execute main function</span>
main
</code></pre>
</div>

        <h3 id="disaster-recovery-procedures" class="group relative scroll-mt-20 text-xl font-semibold mb-3 mt-5">
          <a class="anchor absolute -ml-10 flex items-center opacity-0 group-hover:opacity-100 transition-opacity duration-200" aria-label="Link to this section" href="#disaster-recovery-procedures">
            <svg class="octicon octicon-link" viewBox="0 0 16 16" aria-hidden="true">
              <path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path>
            </svg>
          </a>
          <span>Disaster Recovery Procedures</span>
        <a href="#/blog/self-managed-elasticsearch-vm-bare-metal-production-guide#disaster-recovery-procedures" class="header-link" style="opacity: 0; margin-left: 8px; text-decoration: none; color: rgb(107, 114, 128); transition: opacity 0.2s; cursor: pointer;">#</a></h3>
      
<div class="highlight highlight-bash notranslate" style="background-color: transparent !important; border: none !important; border-radius: 0px !important; padding: 0px !important; margin: 0px !important;">
<pre class="notranslate language-bash" tabindex="0" style="border-radius: 0.75rem !important; padding: 16px !important; margin: 16px 0px !important; overflow-x: auto !important; font-size: 14px !important; line-height: 1.5 !important; white-space: pre-wrap !important; overflow-wrap: normal !important; text-wrap-style: initial !important; word-break: normal !important;"><code class="language-bash" style="background: transparent !important; border: none !important; border-radius: 0px !important; font-family: ui-monospace, SFMono-Regular, &quot;SF Mono&quot;, Consolas, &quot;Liberation Mono&quot;, Menlo, monospace !important; font-size: 15px !important; line-height: 1.6 !important; padding: 0px !important; font-weight: 500 !important; text-rendering: geometricprecision !important; -webkit-font-smoothing: subpixel-antialiased !important; letter-spacing: 0.025em !important; white-space: pre-wrap !important; overflow-wrap: normal !important; text-wrap-style: initial !important; word-break: normal !important;"><span class="token shebang important">#!/bin/bash</span>
<span class="token comment"># elasticsearch_disaster_recovery.sh</span>

<span class="token assign-left variable">CLUSTER_ENDPOINT</span><span class="token operator">=</span><span class="token string">"http://localhost:9200"</span>
<span class="token assign-left variable">BACKUP_REPOSITORY</span><span class="token operator">=</span><span class="token string">"production_backups"</span>
<span class="token assign-left variable">RECOVERY_LOG</span><span class="token operator">=</span><span class="token string">"/var/log/elasticsearch_recovery.log"</span>

<span class="token comment"># Function to log with timestamp</span>
<span class="token function-name function">log_message</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token builtin class-name">echo</span> <span class="token string">"<span class="token variable"><span class="token variable">$(</span><span class="token function">date</span> <span class="token string">'+%Y-%m-%d %H:%M:%S'</span><span class="token variable">)</span></span> - <span class="token variable">$1</span>"</span> <span class="token operator">|</span> <span class="token function">tee</span> <span class="token parameter variable">-a</span> <span class="token string">"<span class="token variable">$RECOVERY_LOG</span>"</span>
<span class="token punctuation">}</span>

<span class="token comment"># Function to list available snapshots</span>
<span class="token function-name function">list_snapshots</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    log_message <span class="token string">"Available snapshots:"</span>
    <span class="token function">curl</span> <span class="token parameter variable">-s</span> <span class="token string">"<span class="token variable">$CLUSTER_ENDPOINT</span>/_snapshot/<span class="token variable">$BACKUP_REPOSITORY</span>/_all"</span> <span class="token operator">|</span> <span class="token punctuation">\</span>
        jq <span class="token parameter variable">-r</span> <span class="token string">'.snapshots[] | "\(.snapshot) - \(.start_time) - \(.state)"'</span>
<span class="token punctuation">}</span>

<span class="token comment"># Function to restore from snapshot</span>
<span class="token function-name function">restore_snapshot</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token builtin class-name">local</span> <span class="token assign-left variable">snapshot_name</span><span class="token operator">=</span><span class="token variable">$1</span>
    <span class="token builtin class-name">local</span> <span class="token assign-left variable">restore_indices</span><span class="token operator">=</span><span class="token variable">${2<span class="token operator">:-</span>"*"}</span>
    
    log_message <span class="token string">"Starting restore from snapshot: <span class="token variable">$snapshot_name</span>"</span>
    
    <span class="token comment"># Close indices before restore if they exist</span>
    <span class="token keyword">if</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token string">"<span class="token variable">$restore_indices</span>"</span> <span class="token operator">!=</span> <span class="token string">"*"</span> <span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
        log_message <span class="token string">"Closing indices: <span class="token variable">$restore_indices</span>"</span>
        <span class="token function">curl</span> <span class="token parameter variable">-X</span> POST <span class="token string">"<span class="token variable">$CLUSTER_ENDPOINT</span>/<span class="token variable">$restore_indices</span>/_close"</span>
    <span class="token keyword">fi</span>
    
    <span class="token comment"># Start restore operation</span>
    <span class="token builtin class-name">local</span> <span class="token assign-left variable">restore_result</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token function">curl</span> <span class="token parameter variable">-s</span> <span class="token parameter variable">-X</span> POST <span class="token string">"<span class="token variable">$CLUSTER_ENDPOINT</span>/_snapshot/<span class="token variable">$BACKUP_REPOSITORY</span>/<span class="token variable">$snapshot_name</span>/_restore"</span> <span class="token punctuation">\</span>
        <span class="token parameter variable">-H</span> <span class="token string">"Content-Type: application/json"</span> <span class="token punctuation">\</span>
        <span class="token parameter variable">-d</span> <span class="token string">'{
            "indices": "'</span>$restore_indices<span class="token string">'",
            "ignore_unavailable": true,
            "include_global_state": false,
            "rename_pattern": "(.+)",
            "rename_replacement": "restored_$1",
            "include_aliases": false
        }'</span><span class="token variable">)</span></span>
    
    log_message <span class="token string">"Restore initiated: <span class="token variable">$restore_result</span>"</span>
    
    <span class="token comment"># Monitor restore progress</span>
    monitor_restore <span class="token string">"<span class="token variable">$snapshot_name</span>"</span>
<span class="token punctuation">}</span>

<span class="token comment"># Function to monitor restore progress</span>
<span class="token function-name function">monitor_restore</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token builtin class-name">local</span> <span class="token assign-left variable">snapshot_name</span><span class="token operator">=</span><span class="token variable">$1</span>
    
    <span class="token keyword">while</span> <span class="token boolean">true</span><span class="token punctuation">;</span> <span class="token keyword">do</span>
        <span class="token builtin class-name">local</span> <span class="token assign-left variable">recovery_status</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token function">curl</span> <span class="token parameter variable">-s</span> <span class="token string">"<span class="token variable">$CLUSTER_ENDPOINT</span>/_recovery"</span> <span class="token operator">|</span> <span class="token punctuation">\</span>
            jq <span class="token string">'.[] | select(.type == "SNAPSHOT") | .stage'</span><span class="token variable">)</span></span>
        
        <span class="token keyword">if</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token parameter variable">-z</span> <span class="token string">"<span class="token variable">$recovery_status</span>"</span> <span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
            log_message <span class="token string">"Restore completed"</span>
            <span class="token builtin class-name">break</span>
        <span class="token keyword">fi</span>
        
        log_message <span class="token string">"Restore in progress - Stage: <span class="token variable">$recovery_status</span>"</span>
        <span class="token function">sleep</span> <span class="token number">30</span>
    <span class="token keyword">done</span>
<span class="token punctuation">}</span>

<span class="token comment"># Function for complete cluster recovery</span>
<span class="token function-name function">full_cluster_recovery</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token builtin class-name">local</span> <span class="token assign-left variable">snapshot_name</span><span class="token operator">=</span><span class="token variable">$1</span>
    
    log_message <span class="token string">"Starting full cluster recovery from snapshot: <span class="token variable">$snapshot_name</span>"</span>
    
    <span class="token comment"># Step 1: Stop all write operations</span>
    log_message <span class="token string">"Setting cluster to read-only mode"</span>
    <span class="token function">curl</span> <span class="token parameter variable">-X</span> PUT <span class="token string">"<span class="token variable">$CLUSTER_ENDPOINT</span>/_cluster/settings"</span> <span class="token punctuation">\</span>
        <span class="token parameter variable">-H</span> <span class="token string">"Content-Type: application/json"</span> <span class="token punctuation">\</span>
        <span class="token parameter variable">-d</span> <span class="token string">'{
            "persistent": {
                "cluster.blocks.read_only": true
            }
        }'</span>
    
    <span class="token comment"># Step 2: Close all indices</span>
    log_message <span class="token string">"Closing all indices"</span>
    <span class="token function">curl</span> <span class="token parameter variable">-X</span> POST <span class="token string">"<span class="token variable">$CLUSTER_ENDPOINT</span>/_all/_close"</span>
    
    <span class="token comment"># Step 3: Delete all indices (WARNING: DESTRUCTIVE)</span>
    <span class="token builtin class-name">read</span> <span class="token parameter variable">-p</span> <span class="token string">"This will DELETE ALL INDICES. Type 'YES' to continue: "</span> confirmation
    <span class="token keyword">if</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token string">"<span class="token variable">$confirmation</span>"</span> <span class="token operator">==</span> <span class="token string">"YES"</span> <span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
        log_message <span class="token string">"Deleting all indices"</span>
        <span class="token function">curl</span> <span class="token parameter variable">-X</span> DELETE <span class="token string">"<span class="token variable">$CLUSTER_ENDPOINT</span>/*"</span>
    <span class="token keyword">else</span>
        log_message <span class="token string">"Recovery aborted by user"</span>
        <span class="token builtin class-name">return</span> <span class="token number">1</span>
    <span class="token keyword">fi</span>
    
    <span class="token comment"># Step 4: Restore from snapshot</span>
    log_message <span class="token string">"Restoring from snapshot"</span>
    <span class="token function">curl</span> <span class="token parameter variable">-X</span> POST <span class="token string">"<span class="token variable">$CLUSTER_ENDPOINT</span>/_snapshot/<span class="token variable">$BACKUP_REPOSITORY</span>/<span class="token variable">$snapshot_name</span>/_restore"</span> <span class="token punctuation">\</span>
        <span class="token parameter variable">-H</span> <span class="token string">"Content-Type: application/json"</span> <span class="token punctuation">\</span>
        <span class="token parameter variable">-d</span> <span class="token string">'{
            "indices": "*",
            "ignore_unavailable": true,
            "include_global_state": true
        }'</span>
    
    <span class="token comment"># Step 5: Monitor recovery</span>
    monitor_restore <span class="token string">"<span class="token variable">$snapshot_name</span>"</span>
    
    <span class="token comment"># Step 6: Remove read-only block</span>
    log_message <span class="token string">"Removing read-only block"</span>
    <span class="token function">curl</span> <span class="token parameter variable">-X</span> PUT <span class="token string">"<span class="token variable">$CLUSTER_ENDPOINT</span>/_cluster/settings"</span> <span class="token punctuation">\</span>
        <span class="token parameter variable">-H</span> <span class="token string">"Content-Type: application/json"</span> <span class="token punctuation">\</span>
        <span class="token parameter variable">-d</span> <span class="token string">'{
            "persistent": {
                "cluster.blocks.read_only": null
            }
        }'</span>
    
    log_message <span class="token string">"Full cluster recovery completed"</span>
<span class="token punctuation">}</span>

<span class="token comment"># Function to perform point-in-time recovery</span>
<span class="token function-name function">point_in_time_recovery</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token builtin class-name">local</span> <span class="token assign-left variable">target_timestamp</span><span class="token operator">=</span><span class="token variable">$1</span>
    
    log_message <span class="token string">"Finding snapshot closest to timestamp: <span class="token variable">$target_timestamp</span>"</span>
    
    <span class="token builtin class-name">local</span> <span class="token assign-left variable">target_epoch</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token function">date</span> <span class="token parameter variable">-d</span> <span class="token string">"<span class="token variable">$target_timestamp</span>"</span> +%s<span class="token variable">)</span></span>
    <span class="token builtin class-name">local</span> <span class="token assign-left variable">closest_snapshot</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token function">curl</span> <span class="token parameter variable">-s</span> <span class="token string">"<span class="token variable">$CLUSTER_ENDPOINT</span>/_snapshot/<span class="token variable">$BACKUP_REPOSITORY</span>/_all"</span> <span class="token operator">|</span> <span class="token punctuation">\</span>
        jq <span class="token parameter variable">-r</span> <span class="token parameter variable">--arg</span> target <span class="token string">"<span class="token variable">$target_epoch</span>"</span> <span class="token punctuation">\</span>
        '.snapshots <span class="token operator">|</span> map<span class="token punctuation">(</span>select<span class="token punctuation">(</span>.start_time_in_millis/1000 <span class="token operator">&lt;=</span> <span class="token punctuation">(</span>$target <span class="token operator">|</span> tonumber<span class="token punctuation">)</span><span class="token variable">)</span></span><span class="token punctuation">)</span> <span class="token operator">|</span> 
         sort_by<span class="token punctuation">(</span>.start_time_in_millis<span class="token punctuation">)</span> <span class="token operator">|</span> .<span class="token punctuation">[</span>-1<span class="token punctuation">]</span> <span class="token operator">|</span> .snapshot<span class="token string">')
    
    if [[ "$closest_snapshot" == "null" || -z "$closest_snapshot" ]]; then
        log_message "No snapshot found before target timestamp"
        return 1
    fi
    
    log_message "Found closest snapshot: $closest_snapshot"
    restore_snapshot "$closest_snapshot"
}

# Function to validate cluster after recovery
validate_recovery() {
    log_message "Validating cluster health after recovery"
    
    # Check cluster health
    local health=$(curl -s "$CLUSTER_ENDPOINT/_cluster/health")
    local status=$(echo "$health" | jq -r '</span>.status<span class="token string">')
    local active_shards=$(echo "$health" | jq -r '</span>.active_shards<span class="token string">')
    local unassigned_shards=$(echo "$health" | jq -r '</span>.unassigned_shards<span class="token string">')
    
    log_message "Cluster status: $status"
    log_message "Active shards: $active_shards"
    log_message "Unassigned shards: $unassigned_shards"
    
    # Check index count
    local index_count=$(curl -s "$CLUSTER_ENDPOINT/_cat/indices?h=index" | wc -l)
    log_message "Total indices: $index_count"
    
    # Perform basic functionality test
    log_message "Performing basic functionality test"
    local test_result=$(curl -s "$CLUSTER_ENDPOINT/_search?size=1")
    local hit_count=$(echo "$test_result" | jq -r '</span>.hits.total.value'<span class="token punctuation">)</span>
    log_message <span class="token string">"Search test returned <span class="token variable">$hit_count</span> documents"</span>
    
    <span class="token keyword">if</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token string">"<span class="token variable">$status</span>"</span> <span class="token operator">==</span> <span class="token string">"green"</span> <span class="token operator">&amp;&amp;</span> <span class="token string">"<span class="token variable">$unassigned_shards</span>"</span> <span class="token operator">==</span> <span class="token string">"0"</span> <span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
        log_message <span class="token string">" Recovery validation PASSED"</span>
        <span class="token builtin class-name">return</span> <span class="token number">0</span>
    <span class="token keyword">else</span>
        log_message <span class="token string">" Recovery validation FAILED"</span>
        <span class="token builtin class-name">return</span> <span class="token number">1</span>
    <span class="token keyword">fi</span>
<span class="token punctuation">}</span>

<span class="token comment"># Main menu function</span>
<span class="token function-name function">show_menu</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token builtin class-name">echo</span> <span class="token string">"=== Elasticsearch Disaster Recovery Menu ==="</span>
    <span class="token builtin class-name">echo</span> <span class="token string">"1. List available snapshots"</span>
    <span class="token builtin class-name">echo</span> <span class="token string">"2. Restore specific indices from snapshot"</span>
    <span class="token builtin class-name">echo</span> <span class="token string">"3. Full cluster recovery"</span>
    <span class="token builtin class-name">echo</span> <span class="token string">"4. Point-in-time recovery"</span>
    <span class="token builtin class-name">echo</span> <span class="token string">"5. Validate recovery"</span>
    <span class="token builtin class-name">echo</span> <span class="token string">"6. Exit"</span>
    <span class="token builtin class-name">echo</span> <span class="token string">"=========================================="</span>
<span class="token punctuation">}</span>

<span class="token comment"># Main execution</span>
<span class="token function-name function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token variable">$#</span> <span class="token parameter variable">-eq</span> <span class="token number">0</span> <span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
        <span class="token keyword">while</span> <span class="token boolean">true</span><span class="token punctuation">;</span> <span class="token keyword">do</span>
            show_menu
            <span class="token builtin class-name">read</span> <span class="token parameter variable">-p</span> <span class="token string">"Select option (1-6): "</span> choice
            
            <span class="token keyword">case</span> <span class="token variable">$choice</span> <span class="token keyword">in</span>
                <span class="token number">1</span><span class="token punctuation">)</span>
                    list_snapshots
                    <span class="token punctuation">;</span><span class="token punctuation">;</span>
                <span class="token number">2</span><span class="token punctuation">)</span>
                    <span class="token builtin class-name">read</span> <span class="token parameter variable">-p</span> <span class="token string">"Enter snapshot name: "</span> snapshot
                    <span class="token builtin class-name">read</span> <span class="token parameter variable">-p</span> <span class="token string">"Enter indices pattern (default: *): "</span> indices
                    restore_snapshot <span class="token string">"<span class="token variable">$snapshot</span>"</span> <span class="token string">"<span class="token variable">${indices<span class="token operator">:-</span>*}</span>"</span>
                    <span class="token punctuation">;</span><span class="token punctuation">;</span>
                <span class="token number">3</span><span class="token punctuation">)</span>
                    <span class="token builtin class-name">read</span> <span class="token parameter variable">-p</span> <span class="token string">"Enter snapshot name for full recovery: "</span> snapshot
                    full_cluster_recovery <span class="token string">"<span class="token variable">$snapshot</span>"</span>
                    <span class="token punctuation">;</span><span class="token punctuation">;</span>
                <span class="token number">4</span><span class="token punctuation">)</span>
                    <span class="token builtin class-name">read</span> <span class="token parameter variable">-p</span> <span class="token string">"Enter target timestamp (YYYY-MM-DD HH:MM:SS): "</span> timestamp
                    point_in_time_recovery <span class="token string">"<span class="token variable">$timestamp</span>"</span>
                    <span class="token punctuation">;</span><span class="token punctuation">;</span>
                <span class="token number">5</span><span class="token punctuation">)</span>
                    validate_recovery
                    <span class="token punctuation">;</span><span class="token punctuation">;</span>
                <span class="token number">6</span><span class="token punctuation">)</span>
                    <span class="token builtin class-name">echo</span> <span class="token string">"Exiting..."</span>
                    <span class="token builtin class-name">break</span>
                    <span class="token punctuation">;</span><span class="token punctuation">;</span>
                *<span class="token punctuation">)</span>
                    <span class="token builtin class-name">echo</span> <span class="token string">"Invalid option"</span>
                    <span class="token punctuation">;</span><span class="token punctuation">;</span>
            <span class="token keyword">esac</span>
            <span class="token builtin class-name">echo</span>
        <span class="token keyword">done</span>
    <span class="token keyword">else</span>
        <span class="token comment"># Command line mode</span>
        <span class="token keyword">case</span> <span class="token variable">$1</span> <span class="token keyword">in</span>
            <span class="token string">"list"</span><span class="token punctuation">)</span>
                list_snapshots
                <span class="token punctuation">;</span><span class="token punctuation">;</span>
            <span class="token string">"restore"</span><span class="token punctuation">)</span>
                restore_snapshot <span class="token string">"<span class="token variable">$2</span>"</span> <span class="token string">"<span class="token variable">$3</span>"</span>
                <span class="token punctuation">;</span><span class="token punctuation">;</span>
            <span class="token string">"full-recovery"</span><span class="token punctuation">)</span>
                full_cluster_recovery <span class="token string">"<span class="token variable">$2</span>"</span>
                <span class="token punctuation">;</span><span class="token punctuation">;</span>
            <span class="token string">"pit-recovery"</span><span class="token punctuation">)</span>
                point_in_time_recovery <span class="token string">"<span class="token variable">$2</span>"</span>
                <span class="token punctuation">;</span><span class="token punctuation">;</span>
            <span class="token string">"validate"</span><span class="token punctuation">)</span>
                validate_recovery
                <span class="token punctuation">;</span><span class="token punctuation">;</span>
            *<span class="token punctuation">)</span>
                <span class="token builtin class-name">echo</span> <span class="token string">"Usage: <span class="token variable">$0</span> [list|restore|full-recovery|pit-recovery|validate]"</span>
                <span class="token punctuation">;</span><span class="token punctuation">;</span>
        <span class="token keyword">esac</span>
    <span class="token keyword">fi</span>
<span class="token punctuation">}</span>

<span class="token comment"># Execute main function with all arguments</span>
main <span class="token string">"<span class="token variable">$@</span>"</span>
</code></pre>
</div>
<hr>

        <h2 id="operational-procedures" class="group relative scroll-mt-20 text-2xl font-semibold mb-4 mt-6 border-b border-gray-200 dark:border-gray-700 pb-2">
          <a class="anchor absolute -ml-10 flex items-center opacity-0 group-hover:opacity-100 transition-opacity duration-200" aria-label="Link to this section" href="#operational-procedures">
            <svg class="octicon octicon-link" viewBox="0 0 16 16" aria-hidden="true">
              <path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path>
            </svg>
          </a>
          <span>Operational Procedures</span>
        <a href="#/blog/self-managed-elasticsearch-vm-bare-metal-production-guide#operational-procedures" class="header-link" style="opacity: 0; margin-left: 8px; text-decoration: none; color: rgb(107, 114, 128); transition: opacity 0.2s; cursor: pointer;">#</a></h2>
      

        <h3 id="rolling-update-procedure" class="group relative scroll-mt-20 text-xl font-semibold mb-3 mt-5">
          <a class="anchor absolute -ml-10 flex items-center opacity-0 group-hover:opacity-100 transition-opacity duration-200" aria-label="Link to this section" href="#rolling-update-procedure">
            <svg class="octicon octicon-link" viewBox="0 0 16 16" aria-hidden="true">
              <path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path>
            </svg>
          </a>
          <span>Rolling Update Procedure</span>
        <a href="#/blog/self-managed-elasticsearch-vm-bare-metal-production-guide#rolling-update-procedure" class="header-link" style="opacity: 0; margin-left: 8px; text-decoration: none; color: rgb(107, 114, 128); transition: opacity 0.2s; cursor: pointer;">#</a></h3>
      
<div class="highlight highlight-bash notranslate" style="background-color: transparent !important; border: none !important; border-radius: 0px !important; padding: 0px !important; margin: 0px !important;">
<pre class="notranslate language-bash" tabindex="0" style="border-radius: 0.75rem !important; padding: 16px !important; margin: 16px 0px !important; overflow-x: auto !important; font-size: 14px !important; line-height: 1.5 !important; white-space: pre-wrap !important; overflow-wrap: normal !important; text-wrap-style: initial !important; word-break: normal !important;"><code class="language-bash" style="background: transparent !important; border: none !important; border-radius: 0px !important; font-family: ui-monospace, SFMono-Regular, &quot;SF Mono&quot;, Consolas, &quot;Liberation Mono&quot;, Menlo, monospace !important; font-size: 15px !important; line-height: 1.6 !important; padding: 0px !important; font-weight: 500 !important; text-rendering: geometricprecision !important; -webkit-font-smoothing: subpixel-antialiased !important; letter-spacing: 0.025em !important; white-space: pre-wrap !important; overflow-wrap: normal !important; text-wrap-style: initial !important; word-break: normal !important;"><span class="token shebang important">#!/bin/bash</span>
<span class="token comment"># elasticsearch_rolling_update.sh</span>

<span class="token assign-left variable">CLUSTER_ENDPOINT</span><span class="token operator">=</span><span class="token string">"http://localhost:9200"</span>
<span class="token assign-left variable">NEW_VERSION</span><span class="token operator">=</span><span class="token string">"9.1.5"</span>
<span class="token assign-left variable">NODES</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token string">"es-master-01"</span> <span class="token string">"es-master-02"</span> <span class="token string">"es-master-03"</span> <span class="token string">"es-data-01"</span> <span class="token string">"es-data-02"</span> <span class="token string">"es-data-03"</span><span class="token punctuation">)</span>
<span class="token assign-left variable">UPDATE_LOG</span><span class="token operator">=</span><span class="token string">"/var/log/elasticsearch_update.log"</span>

<span class="token comment"># Function to log with timestamp</span>
<span class="token function-name function">log_message</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token builtin class-name">echo</span> <span class="token string">"<span class="token variable"><span class="token variable">$(</span><span class="token function">date</span> <span class="token string">'+%Y-%m-%d %H:%M:%S'</span><span class="token variable">)</span></span> - <span class="token variable">$1</span>"</span> <span class="token operator">|</span> <span class="token function">tee</span> <span class="token parameter variable">-a</span> <span class="token string">"<span class="token variable">$UPDATE_LOG</span>"</span>
<span class="token punctuation">}</span>

<span class="token comment"># Function to check cluster health</span>
<span class="token function-name function">check_cluster_health</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token builtin class-name">local</span> <span class="token assign-left variable">health</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token function">curl</span> <span class="token parameter variable">-s</span> <span class="token string">"<span class="token variable">$CLUSTER_ENDPOINT</span>/_cluster/health"</span> <span class="token operator">|</span> jq <span class="token parameter variable">-r</span> <span class="token string">'.status'</span><span class="token variable">)</span></span>
    <span class="token builtin class-name">echo</span> <span class="token string">"<span class="token variable">$health</span>"</span>
<span class="token punctuation">}</span>

<span class="token comment"># Function to disable shard allocation</span>
<span class="token function-name function">disable_shard_allocation</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    log_message <span class="token string">"Disabling shard allocation"</span>
    <span class="token function">curl</span> <span class="token parameter variable">-X</span> PUT <span class="token string">"<span class="token variable">$CLUSTER_ENDPOINT</span>/_cluster/settings"</span> <span class="token punctuation">\</span>
        <span class="token parameter variable">-H</span> <span class="token string">"Content-Type: application/json"</span> <span class="token punctuation">\</span>
        <span class="token parameter variable">-d</span> <span class="token string">'{
            "persistent": {
                "cluster.routing.allocation.enable": "primaries"
            }
        }'</span>
<span class="token punctuation">}</span>

<span class="token comment"># Function to enable shard allocation</span>
<span class="token function-name function">enable_shard_allocation</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    log_message <span class="token string">"Enabling shard allocation"</span>
    <span class="token function">curl</span> <span class="token parameter variable">-X</span> PUT <span class="token string">"<span class="token variable">$CLUSTER_ENDPOINT</span>/_cluster/settings"</span> <span class="token punctuation">\</span>
        <span class="token parameter variable">-H</span> <span class="token string">"Content-Type: application/json"</span> <span class="token punctuation">\</span>
        <span class="token parameter variable">-d</span> <span class="token string">'{
            "persistent": {
                "cluster.routing.allocation.enable": null
            }
        }'</span>
<span class="token punctuation">}</span>

<span class="token comment"># Function to perform synced flush</span>
<span class="token function-name function">perform_synced_flush</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    log_message <span class="token string">"Performing synced flush"</span>
    <span class="token function">curl</span> <span class="token parameter variable">-X</span> POST <span class="token string">"<span class="token variable">$CLUSTER_ENDPOINT</span>/_flush/synced"</span>
<span class="token punctuation">}</span>

<span class="token comment"># Function to update single node</span>
<span class="token function-name function">update_node</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token builtin class-name">local</span> <span class="token assign-left variable">node_name</span><span class="token operator">=</span><span class="token variable">$1</span>
    log_message <span class="token string">"Starting update for node: <span class="token variable">$node_name</span>"</span>
    
    <span class="token comment"># Stop Elasticsearch service</span>
    log_message <span class="token string">"Stopping Elasticsearch on <span class="token variable">$node_name</span>"</span>
    <span class="token function">ssh</span> <span class="token string">"<span class="token variable">$node_name</span>"</span> <span class="token string">"sudo systemctl stop elasticsearch"</span>
    
    <span class="token comment"># Backup current installation</span>
    log_message <span class="token string">"Backing up current installation on <span class="token variable">$node_name</span>"</span>
    <span class="token function">ssh</span> <span class="token string">"<span class="token variable">$node_name</span>"</span> <span class="token string">"sudo cp -r /etc/elasticsearch /etc/elasticsearch.backup.<span class="token variable"><span class="token variable">$(</span><span class="token function">date</span> +%Y%m%d<span class="token variable">)</span></span>"</span>
    
    <span class="token comment"># Update Elasticsearch</span>
    log_message <span class="token string">"Updating Elasticsearch to version <span class="token variable">$NEW_VERSION</span> on <span class="token variable">$node_name</span>"</span>
    <span class="token function">ssh</span> <span class="token string">"<span class="token variable">$node_name</span>"</span> <span class="token string">"sudo apt-get update &amp;&amp; sudo apt-get install -y elasticsearch=<span class="token variable">$NEW_VERSION</span>"</span>
    
    <span class="token comment"># Start Elasticsearch service</span>
    log_message <span class="token string">"Starting Elasticsearch on <span class="token variable">$node_name</span>"</span>
    <span class="token function">ssh</span> <span class="token string">"<span class="token variable">$node_name</span>"</span> <span class="token string">"sudo systemctl start elasticsearch"</span>
    
    <span class="token comment"># Wait for node to join cluster</span>
    log_message <span class="token string">"Waiting for <span class="token variable">$node_name</span> to join cluster"</span>
    <span class="token keyword">while</span> <span class="token boolean">true</span><span class="token punctuation">;</span> <span class="token keyword">do</span>
        <span class="token builtin class-name">local</span> <span class="token assign-left variable">node_count</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token function">curl</span> <span class="token parameter variable">-s</span> <span class="token string">"<span class="token variable">$CLUSTER_ENDPOINT</span>/_cat/nodes"</span> <span class="token operator">|</span> <span class="token function">wc</span> <span class="token parameter variable">-l</span><span class="token variable">)</span></span>
        <span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token string">"<span class="token variable">$node_count</span>"</span> <span class="token parameter variable">-ge</span> <span class="token string">"<span class="token variable">${<span class="token operator">#</span>NODES<span class="token punctuation">[</span>@<span class="token punctuation">]</span>}</span>"</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
            <span class="token builtin class-name">break</span>
        <span class="token keyword">fi</span>
        <span class="token function">sleep</span> <span class="token number">10</span>
    <span class="token keyword">done</span>
    
    <span class="token comment"># Wait for cluster to stabilize</span>
    log_message <span class="token string">"Waiting for cluster to stabilize after <span class="token variable">$node_name</span> update"</span>
    <span class="token keyword">while</span> <span class="token boolean">true</span><span class="token punctuation">;</span> <span class="token keyword">do</span>
        <span class="token builtin class-name">local</span> <span class="token assign-left variable">health</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span>check_cluster_health<span class="token variable">)</span></span>
        <span class="token keyword">if</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token string">"<span class="token variable">$health</span>"</span> <span class="token operator">==</span> <span class="token string">"green"</span> <span class="token operator">||</span> <span class="token string">"<span class="token variable">$health</span>"</span> <span class="token operator">==</span> <span class="token string">"yellow"</span> <span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
            <span class="token builtin class-name">break</span>
        <span class="token keyword">fi</span>
        <span class="token function">sleep</span> <span class="token number">15</span>
    <span class="token keyword">done</span>
    
    log_message <span class="token string">"Node <span class="token variable">$node_name</span> updated successfully"</span>
<span class="token punctuation">}</span>

<span class="token comment"># Function to perform rolling update</span>
<span class="token function-name function">perform_rolling_update</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    log_message <span class="token string">"Starting rolling update to Elasticsearch <span class="token variable">$NEW_VERSION</span>"</span>
    
    <span class="token comment"># Pre-update checks</span>
    <span class="token builtin class-name">local</span> <span class="token assign-left variable">initial_health</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span>check_cluster_health<span class="token variable">)</span></span>
    <span class="token keyword">if</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token string">"<span class="token variable">$initial_health</span>"</span> <span class="token operator">==</span> <span class="token string">"red"</span> <span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
        log_message <span class="token string">"ERROR: Cluster is in RED state. Aborting update."</span>
        <span class="token builtin class-name">exit</span> <span class="token number">1</span>
    <span class="token keyword">fi</span>
    
    log_message <span class="token string">"Initial cluster health: <span class="token variable">$initial_health</span>"</span>
    
    <span class="token comment"># Disable shard allocation</span>
    disable_shard_allocation
    
    <span class="token comment"># Perform synced flush</span>
    perform_synced_flush
    
    <span class="token comment"># Update master nodes first (one by one)</span>
    <span class="token keyword">for</span> <span class="token for-or-select variable">node</span> <span class="token keyword">in</span> <span class="token string">"<span class="token variable">${NODES<span class="token punctuation">[</span>@<span class="token punctuation">]</span>}</span>"</span><span class="token punctuation">;</span> <span class="token keyword">do</span>
        <span class="token keyword">if</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token string">"<span class="token variable">$node</span>"</span> <span class="token operator">==</span> *<span class="token string">"master"</span>* <span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
            update_node <span class="token string">"<span class="token variable">$node</span>"</span>
            
            <span class="token comment"># Wait longer after master node updates</span>
            <span class="token function">sleep</span> <span class="token number">30</span>
        <span class="token keyword">fi</span>
    <span class="token keyword">done</span>
    
    <span class="token comment"># Update data nodes</span>
    <span class="token keyword">for</span> <span class="token for-or-select variable">node</span> <span class="token keyword">in</span> <span class="token string">"<span class="token variable">${NODES<span class="token punctuation">[</span>@<span class="token punctuation">]</span>}</span>"</span><span class="token punctuation">;</span> <span class="token keyword">do</span>
        <span class="token keyword">if</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token string">"<span class="token variable">$node</span>"</span> <span class="token operator">==</span> *<span class="token string">"data"</span>* <span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
            update_node <span class="token string">"<span class="token variable">$node</span>"</span>
        <span class="token keyword">fi</span>
    <span class="token keyword">done</span>
    
    <span class="token comment"># Re-enable shard allocation</span>
    enable_shard_allocation
    
    <span class="token comment"># Wait for final cluster stabilization</span>
    log_message <span class="token string">"Waiting for final cluster stabilization"</span>
    <span class="token builtin class-name">local</span> <span class="token assign-left variable">max_wait</span><span class="token operator">=</span><span class="token number">600</span>  <span class="token comment"># 10 minutes</span>
    <span class="token builtin class-name">local</span> <span class="token assign-left variable">wait_time</span><span class="token operator">=</span><span class="token number">0</span>
    
    <span class="token keyword">while</span> <span class="token punctuation">[</span> <span class="token variable">$wait_time</span> <span class="token parameter variable">-lt</span> <span class="token variable">$max_wait</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">do</span>
        <span class="token builtin class-name">local</span> <span class="token assign-left variable">health</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span>check_cluster_health<span class="token variable">)</span></span>
        <span class="token builtin class-name">local</span> <span class="token assign-left variable">unassigned</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token function">curl</span> <span class="token parameter variable">-s</span> <span class="token string">"<span class="token variable">$CLUSTER_ENDPOINT</span>/_cluster/health"</span> <span class="token operator">|</span> jq <span class="token parameter variable">-r</span> <span class="token string">'.unassigned_shards'</span><span class="token variable">)</span></span>
        
        <span class="token keyword">if</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token string">"<span class="token variable">$health</span>"</span> <span class="token operator">==</span> <span class="token string">"green"</span> <span class="token operator">&amp;&amp;</span> <span class="token string">"<span class="token variable">$unassigned</span>"</span> <span class="token operator">==</span> <span class="token string">"0"</span> <span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
            log_message <span class="token string">" Rolling update completed successfully"</span>
            <span class="token builtin class-name">break</span>
        <span class="token keyword">fi</span>
        
        <span class="token function">sleep</span> <span class="token number">30</span>
        <span class="token assign-left variable">wait_time</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$((</span>wait_time <span class="token operator">+</span> <span class="token number">30</span><span class="token variable">))</span></span>
    <span class="token keyword">done</span>
    
    <span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token variable">$wait_time</span> <span class="token parameter variable">-ge</span> <span class="token variable">$max_wait</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
        log_message <span class="token string">" Rolling update completed but cluster not fully stabilized"</span>
    <span class="token keyword">fi</span>
    
    <span class="token comment"># Final status report</span>
    log_message <span class="token string">"Final cluster status:"</span>
    <span class="token function">curl</span> <span class="token parameter variable">-s</span> <span class="token string">"<span class="token variable">$CLUSTER_ENDPOINT</span>/_cluster/health"</span> <span class="token operator">|</span> jq <span class="token string">'.'</span>
    <span class="token function">curl</span> <span class="token parameter variable">-s</span> <span class="token string">"<span class="token variable">$CLUSTER_ENDPOINT</span>/_cat/nodes?v"</span>
<span class="token punctuation">}</span>

<span class="token comment"># Function to rollback update</span>
<span class="token function-name function">rollback_update</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token builtin class-name">local</span> <span class="token assign-left variable">node_name</span><span class="token operator">=</span><span class="token variable">$1</span>
    log_message <span class="token string">"Rolling back update for node: <span class="token variable">$node_name</span>"</span>
    
    <span class="token comment"># Stop Elasticsearch</span>
    <span class="token function">ssh</span> <span class="token string">"<span class="token variable">$node_name</span>"</span> <span class="token string">"sudo systemctl stop elasticsearch"</span>
    
    <span class="token comment"># Restore backup configuration</span>
    <span class="token function">ssh</span> <span class="token string">"<span class="token variable">$node_name</span>"</span> <span class="token string">"sudo rm -rf /etc/elasticsearch &amp;&amp; sudo mv /etc/elasticsearch.backup.* /etc/elasticsearch"</span>
    
    <span class="token comment"># Downgrade package (if needed)</span>
    <span class="token comment"># ssh "$node_name" "sudo apt-get install -y elasticsearch=$PREVIOUS_VERSION --allow-downgrades"</span>
    
    <span class="token comment"># Start service</span>
    <span class="token function">ssh</span> <span class="token string">"<span class="token variable">$node_name</span>"</span> <span class="token string">"sudo systemctl start elasticsearch"</span>
    
    log_message <span class="token string">"Rollback completed for <span class="token variable">$node_name</span>"</span>
<span class="token punctuation">}</span>

<span class="token comment"># Main execution</span>
<span class="token keyword">case</span> <span class="token string">"<span class="token variable">${1<span class="token operator">:-</span>update}</span>"</span> <span class="token keyword">in</span>
    <span class="token string">"update"</span><span class="token punctuation">)</span>
        perform_rolling_update
        <span class="token punctuation">;</span><span class="token punctuation">;</span>
    <span class="token string">"rollback"</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token parameter variable">-n</span> <span class="token string">"<span class="token variable">$2</span>"</span> <span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
            rollback_update <span class="token string">"<span class="token variable">$2</span>"</span>
        <span class="token keyword">else</span>
            <span class="token builtin class-name">echo</span> <span class="token string">"Usage: <span class="token variable">$0</span> rollback &lt;node_name&gt;"</span>
        <span class="token keyword">fi</span>
        <span class="token punctuation">;</span><span class="token punctuation">;</span>
    <span class="token string">"check"</span><span class="token punctuation">)</span>
        <span class="token assign-left variable">health</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span>check_cluster_health<span class="token variable">)</span></span>
        log_message <span class="token string">"Current cluster health: <span class="token variable">$health</span>"</span>
        <span class="token punctuation">;</span><span class="token punctuation">;</span>
    *<span class="token punctuation">)</span>
        <span class="token builtin class-name">echo</span> <span class="token string">"Usage: <span class="token variable">$0</span> [update|rollback|check]"</span>
        <span class="token punctuation">;</span><span class="token punctuation">;</span>
<span class="token keyword">esac</span>
</code></pre>
</div>
<hr>

        <h2 id="cost-analysis-and-roi" class="group relative scroll-mt-20 text-2xl font-semibold mb-4 mt-6 border-b border-gray-200 dark:border-gray-700 pb-2">
          <a class="anchor absolute -ml-10 flex items-center opacity-0 group-hover:opacity-100 transition-opacity duration-200" aria-label="Link to this section" href="#cost-analysis-and-roi">
            <svg class="octicon octicon-link" viewBox="0 0 16 16" aria-hidden="true">
              <path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path>
            </svg>
          </a>
          <span>Cost Analysis and ROI</span>
        <a href="#/blog/self-managed-elasticsearch-vm-bare-metal-production-guide#cost-analysis-and-roi" class="header-link" style="opacity: 0; margin-left: 8px; text-decoration: none; color: rgb(107, 114, 128); transition: opacity 0.2s; cursor: pointer;">#</a></h2>
      

        <h3 id="total-cost-of-ownership-calculator" class="group relative scroll-mt-20 text-xl font-semibold mb-3 mt-5">
          <a class="anchor absolute -ml-10 flex items-center opacity-0 group-hover:opacity-100 transition-opacity duration-200" aria-label="Link to this section" href="#total-cost-of-ownership-calculator">
            <svg class="octicon octicon-link" viewBox="0 0 16 16" aria-hidden="true">
              <path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path>
            </svg>
          </a>
          <span>Total Cost of Ownership Calculator</span>
        <a href="#/blog/self-managed-elasticsearch-vm-bare-metal-production-guide#total-cost-of-ownership-calculator" class="header-link" style="opacity: 0; margin-left: 8px; text-decoration: none; color: rgb(107, 114, 128); transition: opacity 0.2s; cursor: pointer;">#</a></h3>
      
<div class="highlight highlight-python notranslate" style="background-color: transparent !important; border: none !important; border-radius: 0px !important; padding: 0px !important; margin: 0px !important;">
<pre class="notranslate language-python" tabindex="0" style="border-radius: 0.75rem !important; padding: 16px !important; margin: 16px 0px !important; overflow-x: auto !important; font-size: 14px !important; line-height: 1.5 !important; white-space: pre-wrap !important; overflow-wrap: normal !important; text-wrap-style: initial !important; word-break: normal !important;"><code class="language-python" style="background: transparent !important; border: none !important; border-radius: 0px !important; font-family: ui-monospace, SFMono-Regular, &quot;SF Mono&quot;, Consolas, &quot;Liberation Mono&quot;, Menlo, monospace !important; font-size: 15px !important; line-height: 1.6 !important; padding: 0px !important; font-weight: 500 !important; text-rendering: geometricprecision !important; -webkit-font-smoothing: subpixel-antialiased !important; letter-spacing: 0.025em !important; white-space: pre-wrap !important; overflow-wrap: normal !important; text-wrap-style: initial !important; word-break: normal !important;"><span class="token comment">#!/usr/bin/env python3</span>
<span class="token comment"># elasticsearch_tco_calculator.py</span>

<span class="token keyword">import</span> json
<span class="token keyword">from</span> dataclasses <span class="token keyword">import</span> dataclass
<span class="token keyword">from</span> typing <span class="token keyword">import</span> Dict<span class="token punctuation">,</span> List

<span class="token decorator annotation punctuation">@dataclass</span>
<span class="token keyword">class</span> <span class="token class-name">CostBreakdown</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""Cost breakdown structure for TCO analysis"""</span>
    infrastructure<span class="token punctuation">:</span> <span class="token builtin">float</span>
    software_licenses<span class="token punctuation">:</span> <span class="token builtin">float</span>
    operational<span class="token punctuation">:</span> <span class="token builtin">float</span>
    training<span class="token punctuation">:</span> <span class="token builtin">float</span>
    support<span class="token punctuation">:</span> <span class="token builtin">float</span>
    total<span class="token punctuation">:</span> <span class="token builtin">float</span>

<span class="token keyword">class</span> <span class="token class-name">ElasticsearchTCOCalculator</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># Cost assumptions (USD per month unless specified)</span>
        self<span class="token punctuation">.</span>vm_costs <span class="token operator">=</span> <span class="token punctuation">{</span>
            <span class="token string">'master_node'</span><span class="token punctuation">:</span> <span class="token number">350</span><span class="token punctuation">,</span>      <span class="token comment"># 8 CPU, 16GB RAM</span>
            <span class="token string">'data_node_small'</span><span class="token punctuation">:</span> <span class="token number">800</span><span class="token punctuation">,</span>  <span class="token comment"># 16 CPU, 64GB RAM, 2TB SSD</span>
            <span class="token string">'data_node_large'</span><span class="token punctuation">:</span> <span class="token number">1600</span><span class="token punctuation">,</span> <span class="token comment"># 32 CPU, 128GB RAM, 4TB SSD</span>
            <span class="token string">'coordinator_node'</span><span class="token punctuation">:</span> <span class="token number">400</span>  <span class="token comment"># 8 CPU, 32GB RAM</span>
        <span class="token punctuation">}</span>
        
        self<span class="token punctuation">.</span>bare_metal_costs <span class="token operator">=</span> <span class="token punctuation">{</span>
            <span class="token string">'master_node'</span><span class="token punctuation">:</span> <span class="token number">600</span><span class="token punctuation">,</span>      <span class="token comment"># Include depreciation</span>
            <span class="token string">'data_node_small'</span><span class="token punctuation">:</span> <span class="token number">1200</span><span class="token punctuation">,</span>
            <span class="token string">'data_node_large'</span><span class="token punctuation">:</span> <span class="token number">2400</span><span class="token punctuation">,</span>
            <span class="token string">'coordinator_node'</span><span class="token punctuation">:</span> <span class="token number">700</span>
        <span class="token punctuation">}</span>
        
        self<span class="token punctuation">.</span>operational_costs <span class="token operator">=</span> <span class="token punctuation">{</span>
            <span class="token string">'devops_engineer_monthly'</span><span class="token punctuation">:</span> <span class="token number">12000</span><span class="token punctuation">,</span>  <span class="token comment"># Fully loaded cost</span>
            <span class="token string">'sre_engineer_monthly'</span><span class="token punctuation">:</span> <span class="token number">15000</span><span class="token punctuation">,</span>
            <span class="token string">'training_per_engineer'</span><span class="token punctuation">:</span> <span class="token number">3000</span><span class="token punctuation">,</span>
            <span class="token string">'monitoring_tools'</span><span class="token punctuation">:</span> <span class="token number">500</span><span class="token punctuation">,</span>
            <span class="token string">'backup_storage_per_gb'</span><span class="token punctuation">:</span> <span class="token number">0.023</span><span class="token punctuation">,</span>
            <span class="token string">'network_costs'</span><span class="token punctuation">:</span> <span class="token number">1000</span>
        <span class="token punctuation">}</span>
    
    <span class="token keyword">def</span> <span class="token function">calculate_infrastructure_costs</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> deployment_type<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">,</span> 
                                     cluster_config<span class="token punctuation">:</span> Dict<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token builtin">float</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""Calculate monthly infrastructure costs"""</span>
        
        <span class="token keyword">if</span> deployment_type <span class="token operator">==</span> <span class="token string">'vm'</span><span class="token punctuation">:</span>
            cost_table <span class="token operator">=</span> self<span class="token punctuation">.</span>vm_costs
        <span class="token keyword">elif</span> deployment_type <span class="token operator">==</span> <span class="token string">'bare_metal'</span><span class="token punctuation">:</span>
            cost_table <span class="token operator">=</span> self<span class="token punctuation">.</span>bare_metal_costs
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            <span class="token keyword">raise</span> ValueError<span class="token punctuation">(</span><span class="token string">"Invalid deployment type"</span><span class="token punctuation">)</span>
        
        total_cost <span class="token operator">=</span> <span class="token number">0</span>
        
        <span class="token keyword">for</span> node_type<span class="token punctuation">,</span> count <span class="token keyword">in</span> cluster_config<span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">if</span> node_type <span class="token keyword">in</span> cost_table<span class="token punctuation">:</span>
                total_cost <span class="token operator">+=</span> cost_table<span class="token punctuation">[</span>node_type<span class="token punctuation">]</span> <span class="token operator">*</span> count
        
        <span class="token keyword">return</span> total_cost
    
    <span class="token keyword">def</span> <span class="token function">calculate_operational_costs</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> team_size<span class="token punctuation">:</span> <span class="token builtin">int</span><span class="token punctuation">,</span> 
                                  data_volume_gb<span class="token punctuation">:</span> <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> Dict<span class="token punctuation">[</span><span class="token builtin">str</span><span class="token punctuation">,</span> <span class="token builtin">float</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""Calculate monthly operational costs"""</span>
        
        <span class="token comment"># Assume 40% of team time dedicated to Elasticsearch ops</span>
        ops_percentage <span class="token operator">=</span> <span class="token number">0.4</span>
        ops_cost <span class="token operator">=</span> <span class="token punctuation">(</span>team_size <span class="token operator">*</span> self<span class="token punctuation">.</span>operational_costs<span class="token punctuation">[</span><span class="token string">'devops_engineer_monthly'</span><span class="token punctuation">]</span> <span class="token operator">*</span> 
                   ops_percentage<span class="token punctuation">)</span>
        
        <span class="token comment"># Backup storage costs</span>
        backup_cost <span class="token operator">=</span> <span class="token punctuation">(</span>data_volume_gb <span class="token operator">*</span> <span class="token number">2</span> <span class="token operator">*</span>  <span class="token comment"># 2x for retention</span>
                      self<span class="token punctuation">.</span>operational_costs<span class="token punctuation">[</span><span class="token string">'backup_storage_per_gb'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        
        <span class="token comment"># Monitoring and tooling</span>
        monitoring_cost <span class="token operator">=</span> self<span class="token punctuation">.</span>operational_costs<span class="token punctuation">[</span><span class="token string">'monitoring_tools'</span><span class="token punctuation">]</span>
        
        <span class="token comment"># Network costs</span>
        network_cost <span class="token operator">=</span> self<span class="token punctuation">.</span>operational_costs<span class="token punctuation">[</span><span class="token string">'network_costs'</span><span class="token punctuation">]</span>
        
        <span class="token keyword">return</span> <span class="token punctuation">{</span>
            <span class="token string">'operations'</span><span class="token punctuation">:</span> ops_cost<span class="token punctuation">,</span>
            <span class="token string">'backup_storage'</span><span class="token punctuation">:</span> backup_cost<span class="token punctuation">,</span>
            <span class="token string">'monitoring'</span><span class="token punctuation">:</span> monitoring_cost<span class="token punctuation">,</span>
            <span class="token string">'networking'</span><span class="token punctuation">:</span> network_cost<span class="token punctuation">,</span>
            <span class="token string">'total'</span><span class="token punctuation">:</span> ops_cost <span class="token operator">+</span> backup_cost <span class="token operator">+</span> monitoring_cost <span class="token operator">+</span> network_cost
        <span class="token punctuation">}</span>
    
    <span class="token keyword">def</span> <span class="token function">calculate_3_year_tco</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> deployment_type<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">,</span> 
                           cluster_config<span class="token punctuation">:</span> Dict<span class="token punctuation">,</span> team_size<span class="token punctuation">:</span> <span class="token builtin">int</span><span class="token punctuation">,</span> 
                           data_volume_gb<span class="token punctuation">:</span> <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> Dict<span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""Calculate 3-year Total Cost of Ownership"""</span>
        
        <span class="token comment"># Monthly costs</span>
        infrastructure_monthly <span class="token operator">=</span> self<span class="token punctuation">.</span>calculate_infrastructure_costs<span class="token punctuation">(</span>
            deployment_type<span class="token punctuation">,</span> cluster_config<span class="token punctuation">)</span>
        
        operational_breakdown <span class="token operator">=</span> self<span class="token punctuation">.</span>calculate_operational_costs<span class="token punctuation">(</span>
            team_size<span class="token punctuation">,</span> data_volume_gb<span class="token punctuation">)</span>
        operational_monthly <span class="token operator">=</span> operational_breakdown<span class="token punctuation">[</span><span class="token string">'total'</span><span class="token punctuation">]</span>
        
        <span class="token comment"># One-time costs</span>
        training_cost <span class="token operator">=</span> team_size <span class="token operator">*</span> self<span class="token punctuation">.</span>operational_costs<span class="token punctuation">[</span><span class="token string">'training_per_engineer'</span><span class="token punctuation">]</span>
        setup_cost <span class="token operator">=</span> infrastructure_monthly <span class="token operator">*</span> <span class="token number">0.5</span>  <span class="token comment"># Setup effort</span>
        
        <span class="token comment"># 3-year calculations</span>
        monthly_total <span class="token operator">=</span> infrastructure_monthly <span class="token operator">+</span> operational_monthly
        three_year_recurring <span class="token operator">=</span> monthly_total <span class="token operator">*</span> <span class="token number">36</span>
        three_year_total <span class="token operator">=</span> three_year_recurring <span class="token operator">+</span> training_cost <span class="token operator">+</span> setup_cost
        
        <span class="token comment"># Cost per GB analysis</span>
        cost_per_gb_monthly <span class="token operator">=</span> monthly_total <span class="token operator">/</span> data_volume_gb
        cost_per_gb_3year <span class="token operator">=</span> three_year_total <span class="token operator">/</span> <span class="token punctuation">(</span>data_volume_gb <span class="token operator">*</span> <span class="token number">36</span><span class="token punctuation">)</span>
        
        <span class="token keyword">return</span> <span class="token punctuation">{</span>
            <span class="token string">'monthly_breakdown'</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
                <span class="token string">'infrastructure'</span><span class="token punctuation">:</span> infrastructure_monthly<span class="token punctuation">,</span>
                <span class="token string">'operations'</span><span class="token punctuation">:</span> operational_monthly<span class="token punctuation">,</span>
                <span class="token string">'total'</span><span class="token punctuation">:</span> monthly_total
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token string">'one_time_costs'</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
                <span class="token string">'training'</span><span class="token punctuation">:</span> training_cost<span class="token punctuation">,</span>
                <span class="token string">'setup'</span><span class="token punctuation">:</span> setup_cost<span class="token punctuation">,</span>
                <span class="token string">'total'</span><span class="token punctuation">:</span> training_cost <span class="token operator">+</span> setup_cost
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token string">'three_year_total'</span><span class="token punctuation">:</span> three_year_total<span class="token punctuation">,</span>
            <span class="token string">'cost_efficiency'</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
                <span class="token string">'cost_per_gb_monthly'</span><span class="token punctuation">:</span> cost_per_gb_monthly<span class="token punctuation">,</span>
                <span class="token string">'cost_per_gb_3year'</span><span class="token punctuation">:</span> cost_per_gb_3year
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token string">'operational_breakdown'</span><span class="token punctuation">:</span> operational_breakdown
        <span class="token punctuation">}</span>
    
    <span class="token keyword">def</span> <span class="token function">compare_deployment_types</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> cluster_configs<span class="token punctuation">:</span> Dict<span class="token punctuation">,</span> 
                               team_size<span class="token punctuation">:</span> <span class="token builtin">int</span><span class="token punctuation">,</span> data_volume_gb<span class="token punctuation">:</span> <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> Dict<span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""Compare TCO across different deployment types"""</span>
        
        comparison <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
        
        <span class="token keyword">for</span> deployment_type<span class="token punctuation">,</span> config <span class="token keyword">in</span> cluster_configs<span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            tco <span class="token operator">=</span> self<span class="token punctuation">.</span>calculate_3_year_tco<span class="token punctuation">(</span>
                deployment_type<span class="token punctuation">,</span> config<span class="token punctuation">,</span> team_size<span class="token punctuation">,</span> data_volume_gb<span class="token punctuation">)</span>
            comparison<span class="token punctuation">[</span>deployment_type<span class="token punctuation">]</span> <span class="token operator">=</span> tco
        
        <span class="token comment"># Calculate savings</span>
        <span class="token keyword">if</span> <span class="token string">'vm'</span> <span class="token keyword">in</span> comparison <span class="token keyword">and</span> <span class="token string">'bare_metal'</span> <span class="token keyword">in</span> comparison<span class="token punctuation">:</span>
            vm_cost <span class="token operator">=</span> comparison<span class="token punctuation">[</span><span class="token string">'vm'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'three_year_total'</span><span class="token punctuation">]</span>
            bare_metal_cost <span class="token operator">=</span> comparison<span class="token punctuation">[</span><span class="token string">'bare_metal'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'three_year_total'</span><span class="token punctuation">]</span>
            
            <span class="token keyword">if</span> vm_cost <span class="token operator">&gt;</span> bare_metal_cost<span class="token punctuation">:</span>
                savings <span class="token operator">=</span> vm_cost <span class="token operator">-</span> bare_metal_cost
                savings_percentage <span class="token operator">=</span> <span class="token punctuation">(</span>savings <span class="token operator">/</span> vm_cost<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">100</span>
                comparison<span class="token punctuation">[</span><span class="token string">'savings_analysis'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
                    <span class="token string">'bare_metal_saves'</span><span class="token punctuation">:</span> savings<span class="token punctuation">,</span>
                    <span class="token string">'savings_percentage'</span><span class="token punctuation">:</span> savings_percentage<span class="token punctuation">,</span>
                    <span class="token string">'break_even_months'</span><span class="token punctuation">:</span> <span class="token number">0</span>  <span class="token comment"># Calculate break-even point</span>
                <span class="token punctuation">}</span>
        
        <span class="token keyword">return</span> comparison

<span class="token comment"># Example usage and reporting</span>
<span class="token keyword">def</span> <span class="token function">generate_tco_report</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    calculator <span class="token operator">=</span> ElasticsearchTCOCalculator<span class="token punctuation">(</span><span class="token punctuation">)</span>
    
    <span class="token comment"># Example cluster configurations</span>
    cluster_configs <span class="token operator">=</span> <span class="token punctuation">{</span>
        <span class="token string">'vm'</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
            <span class="token string">'master_node'</span><span class="token punctuation">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
            <span class="token string">'data_node_large'</span><span class="token punctuation">:</span> <span class="token number">6</span><span class="token punctuation">,</span>
            <span class="token string">'coordinator_node'</span><span class="token punctuation">:</span> <span class="token number">2</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token string">'bare_metal'</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
            <span class="token string">'master_node'</span><span class="token punctuation">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
            <span class="token string">'data_node_large'</span><span class="token punctuation">:</span> <span class="token number">6</span><span class="token punctuation">,</span>
            <span class="token string">'coordinator_node'</span><span class="token punctuation">:</span> <span class="token number">2</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    
    <span class="token comment"># Analysis parameters</span>
    team_size <span class="token operator">=</span> <span class="token number">8</span>
    data_volume_gb <span class="token operator">=</span> <span class="token number">50000</span>  <span class="token comment"># 50TB</span>
    
    <span class="token comment"># Generate comparison</span>
    comparison <span class="token operator">=</span> calculator<span class="token punctuation">.</span>compare_deployment_types<span class="token punctuation">(</span>
        cluster_configs<span class="token punctuation">,</span> team_size<span class="token punctuation">,</span> data_volume_gb<span class="token punctuation">)</span>
    
    <span class="token comment"># Print formatted report</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"="</span> <span class="token operator">*</span> <span class="token number">60</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"ELASTICSEARCH DEPLOYMENT TCO ANALYSIS"</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"="</span> <span class="token operator">*</span> <span class="token number">60</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Cluster Size: </span><span class="token interpolation"><span class="token punctuation">{</span>data_volume_gb<span class="token operator">/</span><span class="token number">1000</span><span class="token punctuation">:</span><span class="token format-spec">.1f</span><span class="token punctuation">}</span></span><span class="token string">TB"</span></span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Team Size: </span><span class="token interpolation"><span class="token punctuation">{</span>team_size<span class="token punctuation">}</span></span><span class="token string"> engineers"</span></span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Analysis Period: 3 years"</span></span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    
    <span class="token keyword">for</span> deployment_type<span class="token punctuation">,</span> tco <span class="token keyword">in</span> comparison<span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> deployment_type <span class="token operator">==</span> <span class="token string">'savings_analysis'</span><span class="token punctuation">:</span>
            <span class="token keyword">continue</span>
            
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">{</span>deployment_type<span class="token punctuation">.</span>upper<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string"> DEPLOYMENT:"</span></span><span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"  Monthly Infrastructure: $</span><span class="token interpolation"><span class="token punctuation">{</span>tco<span class="token punctuation">[</span><span class="token string">'monthly_breakdown'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'infrastructure'</span><span class="token punctuation">]</span><span class="token punctuation">:</span><span class="token format-spec">,.0f</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"  Monthly Operations: $</span><span class="token interpolation"><span class="token punctuation">{</span>tco<span class="token punctuation">[</span><span class="token string">'monthly_breakdown'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'operations'</span><span class="token punctuation">]</span><span class="token punctuation">:</span><span class="token format-spec">,.0f</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"  Monthly Total: $</span><span class="token interpolation"><span class="token punctuation">{</span>tco<span class="token punctuation">[</span><span class="token string">'monthly_breakdown'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'total'</span><span class="token punctuation">]</span><span class="token punctuation">:</span><span class="token format-spec">,.0f</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"  3-Year Total: $</span><span class="token interpolation"><span class="token punctuation">{</span>tco<span class="token punctuation">[</span><span class="token string">'three_year_total'</span><span class="token punctuation">]</span><span class="token punctuation">:</span><span class="token format-spec">,.0f</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"  Cost per GB/month: $</span><span class="token interpolation"><span class="token punctuation">{</span>tco<span class="token punctuation">[</span><span class="token string">'cost_efficiency'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'cost_per_gb_monthly'</span><span class="token punctuation">]</span><span class="token punctuation">:</span><span class="token format-spec">.2f</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    
    <span class="token keyword">if</span> <span class="token string">'savings_analysis'</span> <span class="token keyword">in</span> comparison<span class="token punctuation">:</span>
        savings <span class="token operator">=</span> comparison<span class="token punctuation">[</span><span class="token string">'savings_analysis'</span><span class="token punctuation">]</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"SAVINGS ANALYSIS:"</span><span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"  Bare Metal Saves: $</span><span class="token interpolation"><span class="token punctuation">{</span>savings<span class="token punctuation">[</span><span class="token string">'bare_metal_saves'</span><span class="token punctuation">]</span><span class="token punctuation">:</span><span class="token format-spec">,.0f</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"  Savings Percentage: </span><span class="token interpolation"><span class="token punctuation">{</span>savings<span class="token punctuation">[</span><span class="token string">'savings_percentage'</span><span class="token punctuation">]</span><span class="token punctuation">:</span><span class="token format-spec">.1f</span><span class="token punctuation">}</span></span><span class="token string">%"</span></span><span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    
    <span class="token keyword">return</span> comparison

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>
    report <span class="token operator">=</span> generate_tco_report<span class="token punctuation">(</span><span class="token punctuation">)</span>
    
    <span class="token comment"># Save detailed report to JSON</span>
    <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'elasticsearch_tco_analysis.json'</span><span class="token punctuation">,</span> <span class="token string">'w'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
        json<span class="token punctuation">.</span>dump<span class="token punctuation">(</span>report<span class="token punctuation">,</span> f<span class="token punctuation">,</span> indent<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span>
    
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Detailed analysis saved to elasticsearch_tco_analysis.json"</span><span class="token punctuation">)</span>
</code></pre>
</div>
<hr>

        <h2 id="decision-framework-summary" class="group relative scroll-mt-20 text-2xl font-semibold mb-4 mt-6 border-b border-gray-200 dark:border-gray-700 pb-2">
          <a class="anchor absolute -ml-10 flex items-center opacity-0 group-hover:opacity-100 transition-opacity duration-200" aria-label="Link to this section" href="#decision-framework-summary">
            <svg class="octicon octicon-link" viewBox="0 0 16 16" aria-hidden="true">
              <path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path>
            </svg>
          </a>
          <span>Decision Framework Summary</span>
        <a href="#/blog/self-managed-elasticsearch-vm-bare-metal-production-guide#decision-framework-summary" class="header-link" style="opacity: 0; margin-left: 8px; text-decoration: none; color: rgb(107, 114, 128); transition: opacity 0.2s; cursor: pointer;">#</a></h2>
      

        <h3 id="self-managed-vs-alternatives" class="group relative scroll-mt-20 text-xl font-semibold mb-3 mt-5">
          <a class="anchor absolute -ml-10 flex items-center opacity-0 group-hover:opacity-100 transition-opacity duration-200" aria-label="Link to this section" href="#self-managed-vs-alternatives">
            <svg class="octicon octicon-link" viewBox="0 0 16 16" aria-hidden="true">
              <path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path>
            </svg>
          </a>
          <span>Self-Managed vs Alternatives</span>
        <a href="#/blog/self-managed-elasticsearch-vm-bare-metal-production-guide#self-managed-vs-alternatives" class="header-link" style="opacity: 0; margin-left: 8px; text-decoration: none; color: rgb(107, 114, 128); transition: opacity 0.2s; cursor: pointer;">#</a></h3>
      
<div class="highlight highlight-yaml notranslate" style="background-color: transparent !important; border: none !important; border-radius: 0px !important; padding: 0px !important; margin: 0px !important;">
<pre class="notranslate language-yaml" tabindex="0" style="border-radius: 0.75rem !important; padding: 16px !important; margin: 16px 0px !important; overflow-x: auto !important; font-size: 14px !important; line-height: 1.5 !important; white-space: pre-wrap !important; overflow-wrap: normal !important; text-wrap-style: initial !important; word-break: normal !important;"><code class="language-yaml" style="background: transparent !important; border: none !important; border-radius: 0px !important; font-family: ui-monospace, SFMono-Regular, &quot;SF Mono&quot;, Consolas, &quot;Liberation Mono&quot;, Menlo, monospace !important; font-size: 15px !important; line-height: 1.6 !important; padding: 0px !important; font-weight: 500 !important; text-rendering: geometricprecision !important; -webkit-font-smoothing: subpixel-antialiased !important; letter-spacing: 0.025em !important; white-space: pre-wrap !important; overflow-wrap: normal !important; text-wrap-style: initial !important; word-break: normal !important;"><span class="token comment"># Decision matrix for self-managed Elasticsearch</span>
<span class="token key atrule">choose_self_managed_when</span><span class="token punctuation">:</span>
  <span class="token key atrule">technical_requirements</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token string">"Need custom performance tuning and optimization"</span>
    <span class="token punctuation">-</span> <span class="token string">"Require specific plugins or custom analyzers"</span>
    <span class="token punctuation">-</span> <span class="token string">"Have unique security or compliance requirements"</span>
    <span class="token punctuation">-</span> <span class="token string">"Need integration with existing infrastructure"</span>
    
  <span class="token key atrule">operational_capabilities</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token string">"Team has strong Linux and Elasticsearch expertise"</span>
    <span class="token punctuation">-</span> <span class="token string">"Dedicated DevOps/SRE resources available"</span>
    <span class="token punctuation">-</span> <span class="token string">"Existing infrastructure automation in place"</span>
    <span class="token punctuation">-</span> <span class="token string">"24/7 monitoring and support capability"</span>
    
  <span class="token key atrule">economic_factors</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token string">"Data volume &gt;10TB with predictable growth"</span>
    <span class="token punctuation">-</span> <span class="token string">"Long-term deployment (&gt;2 years)"</span>
    <span class="token punctuation">-</span> <span class="token string">"Cost optimization is primary concern"</span>
    <span class="token punctuation">-</span> <span class="token string">"Existing hardware or cloud credits available"</span>
    
  <span class="token key atrule">business_requirements</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token string">"Full control over data location and processing"</span>
    <span class="token punctuation">-</span> <span class="token string">"Strict SLA requirements with penalties"</span>
    <span class="token punctuation">-</span> <span class="token string">"Integration with existing backup/DR procedures"</span>
    <span class="token punctuation">-</span> <span class="token string">"Regulatory compliance needs custom implementation"</span>

<span class="token key atrule">avoid_self_managed_when</span><span class="token punctuation">:</span>
  <span class="token key atrule">constraints</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token string">"Team size &lt;5 engineers"</span>
    <span class="token punctuation">-</span> <span class="token string">"Limited operational expertise"</span>
    <span class="token punctuation">-</span> <span class="token string">"Rapid time-to-market requirements"</span>
    <span class="token punctuation">-</span> <span class="token string">"Uncertain growth patterns"</span>
    <span class="token punctuation">-</span> <span class="token string">"Budget constraints for operational overhead"</span>
</code></pre>
</div>

        <h3 id="roi-analysis-framework" class="group relative scroll-mt-20 text-xl font-semibold mb-3 mt-5">
          <a class="anchor absolute -ml-10 flex items-center opacity-0 group-hover:opacity-100 transition-opacity duration-200" aria-label="Link to this section" href="#roi-analysis-framework">
            <svg class="octicon octicon-link" viewBox="0 0 16 16" aria-hidden="true">
              <path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path>
            </svg>
          </a>
          <span>ROI Analysis Framework</span>
        <a href="#/blog/self-managed-elasticsearch-vm-bare-metal-production-guide#roi-analysis-framework" class="header-link" style="opacity: 0; margin-left: 8px; text-decoration: none; color: rgb(107, 114, 128); transition: opacity 0.2s; cursor: pointer;">#</a></h3>
      
<div class="highlight highlight-yaml notranslate" style="background-color: transparent !important; border: none !important; border-radius: 0px !important; padding: 0px !important; margin: 0px !important;">
<pre class="notranslate language-yaml" tabindex="0" style="border-radius: 0.75rem !important; padding: 16px !important; margin: 16px 0px !important; overflow-x: auto !important; font-size: 14px !important; line-height: 1.5 !important; white-space: pre-wrap !important; overflow-wrap: normal !important; text-wrap-style: initial !important; word-break: normal !important;"><code class="language-yaml" style="background: transparent !important; border: none !important; border-radius: 0px !important; font-family: ui-monospace, SFMono-Regular, &quot;SF Mono&quot;, Consolas, &quot;Liberation Mono&quot;, Menlo, monospace !important; font-size: 15px !important; line-height: 1.6 !important; padding: 0px !important; font-weight: 500 !important; text-rendering: geometricprecision !important; -webkit-font-smoothing: subpixel-antialiased !important; letter-spacing: 0.025em !important; white-space: pre-wrap !important; overflow-wrap: normal !important; text-wrap-style: initial !important; word-break: normal !important;"><span class="token comment"># Return on Investment analysis for self-managed deployments</span>
<span class="token key atrule">roi_calculation</span><span class="token punctuation">:</span>
  <span class="token key atrule">investment_factors</span><span class="token punctuation">:</span>
    <span class="token key atrule">initial_setup</span><span class="token punctuation">:</span> <span class="token string">"Hardware + setup time + training"</span>
    <span class="token key atrule">operational_overhead</span><span class="token punctuation">:</span> <span class="token string">"40-60% of team time ongoing"</span>
    <span class="token key atrule">tooling_and_automation</span><span class="token punctuation">:</span> <span class="token string">"Monitoring, backup, automation tools"</span>
    
  <span class="token key atrule">return_factors</span><span class="token punctuation">:</span>
    <span class="token key atrule">cost_savings</span><span class="token punctuation">:</span> <span class="token string">"40-60% vs managed solutions at scale"</span>
    <span class="token key atrule">performance_gains</span><span class="token punctuation">:</span> <span class="token string">"20-40% better performance through optimization"</span>
    <span class="token key atrule">feature_flexibility</span><span class="token punctuation">:</span> <span class="token string">"Access to full Elasticsearch ecosystem"</span>
    <span class="token key atrule">vendor_independence</span><span class="token punctuation">:</span> <span class="token string">"No lock-in, full migration flexibility"</span>
    
  <span class="token key atrule">break_even_analysis</span><span class="token punctuation">:</span>
    <span class="token key atrule">typical_break_even</span><span class="token punctuation">:</span> <span class="token string">"12-18 months for &gt;10TB deployments"</span>
    <span class="token key atrule">factors_affecting_timeline</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token string">"Team learning curve (3-6 months)"</span>
      <span class="token punctuation">-</span> <span class="token string">"Infrastructure setup complexity"</span>
      <span class="token punctuation">-</span> <span class="token string">"Data volume and growth rate"</span>
      <span class="token punctuation">-</span> <span class="token string">"Optimization effort investment"</span>
</code></pre>
</div>
<hr>

        <h2 id="production-readiness-checklist" class="group relative scroll-mt-20 text-2xl font-semibold mb-4 mt-6 border-b border-gray-200 dark:border-gray-700 pb-2">
          <a class="anchor absolute -ml-10 flex items-center opacity-0 group-hover:opacity-100 transition-opacity duration-200" aria-label="Link to this section" href="#production-readiness-checklist">
            <svg class="octicon octicon-link" viewBox="0 0 16 16" aria-hidden="true">
              <path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path>
            </svg>
          </a>
          <span>Production Readiness Checklist</span>
        <a href="#/blog/self-managed-elasticsearch-vm-bare-metal-production-guide#production-readiness-checklist" class="header-link" style="opacity: 0; margin-left: 8px; text-decoration: none; color: rgb(107, 114, 128); transition: opacity 0.2s; cursor: pointer;">#</a></h2>
      

        <h3 id="pre-production-validation" class="group relative scroll-mt-20 text-xl font-semibold mb-3 mt-5">
          <a class="anchor absolute -ml-10 flex items-center opacity-0 group-hover:opacity-100 transition-opacity duration-200" aria-label="Link to this section" href="#pre-production-validation">
            <svg class="octicon octicon-link" viewBox="0 0 16 16" aria-hidden="true">
              <path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path>
            </svg>
          </a>
          <span>Pre-Production Validation</span>
        <a href="#/blog/self-managed-elasticsearch-vm-bare-metal-production-guide#pre-production-validation" class="header-link" style="opacity: 0; margin-left: 8px; text-decoration: none; color: rgb(107, 114, 128); transition: opacity 0.2s; cursor: pointer;">#</a></h3>
      
<div class="highlight highlight-bash notranslate" style="background-color: transparent !important; border: none !important; border-radius: 0px !important; padding: 0px !important; margin: 0px !important;">
<pre class="notranslate language-bash" tabindex="0" style="border-radius: 0.75rem !important; padding: 16px !important; margin: 16px 0px !important; overflow-x: auto !important; font-size: 14px !important; line-height: 1.5 !important; white-space: pre-wrap !important; overflow-wrap: normal !important; text-wrap-style: initial !important; word-break: normal !important;"><code class="language-bash" style="background: transparent !important; border: none !important; border-radius: 0px !important; font-family: ui-monospace, SFMono-Regular, &quot;SF Mono&quot;, Consolas, &quot;Liberation Mono&quot;, Menlo, monospace !important; font-size: 15px !important; line-height: 1.6 !important; padding: 0px !important; font-weight: 500 !important; text-rendering: geometricprecision !important; -webkit-font-smoothing: subpixel-antialiased !important; letter-spacing: 0.025em !important; white-space: pre-wrap !important; overflow-wrap: normal !important; text-wrap-style: initial !important; word-break: normal !important;"><span class="token shebang important">#!/bin/bash</span>
<span class="token comment"># elasticsearch_production_readiness.sh</span>

<span class="token assign-left variable">CLUSTER_ENDPOINT</span><span class="token operator">=</span><span class="token string">"http://localhost:9200"</span>
<span class="token assign-left variable">CHECKLIST_LOG</span><span class="token operator">=</span><span class="token string">"/var/log/elasticsearch_readiness.log"</span>

<span class="token comment"># Function to log results</span>
<span class="token function-name function">log_check</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token builtin class-name">local</span> <span class="token assign-left variable">check_name</span><span class="token operator">=</span><span class="token variable">$1</span>
    <span class="token builtin class-name">local</span> <span class="token assign-left variable">status</span><span class="token operator">=</span><span class="token variable">$2</span>
    <span class="token builtin class-name">local</span> <span class="token assign-left variable">details</span><span class="token operator">=</span><span class="token variable">$3</span>
    
    <span class="token builtin class-name">echo</span> <span class="token string">"<span class="token variable"><span class="token variable">$(</span><span class="token function">date</span> <span class="token string">'+%Y-%m-%d %H:%M:%S'</span><span class="token variable">)</span></span> - [<span class="token variable">$status</span>] <span class="token variable">$check_name</span>: <span class="token variable">$details</span>"</span> <span class="token operator">|</span> <span class="token function">tee</span> <span class="token parameter variable">-a</span> <span class="token string">"<span class="token variable">$CHECKLIST_LOG</span>"</span>
<span class="token punctuation">}</span>

<span class="token comment"># Function to check cluster health</span>
<span class="token function-name function">check_cluster_health</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token builtin class-name">local</span> <span class="token assign-left variable">health</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token function">curl</span> <span class="token parameter variable">-s</span> <span class="token string">"<span class="token variable">$CLUSTER_ENDPOINT</span>/_cluster/health"</span><span class="token variable">)</span></span>
    <span class="token builtin class-name">local</span> <span class="token assign-left variable">status</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token builtin class-name">echo</span> <span class="token string">"<span class="token variable">$health</span>"</span> <span class="token operator">|</span> jq <span class="token parameter variable">-r</span> <span class="token string">'.status'</span><span class="token variable">)</span></span>
    <span class="token builtin class-name">local</span> <span class="token assign-left variable">nodes</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token builtin class-name">echo</span> <span class="token string">"<span class="token variable">$health</span>"</span> <span class="token operator">|</span> jq <span class="token parameter variable">-r</span> <span class="token string">'.number_of_nodes'</span><span class="token variable">)</span></span>
    <span class="token builtin class-name">local</span> <span class="token assign-left variable">data_nodes</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token builtin class-name">echo</span> <span class="token string">"<span class="token variable">$health</span>"</span> <span class="token operator">|</span> jq <span class="token parameter variable">-r</span> <span class="token string">'.number_of_data_nodes'</span><span class="token variable">)</span></span>
    
    <span class="token keyword">if</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token string">"<span class="token variable">$status</span>"</span> <span class="token operator">==</span> <span class="token string">"green"</span> <span class="token operator">&amp;&amp;</span> <span class="token string">"<span class="token variable">$nodes</span>"</span> <span class="token parameter variable">-ge</span> <span class="token number">3</span> <span class="token operator">&amp;&amp;</span> <span class="token string">"<span class="token variable">$data_nodes</span>"</span> <span class="token parameter variable">-ge</span> <span class="token number">3</span> <span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
        log_check <span class="token string">"Cluster Health"</span> <span class="token string">"PASS"</span> <span class="token string">"Status: <span class="token variable">$status</span>, Nodes: <span class="token variable">$nodes</span>, Data nodes: <span class="token variable">$data_nodes</span>"</span>
        <span class="token builtin class-name">return</span> <span class="token number">0</span>
    <span class="token keyword">else</span>
        log_check <span class="token string">"Cluster Health"</span> <span class="token string">"FAIL"</span> <span class="token string">"Status: <span class="token variable">$status</span>, Nodes: <span class="token variable">$nodes</span>, Data nodes: <span class="token variable">$data_nodes</span>"</span>
        <span class="token builtin class-name">return</span> <span class="token number">1</span>
    <span class="token keyword">fi</span>
<span class="token punctuation">}</span>

<span class="token comment"># Function to check security configuration</span>
<span class="token function-name function">check_security</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token builtin class-name">local</span> <span class="token assign-left variable">security_enabled</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token function">curl</span> <span class="token parameter variable">-s</span> <span class="token string">"<span class="token variable">$CLUSTER_ENDPOINT</span>/_xpack/security"</span> <span class="token operator">|</span> jq <span class="token parameter variable">-r</span> <span class="token string">'.enabled'</span><span class="token variable">)</span></span>
    <span class="token builtin class-name">local</span> <span class="token assign-left variable">ssl_check</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token function">curl</span> <span class="token parameter variable">-sk</span> <span class="token string">"https://localhost:9200"</span> <span class="token parameter variable">-o</span> /dev/null <span class="token parameter variable">-w</span> <span class="token string">"%{http_code}"</span><span class="token variable">)</span></span>
    
    <span class="token keyword">if</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token string">"<span class="token variable">$security_enabled</span>"</span> <span class="token operator">==</span> <span class="token string">"true"</span> <span class="token operator">&amp;&amp;</span> <span class="token string">"<span class="token variable">$ssl_check</span>"</span> <span class="token operator">==</span> <span class="token string">"200"</span> <span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
        log_check <span class="token string">"Security Configuration"</span> <span class="token string">"PASS"</span> <span class="token string">"Security enabled, SSL configured"</span>
        <span class="token builtin class-name">return</span> <span class="token number">0</span>
    <span class="token keyword">else</span>
        log_check <span class="token string">"Security Configuration"</span> <span class="token string">"FAIL"</span> <span class="token string">"Security: <span class="token variable">$security_enabled</span>, SSL: <span class="token variable">$ssl_check</span>"</span>
        <span class="token builtin class-name">return</span> <span class="token number">1</span>
    <span class="token keyword">fi</span>
<span class="token punctuation">}</span>

<span class="token comment"># Function to check backup configuration</span>
<span class="token function-name function">check_backup</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token builtin class-name">local</span> <span class="token assign-left variable">repos</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token function">curl</span> <span class="token parameter variable">-s</span> <span class="token string">"<span class="token variable">$CLUSTER_ENDPOINT</span>/_snapshot"</span> <span class="token operator">|</span> jq <span class="token string">'. | length'</span><span class="token variable">)</span></span>
    <span class="token builtin class-name">local</span> <span class="token assign-left variable">latest_snapshot</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token function">curl</span> <span class="token parameter variable">-s</span> <span class="token string">"<span class="token variable">$CLUSTER_ENDPOINT</span>/_snapshot/_all/_all"</span> <span class="token operator">|</span> jq <span class="token parameter variable">-r</span> <span class="token string">'.snapshots[-1].snapshot // "none"'</span><span class="token variable">)</span></span>
    
    <span class="token keyword">if</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token string">"<span class="token variable">$repos</span>"</span> <span class="token parameter variable">-gt</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> <span class="token string">"<span class="token variable">$latest_snapshot</span>"</span> <span class="token operator">!=</span> <span class="token string">"none"</span> <span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
        log_check <span class="token string">"Backup Configuration"</span> <span class="token string">"PASS"</span> <span class="token string">"Repositories: <span class="token variable">$repos</span>, Latest snapshot: <span class="token variable">$latest_snapshot</span>"</span>
        <span class="token builtin class-name">return</span> <span class="token number">0</span>
    <span class="token keyword">else</span>
        log_check <span class="token string">"Backup Configuration"</span> <span class="token string">"FAIL"</span> <span class="token string">"Repositories: <span class="token variable">$repos</span>, Latest snapshot: <span class="token variable">$latest_snapshot</span>"</span>
        <span class="token builtin class-name">return</span> <span class="token number">1</span>
    <span class="token keyword">fi</span>
<span class="token punctuation">}</span>

<span class="token comment"># Function to check monitoring</span>
<span class="token function-name function">check_monitoring</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token builtin class-name">local</span> <span class="token assign-left variable">monitoring_enabled</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token function">curl</span> <span class="token parameter variable">-s</span> <span class="token string">"<span class="token variable">$CLUSTER_ENDPOINT</span>/_xpack/monitoring"</span> <span class="token operator">|</span> jq <span class="token parameter variable">-r</span> <span class="token string">'.enabled'</span><span class="token variable">)</span></span>
    <span class="token builtin class-name">local</span> <span class="token assign-left variable">prometheus_metrics</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token function">curl</span> <span class="token parameter variable">-s</span> <span class="token string">"http://localhost:9114/metrics"</span> <span class="token operator">|</span> <span class="token function">grep</span> <span class="token parameter variable">-c</span> <span class="token string">"elasticsearch_"</span><span class="token variable">)</span></span>
    
    <span class="token keyword">if</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token string">"<span class="token variable">$monitoring_enabled</span>"</span> <span class="token operator">==</span> <span class="token string">"true"</span> <span class="token operator">&amp;&amp;</span> <span class="token string">"<span class="token variable">$prometheus_metrics</span>"</span> <span class="token parameter variable">-gt</span> <span class="token number">0</span> <span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
        log_check <span class="token string">"Monitoring Setup"</span> <span class="token string">"PASS"</span> <span class="token string">"X-Pack monitoring: enabled, Prometheus metrics: <span class="token variable">$prometheus_metrics</span>"</span>
        <span class="token builtin class-name">return</span> <span class="token number">0</span>
    <span class="token keyword">else</span>
        log_check <span class="token string">"Monitoring Setup"</span> <span class="token string">"FAIL"</span> <span class="token string">"X-Pack monitoring: <span class="token variable">$monitoring_enabled</span>, Prometheus metrics: <span class="token variable">$prometheus_metrics</span>"</span>
        <span class="token builtin class-name">return</span> <span class="token number">1</span>
    <span class="token keyword">fi</span>
<span class="token punctuation">}</span>

<span class="token comment"># Function to check performance baselines</span>
<span class="token function-name function">check_performance</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    log_check <span class="token string">"Performance Baseline"</span> <span class="token string">"INFO"</span> <span class="token string">"Starting performance validation..."</span>
    
    <span class="token comment"># Create test index</span>
    <span class="token function">curl</span> <span class="token parameter variable">-X</span> PUT <span class="token string">"<span class="token variable">$CLUSTER_ENDPOINT</span>/performance_test"</span> <span class="token punctuation">\</span>
        <span class="token parameter variable">-H</span> <span class="token string">"Content-Type: application/json"</span> <span class="token punctuation">\</span>
        <span class="token parameter variable">-d</span> <span class="token string">'{
            "settings": {
                "number_of_shards": 1,
                "number_of_replicas": 1
            },
            "mappings": {
                "properties": {
                    "timestamp": {"type": "date"},
                    "message": {"type": "text"},
                    "value": {"type": "integer"}
                }
            }
        }'</span>
    
    <span class="token comment"># Index test data</span>
    <span class="token builtin class-name">local</span> <span class="token assign-left variable">start_time</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token function">date</span> +%s<span class="token variable">)</span></span>
    <span class="token keyword">for</span> <span class="token for-or-select variable">i</span> <span class="token keyword">in</span> <span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">..</span><span class="token number">1000</span><span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token keyword">do</span>
        <span class="token function">curl</span> <span class="token parameter variable">-X</span> POST <span class="token string">"<span class="token variable">$CLUSTER_ENDPOINT</span>/performance_test/_doc"</span> <span class="token punctuation">\</span>
            <span class="token parameter variable">-H</span> <span class="token string">"Content-Type: application/json"</span> <span class="token punctuation">\</span>
            <span class="token parameter variable">-d</span> <span class="token string">"{
                <span class="token entity" title="\&quot;">\"</span>timestamp<span class="token entity" title="\&quot;">\"</span>: <span class="token entity" title="\&quot;">\"</span><span class="token variable"><span class="token variable">$(</span><span class="token function">date</span> <span class="token parameter variable">-Iseconds</span><span class="token variable">)</span></span><span class="token entity" title="\&quot;">\"</span>,
                <span class="token entity" title="\&quot;">\"</span>message<span class="token entity" title="\&quot;">\"</span>: <span class="token entity" title="\&quot;">\"</span>Test message <span class="token variable">$i</span><span class="token entity" title="\&quot;">\"</span>,
                <span class="token entity" title="\&quot;">\"</span>value<span class="token entity" title="\&quot;">\"</span>: <span class="token variable">$i</span>
            }"</span> <span class="token operator">&gt;</span> /dev/null <span class="token operator"><span class="token file-descriptor important">2</span>&gt;</span><span class="token file-descriptor important">&amp;1</span>
    <span class="token keyword">done</span>
    <span class="token builtin class-name">local</span> <span class="token assign-left variable">end_time</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token function">date</span> +%s<span class="token variable">)</span></span>
    <span class="token builtin class-name">local</span> <span class="token assign-left variable">indexing_time</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$((</span>end_time <span class="token operator">-</span> start_time<span class="token variable">))</span></span>
    
    <span class="token comment"># Test search performance</span>
    <span class="token builtin class-name">local</span> <span class="token assign-left variable">search_start</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token function">date</span> +%s%3N<span class="token variable">)</span></span>
    <span class="token function">curl</span> <span class="token parameter variable">-s</span> <span class="token string">"<span class="token variable">$CLUSTER_ENDPOINT</span>/performance_test/_search?q=message:test"</span> <span class="token operator">&gt;</span> /dev/null
    <span class="token builtin class-name">local</span> <span class="token assign-left variable">search_end</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token function">date</span> +%s%3N<span class="token variable">)</span></span>
    <span class="token builtin class-name">local</span> <span class="token assign-left variable">search_time</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$((</span>search_end <span class="token operator">-</span> search_start<span class="token variable">))</span></span>
    
    <span class="token comment"># Cleanup</span>
    <span class="token function">curl</span> <span class="token parameter variable">-X</span> DELETE <span class="token string">"<span class="token variable">$CLUSTER_ENDPOINT</span>/performance_test"</span>
    
    <span class="token keyword">if</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token string">"<span class="token variable">$indexing_time</span>"</span> <span class="token parameter variable">-lt</span> <span class="token number">30</span> <span class="token operator">&amp;&amp;</span> <span class="token string">"<span class="token variable">$search_time</span>"</span> <span class="token parameter variable">-lt</span> <span class="token number">100</span> <span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
        log_check <span class="token string">"Performance Baseline"</span> <span class="token string">"PASS"</span> <span class="token string">"Indexing: <span class="token variable">${indexing_time}</span>s for 1000 docs, Search: <span class="token variable">${search_time}</span>ms"</span>
        <span class="token builtin class-name">return</span> <span class="token number">0</span>
    <span class="token keyword">else</span>
        log_check <span class="token string">"Performance Baseline"</span> <span class="token string">"WARN"</span> <span class="token string">"Indexing: <span class="token variable">${indexing_time}</span>s for 1000 docs, Search: <span class="token variable">${search_time}</span>ms"</span>
        <span class="token builtin class-name">return</span> <span class="token number">1</span>
    <span class="token keyword">fi</span>
<span class="token punctuation">}</span>

<span class="token comment"># Function to check resource limits</span>
<span class="token function-name function">check_resource_limits</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token builtin class-name">local</span> <span class="token assign-left variable">nodes_stats</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token function">curl</span> <span class="token parameter variable">-s</span> <span class="token string">"<span class="token variable">$CLUSTER_ENDPOINT</span>/_nodes/stats"</span><span class="token variable">)</span></span>
    <span class="token builtin class-name">local</span> <span class="token assign-left variable">issues</span><span class="token operator">=</span><span class="token number">0</span>
    
    <span class="token comment"># Check heap usage across nodes</span>
    <span class="token builtin class-name">echo</span> <span class="token string">"<span class="token variable">$nodes_stats</span>"</span> <span class="token operator">|</span> jq <span class="token parameter variable">-r</span> <span class="token string">'.nodes | to_entries[] | 
        "\(.value.name) \(.value.jvm.mem.heap_used_percent)"'</span> <span class="token operator">|</span> 
    <span class="token keyword">while</span> <span class="token builtin class-name">read</span> <span class="token parameter variable">-r</span> node_name heap_percent<span class="token punctuation">;</span> <span class="token keyword">do</span>
        <span class="token keyword">if</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token string">"<span class="token variable">$heap_percent</span>"</span> <span class="token parameter variable">-gt</span> <span class="token number">75</span> <span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
            log_check <span class="token string">"Resource Limits"</span> <span class="token string">"WARN"</span> <span class="token string">"Node <span class="token variable">$node_name</span> heap usage: <span class="token variable">${heap_percent}</span>%"</span>
            <span class="token variable"><span class="token punctuation">((</span>issues<span class="token operator">++</span><span class="token punctuation">))</span></span>
        <span class="token keyword">fi</span>
    <span class="token keyword">done</span>
    
    <span class="token comment"># Check disk usage</span>
    <span class="token builtin class-name">echo</span> <span class="token string">"<span class="token variable">$nodes_stats</span>"</span> <span class="token operator">|</span> jq <span class="token parameter variable">-r</span> <span class="token string">'.nodes | to_entries[] |
        "\(.value.name) \((.value.fs.total.total_in_bytes - .value.fs.total.available_in_bytes) / .value.fs.total.total_in_bytes * 100 | floor)"'</span> <span class="token operator">|</span>
    <span class="token keyword">while</span> <span class="token builtin class-name">read</span> <span class="token parameter variable">-r</span> node_name disk_percent<span class="token punctuation">;</span> <span class="token keyword">do</span>
        <span class="token keyword">if</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token string">"<span class="token variable">$disk_percent</span>"</span> <span class="token parameter variable">-gt</span> <span class="token number">80</span> <span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
            log_check <span class="token string">"Resource Limits"</span> <span class="token string">"WARN"</span> <span class="token string">"Node <span class="token variable">$node_name</span> disk usage: <span class="token variable">${disk_percent}</span>%"</span>
            <span class="token variable"><span class="token punctuation">((</span>issues<span class="token operator">++</span><span class="token punctuation">))</span></span>
        <span class="token keyword">fi</span>
    <span class="token keyword">done</span>
    
    <span class="token keyword">if</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token string">"<span class="token variable">$issues</span>"</span> <span class="token parameter variable">-eq</span> <span class="token number">0</span> <span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
        log_check <span class="token string">"Resource Limits"</span> <span class="token string">"PASS"</span> <span class="token string">"All nodes within acceptable resource limits"</span>
        <span class="token builtin class-name">return</span> <span class="token number">0</span>
    <span class="token keyword">else</span>
        log_check <span class="token string">"Resource Limits"</span> <span class="token string">"FAIL"</span> <span class="token string">"<span class="token variable">$issues</span> nodes with resource issues"</span>
        <span class="token builtin class-name">return</span> <span class="token number">1</span>
    <span class="token keyword">fi</span>
<span class="token punctuation">}</span>

<span class="token comment"># Function to check disaster recovery procedures</span>
<span class="token function-name function">check_disaster_recovery</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment"># Check if DR documentation exists</span>
    <span class="token keyword">if</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token parameter variable">-f</span> <span class="token string">"/opt/elasticsearch/dr_procedures.md"</span> <span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
        log_check <span class="token string">"Disaster Recovery"</span> <span class="token string">"PASS"</span> <span class="token string">"DR documentation found"</span>
    <span class="token keyword">else</span>
        log_check <span class="token string">"Disaster Recovery"</span> <span class="token string">"FAIL"</span> <span class="token string">"DR documentation missing"</span>
        <span class="token builtin class-name">return</span> <span class="token number">1</span>
    <span class="token keyword">fi</span>
    
    <span class="token comment"># Check if backup restoration has been tested</span>
    <span class="token builtin class-name">local</span> <span class="token assign-left variable">test_restore_log</span><span class="token operator">=</span><span class="token string">"/var/log/backup_test.log"</span>
    <span class="token keyword">if</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token parameter variable">-f</span> <span class="token string">"<span class="token variable">$test_restore_log</span>"</span> <span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
        <span class="token builtin class-name">local</span> <span class="token assign-left variable">last_test</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token function">stat</span> <span class="token parameter variable">-c</span> %Y <span class="token string">"<span class="token variable">$test_restore_log</span>"</span><span class="token variable">)</span></span>
        <span class="token builtin class-name">local</span> <span class="token assign-left variable">current_time</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token function">date</span> +%s<span class="token variable">)</span></span>
        <span class="token builtin class-name">local</span> <span class="token assign-left variable">days_since_test</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$((</span> <span class="token punctuation">(</span>current_time <span class="token operator">-</span> last_test<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">86400</span> <span class="token variable">))</span></span>
        
        <span class="token keyword">if</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token string">"<span class="token variable">$days_since_test</span>"</span> <span class="token parameter variable">-lt</span> <span class="token number">30</span> <span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
            log_check <span class="token string">"Disaster Recovery"</span> <span class="token string">"PASS"</span> <span class="token string">"Backup restoration tested <span class="token variable">$days_since_test</span> days ago"</span>
            <span class="token builtin class-name">return</span> <span class="token number">0</span>
        <span class="token keyword">else</span>
            log_check <span class="token string">"Disaster Recovery"</span> <span class="token string">"WARN"</span> <span class="token string">"Backup restoration last tested <span class="token variable">$days_since_test</span> days ago"</span>
            <span class="token builtin class-name">return</span> <span class="token number">1</span>
        <span class="token keyword">fi</span>
    <span class="token keyword">else</span>
        log_check <span class="token string">"Disaster Recovery"</span> <span class="token string">"FAIL"</span> <span class="token string">"No backup restoration testing evidence"</span>
        <span class="token builtin class-name">return</span> <span class="token number">1</span>
    <span class="token keyword">fi</span>
<span class="token punctuation">}</span>

<span class="token comment"># Function to generate final report</span>
<span class="token function-name function">generate_report</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token builtin class-name">local</span> <span class="token assign-left variable">total_checks</span><span class="token operator">=</span><span class="token number">0</span>
    <span class="token builtin class-name">local</span> <span class="token assign-left variable">passed_checks</span><span class="token operator">=</span><span class="token number">0</span>
    <span class="token builtin class-name">local</span> <span class="token assign-left variable">failed_checks</span><span class="token operator">=</span><span class="token number">0</span>
    <span class="token builtin class-name">local</span> <span class="token assign-left variable">warnings</span><span class="token operator">=</span><span class="token number">0</span>
    
    <span class="token keyword">while</span> <span class="token assign-left variable"><span class="token environment constant">IFS</span></span><span class="token operator">=</span> <span class="token builtin class-name">read</span> <span class="token parameter variable">-r</span> line<span class="token punctuation">;</span> <span class="token keyword">do</span>
        <span class="token variable"><span class="token punctuation">((</span>total_checks<span class="token operator">++</span><span class="token punctuation">))</span></span>
        <span class="token keyword">if</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token string">"<span class="token variable">$line</span>"</span> <span class="token operator">==</span> *<span class="token string">"[PASS]"</span>* <span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
            <span class="token variable"><span class="token punctuation">((</span>passed_checks<span class="token operator">++</span><span class="token punctuation">))</span></span>
        <span class="token keyword">elif</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token string">"<span class="token variable">$line</span>"</span> <span class="token operator">==</span> *<span class="token string">"[FAIL]"</span>* <span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
            <span class="token variable"><span class="token punctuation">((</span>failed_checks<span class="token operator">++</span><span class="token punctuation">))</span></span>
        <span class="token keyword">elif</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token string">"<span class="token variable">$line</span>"</span> <span class="token operator">==</span> *<span class="token string">"[WARN]"</span>* <span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
            <span class="token variable"><span class="token punctuation">((</span>warnings<span class="token operator">++</span><span class="token punctuation">))</span></span>
        <span class="token keyword">fi</span>
    <span class="token keyword">done</span> <span class="token operator">&lt;</span> <span class="token string">"<span class="token variable">$CHECKLIST_LOG</span>"</span>
    
    <span class="token builtin class-name">echo</span> <span class="token string">"
====================================
ELASTICSEARCH PRODUCTION READINESS REPORT
====================================
Total Checks: <span class="token variable">$total_checks</span>
Passed: <span class="token variable">$passed_checks</span>
Failed: <span class="token variable">$failed_checks</span>
Warnings: <span class="token variable">$warnings</span>

Production Ready: <span class="token variable"><span class="token variable">$(</span><span class="token punctuation">[</span> $failed_checks <span class="token parameter variable">-eq</span> <span class="token number">0</span> <span class="token punctuation">]</span> <span class="token operator">&amp;&amp;</span> <span class="token builtin class-name">echo</span> <span class="token string">"YES"</span> <span class="token operator">||</span> <span class="token builtin class-name">echo</span> <span class="token string">"NO"</span><span class="token variable">)</span></span>
====================================
    "</span>
    
    <span class="token keyword">if</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token variable">$failed_checks</span> <span class="token parameter variable">-gt</span> <span class="token number">0</span> <span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
        <span class="token builtin class-name">echo</span> <span class="token string">"FAILED CHECKS:"</span>
        <span class="token function">grep</span> <span class="token string">"\[FAIL\]"</span> <span class="token string">"<span class="token variable">$CHECKLIST_LOG</span>"</span>
        <span class="token builtin class-name">echo</span>
    <span class="token keyword">fi</span>
    
    <span class="token keyword">if</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token variable">$warnings</span> <span class="token parameter variable">-gt</span> <span class="token number">0</span> <span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
        <span class="token builtin class-name">echo</span> <span class="token string">"WARNINGS:"</span>
        <span class="token function">grep</span> <span class="token string">"\[WARN\]"</span> <span class="token string">"<span class="token variable">$CHECKLIST_LOG</span>"</span>
        <span class="token builtin class-name">echo</span>
    <span class="token keyword">fi</span>
<span class="token punctuation">}</span>

<span class="token comment"># Main execution</span>
<span class="token function-name function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token builtin class-name">echo</span> <span class="token string">"Starting Elasticsearch Production Readiness Check..."</span>
    <span class="token builtin class-name">echo</span> <span class="token string">"Log file: <span class="token variable">$CHECKLIST_LOG</span>"</span>
    <span class="token builtin class-name">echo</span> <span class="token string">"Cluster: <span class="token variable">$CLUSTER_ENDPOINT</span>"</span>
    <span class="token builtin class-name">echo</span>
    
    <span class="token comment"># Clear previous log</span>
    <span class="token operator">&gt;</span> <span class="token string">"<span class="token variable">$CHECKLIST_LOG</span>"</span>
    
    <span class="token comment"># Run all checks</span>
    check_cluster_health
    check_security
    check_backup
    check_monitoring
    check_performance
    check_resource_limits
    check_disaster_recovery
    
    <span class="token comment"># Generate final report</span>
    generate_report
<span class="token punctuation">}</span>

<span class="token comment"># Execute main function</span>
main
</code></pre>
</div>

        <h3 id="go-live-procedures" class="group relative scroll-mt-20 text-xl font-semibold mb-3 mt-5">
          <a class="anchor absolute -ml-10 flex items-center opacity-0 group-hover:opacity-100 transition-opacity duration-200" aria-label="Link to this section" href="#go-live-procedures">
            <svg class="octicon octicon-link" viewBox="0 0 16 16" aria-hidden="true">
              <path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path>
            </svg>
          </a>
          <span>Go-Live Procedures</span>
        <a href="#/blog/self-managed-elasticsearch-vm-bare-metal-production-guide#go-live-procedures" class="header-link" style="opacity: 0; margin-left: 8px; text-decoration: none; color: rgb(107, 114, 128); transition: opacity 0.2s; cursor: pointer;">#</a></h3>
      
<div class="highlight highlight-bash notranslate" style="background-color: transparent !important; border: none !important; border-radius: 0px !important; padding: 0px !important; margin: 0px !important;">
<pre class="notranslate language-bash" tabindex="0" style="border-radius: 0.75rem !important; padding: 16px !important; margin: 16px 0px !important; overflow-x: auto !important; font-size: 14px !important; line-height: 1.5 !important; white-space: pre-wrap !important; overflow-wrap: normal !important; text-wrap-style: initial !important; word-break: normal !important;"><code class="language-bash" style="background: transparent !important; border: none !important; border-radius: 0px !important; font-family: ui-monospace, SFMono-Regular, &quot;SF Mono&quot;, Consolas, &quot;Liberation Mono&quot;, Menlo, monospace !important; font-size: 15px !important; line-height: 1.6 !important; padding: 0px !important; font-weight: 500 !important; text-rendering: geometricprecision !important; -webkit-font-smoothing: subpixel-antialiased !important; letter-spacing: 0.025em !important; white-space: pre-wrap !important; overflow-wrap: normal !important; text-wrap-style: initial !important; word-break: normal !important;"><span class="token shebang important">#!/bin/bash</span>
<span class="token comment"># elasticsearch_go_live.sh</span>

<span class="token assign-left variable">CLUSTER_ENDPOINT</span><span class="token operator">=</span><span class="token string">"http://localhost:9200"</span>
<span class="token assign-left variable">PRODUCTION_INDICES</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token string">"app-logs"</span> <span class="token string">"metrics"</span> <span class="token string">"user-events"</span><span class="token punctuation">)</span>
<span class="token assign-left variable">LOAD_BALANCER_ENDPOINT</span><span class="token operator">=</span><span class="token string">"https://elasticsearch-prod.company.com"</span>

<span class="token comment"># Function to gradually increase traffic</span>
<span class="token function-name function">gradual_traffic_increase</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token builtin class-name">local</span> <span class="token assign-left variable">percentages</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">10</span> <span class="token number">25</span> <span class="token number">50</span> <span class="token number">75</span> <span class="token number">100</span><span class="token punctuation">)</span>
    
    <span class="token builtin class-name">echo</span> <span class="token string">"Starting gradual traffic increase..."</span>
    
    <span class="token keyword">for</span> <span class="token for-or-select variable">percentage</span> <span class="token keyword">in</span> <span class="token string">"<span class="token variable">${percentages<span class="token punctuation">[</span>@<span class="token punctuation">]</span>}</span>"</span><span class="token punctuation">;</span> <span class="token keyword">do</span>
        <span class="token builtin class-name">echo</span> <span class="token string">"Increasing traffic to <span class="token variable">$percentage</span>%"</span>
        
        <span class="token comment"># Update load balancer weights (example with HAProxy)</span>
        <span class="token comment"># This would vary based on your load balancer</span>
        <span class="token function">ssh</span> load-balancer <span class="token string">"echo 'set server elasticsearch-backend/node1 weight <span class="token variable">$percentage</span>' | socat stdio /var/run/haproxy.sock"</span>
        
        <span class="token comment"># Monitor for 10 minutes</span>
        <span class="token builtin class-name">echo</span> <span class="token string">"Monitoring cluster performance for 10 minutes..."</span>
        <span class="token keyword">for</span> <span class="token for-or-select variable">i</span> <span class="token keyword">in</span> <span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">..</span><span class="token number">10</span><span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token keyword">do</span>
            <span class="token builtin class-name">local</span> <span class="token assign-left variable">health</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token function">curl</span> <span class="token parameter variable">-s</span> <span class="token string">"<span class="token variable">$CLUSTER_ENDPOINT</span>/_cluster/health"</span> <span class="token operator">|</span> jq <span class="token parameter variable">-r</span> <span class="token string">'.status'</span><span class="token variable">)</span></span>
            <span class="token builtin class-name">local</span> <span class="token assign-left variable">query_time</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token function">curl</span> <span class="token parameter variable">-s</span> <span class="token string">"<span class="token variable">$CLUSTER_ENDPOINT</span>/_nodes/stats"</span> <span class="token operator">|</span> jq <span class="token parameter variable">-r</span> <span class="token string">'._all.indices.search.query_time_in_millis'</span><span class="token variable">)</span></span>
            
            <span class="token builtin class-name">echo</span> <span class="token string">"  Minute <span class="token variable">$i</span>: Health=<span class="token variable">$health</span>, Avg Query Time=<span class="token variable">${query_time}</span>ms"</span>
            
            <span class="token keyword">if</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token string">"<span class="token variable">$health</span>"</span> <span class="token operator">!=</span> <span class="token string">"green"</span> <span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
                <span class="token builtin class-name">echo</span> <span class="token string">" Health degraded, rolling back traffic increase"</span>
                <span class="token comment"># Rollback traffic</span>
                <span class="token function">ssh</span> load-balancer <span class="token string">"echo 'set server elasticsearch-backend/node1 weight <span class="token variable"><span class="token variable">$((</span>percentage <span class="token operator">-</span> <span class="token number">25</span><span class="token variable">))</span></span>' | socat stdio /var/run/haproxy.sock"</span>
                <span class="token builtin class-name">return</span> <span class="token number">1</span>
            <span class="token keyword">fi</span>
            
            <span class="token function">sleep</span> <span class="token number">60</span>
        <span class="token keyword">done</span>
        
        <span class="token builtin class-name">echo</span> <span class="token string">" <span class="token variable">$percentage</span>% traffic level stable"</span>
    <span class="token keyword">done</span>
    
    <span class="token builtin class-name">echo</span> <span class="token string">" Full traffic migration completed successfully"</span>
<span class="token punctuation">}</span>

<span class="token comment"># Function to validate production workload</span>
<span class="token function-name function">validate_production_workload</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token builtin class-name">echo</span> <span class="token string">"Validating production workload..."</span>
    
    <span class="token comment"># Check index creation and data ingestion</span>
    <span class="token keyword">for</span> <span class="token for-or-select variable">index</span> <span class="token keyword">in</span> <span class="token string">"<span class="token variable">${PRODUCTION_INDICES<span class="token punctuation">[</span>@<span class="token punctuation">]</span>}</span>"</span><span class="token punctuation">;</span> <span class="token keyword">do</span>
        <span class="token builtin class-name">local</span> <span class="token assign-left variable">doc_count</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token function">curl</span> <span class="token parameter variable">-s</span> <span class="token string">"<span class="token variable">$CLUSTER_ENDPOINT</span>/<span class="token variable">$index</span>/_count"</span> <span class="token operator">|</span> jq <span class="token parameter variable">-r</span> <span class="token string">'.count'</span><span class="token variable">)</span></span>
        <span class="token builtin class-name">echo</span> <span class="token string">"Index <span class="token variable">$index</span>: <span class="token variable">$doc_count</span> documents"</span>
        
        <span class="token keyword">if</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token string">"<span class="token variable">$doc_count</span>"</span> <span class="token parameter variable">-eq</span> <span class="token number">0</span> <span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
            <span class="token builtin class-name">echo</span> <span class="token string">" Warning: No documents in <span class="token variable">$index</span>"</span>
        <span class="token keyword">fi</span>
    <span class="token keyword">done</span>
    
    <span class="token comment"># Performance validation</span>
    <span class="token builtin class-name">local</span> <span class="token assign-left variable">avg_query_latency</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token function">curl</span> <span class="token parameter variable">-s</span> <span class="token string">"<span class="token variable">$CLUSTER_ENDPOINT</span>/_nodes/stats"</span> <span class="token operator">|</span> jq <span class="token parameter variable">-r</span> <span class="token string">'.nodes | map(.indices.search.query_time_in_millis / .indices.search.query_total) | add / length'</span><span class="token variable">)</span></span>
    <span class="token builtin class-name">local</span> <span class="token assign-left variable">indexing_rate</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token function">curl</span> <span class="token parameter variable">-s</span> <span class="token string">"<span class="token variable">$CLUSTER_ENDPOINT</span>/_nodes/stats"</span> <span class="token operator">|</span> jq <span class="token parameter variable">-r</span> <span class="token string">'.nodes | map(.indices.indexing.index_total) | add'</span><span class="token variable">)</span></span>
    
    <span class="token builtin class-name">echo</span> <span class="token string">"Average query latency: <span class="token variable">${avg_query_latency}</span>ms"</span>
    <span class="token builtin class-name">echo</span> <span class="token string">"Total indexed documents: <span class="token variable">$indexing_rate</span>"</span>
    
    <span class="token comment"># SLA validation</span>
    <span class="token keyword">if</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token variable"><span class="token variable">$(</span><span class="token builtin class-name">echo</span> <span class="token string">"<span class="token variable">$avg_query_latency</span> &lt; 100"</span> <span class="token operator">|</span> <span class="token function">bc</span><span class="token variable">)</span></span> <span class="token parameter variable">-eq</span> <span class="token number">1</span> <span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
        <span class="token builtin class-name">echo</span> <span class="token string">" Query latency SLA met"</span>
    <span class="token keyword">else</span>
        <span class="token builtin class-name">echo</span> <span class="token string">" Query latency SLA not met"</span>
        <span class="token builtin class-name">return</span> <span class="token number">1</span>
    <span class="token keyword">fi</span>
<span class="token punctuation">}</span>

<span class="token comment"># Function to enable production monitoring</span>
<span class="token function-name function">enable_production_monitoring</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token builtin class-name">echo</span> <span class="token string">"Enabling production monitoring and alerting..."</span>
    
    <span class="token comment"># Enable cluster-level monitoring</span>
    <span class="token function">curl</span> <span class="token parameter variable">-X</span> PUT <span class="token string">"<span class="token variable">$CLUSTER_ENDPOINT</span>/_cluster/settings"</span> <span class="token punctuation">\</span>
        <span class="token parameter variable">-H</span> <span class="token string">"Content-Type: application/json"</span> <span class="token punctuation">\</span>
        <span class="token parameter variable">-d</span> <span class="token string">'{
            "persistent": {
                "xpack.monitoring.collection.enabled": true,
                "xpack.monitoring.collection.interval": "10s"
            }
        }'</span>
    
    <span class="token comment"># Configure alerting</span>
    <span class="token function">curl</span> <span class="token parameter variable">-X</span> PUT <span class="token string">"<span class="token variable">$CLUSTER_ENDPOINT</span>/_watcher/watch/production_health_monitor"</span> <span class="token punctuation">\</span>
        <span class="token parameter variable">-H</span> <span class="token string">"Content-Type: application/json"</span> <span class="token punctuation">\</span>
        <span class="token parameter variable">-d</span> <span class="token string">'{
            "trigger": {
                "schedule": {
                    "interval": "1m"
                }
            },
            "input": {
                "http": {
                    "request": {
                        "scheme": "http",
                        "host": "localhost",
                        "port": 9200,
                        "path": "/_cluster/health"
                    }
                }
            },
            "condition": {
                "compare": {
                    "ctx.payload.status": {
                        "not_eq": "green"
                    }
                }
            },
            "actions": {
                "send_alert": {
                    "webhook": {
                        "scheme": "https",
                        "host": "hooks.slack.com",
                        "port": 443,
                        "method": "post",
                        "path": "/services/YOUR/SLACK/WEBHOOK",
                        "body": " Production Elasticsearch cluster health is {{ctx.payload.status}}"
                    }
                }
            }
        }'</span>
    
    <span class="token builtin class-name">echo</span> <span class="token string">" Production monitoring enabled"</span>
<span class="token punctuation">}</span>

<span class="token comment"># Main go-live procedure</span>
<span class="token function-name function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token builtin class-name">echo</span> <span class="token string">"======================================"</span>
    <span class="token builtin class-name">echo</span> <span class="token string">"ELASTICSEARCH PRODUCTION GO-LIVE"</span>
    <span class="token builtin class-name">echo</span> <span class="token string">"======================================"</span>
    <span class="token builtin class-name">echo</span> <span class="token string">"Cluster: <span class="token variable">$CLUSTER_ENDPOINT</span>"</span>
    <span class="token builtin class-name">echo</span> <span class="token string">"Load Balancer: <span class="token variable">$LOAD_BALANCER_ENDPOINT</span>"</span>
    <span class="token builtin class-name">echo</span> <span class="token string">"Time: <span class="token variable"><span class="token variable">$(</span><span class="token function">date</span><span class="token variable">)</span></span>"</span>
    <span class="token builtin class-name">echo</span>
    
    <span class="token comment"># Pre-flight checks</span>
    <span class="token builtin class-name">echo</span> <span class="token string">"1. Running pre-flight checks..."</span>
    ./elasticsearch_production_readiness.sh
    
    <span class="token keyword">if</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token variable">$?</span> <span class="token parameter variable">-ne</span> <span class="token number">0</span> <span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
        <span class="token builtin class-name">echo</span> <span class="token string">" Pre-flight checks failed. Aborting go-live."</span>
        <span class="token builtin class-name">exit</span> <span class="token number">1</span>
    <span class="token keyword">fi</span>
    
    <span class="token comment"># Enable production monitoring</span>
    <span class="token builtin class-name">echo</span> <span class="token string">"2. Enabling production monitoring..."</span>
    enable_production_monitoring
    
    <span class="token comment"># Start gradual traffic increase</span>
    <span class="token builtin class-name">echo</span> <span class="token string">"3. Starting gradual traffic migration..."</span>
    gradual_traffic_increase
    
    <span class="token keyword">if</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token variable">$?</span> <span class="token parameter variable">-ne</span> <span class="token number">0</span> <span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
        <span class="token builtin class-name">echo</span> <span class="token string">" Traffic migration failed. Manual intervention required."</span>
        <span class="token builtin class-name">exit</span> <span class="token number">1</span>
    <span class="token keyword">fi</span>
    
    <span class="token comment"># Validate production workload</span>
    <span class="token builtin class-name">echo</span> <span class="token string">"4. Validating production workload..."</span>
    validate_production_workload
    
    <span class="token keyword">if</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token variable">$?</span> <span class="token parameter variable">-ne</span> <span class="token number">0</span> <span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
        <span class="token builtin class-name">echo</span> <span class="token string">" Production workload validation failed."</span>
        <span class="token builtin class-name">exit</span> <span class="token number">1</span>
    <span class="token keyword">fi</span>
    
    <span class="token builtin class-name">echo</span> <span class="token string">"
 PRODUCTION GO-LIVE COMPLETED SUCCESSFULLY!
    
Next Steps:
1. Monitor cluster performance for the next 24 hours
2. Validate backup procedures within 48 hours
3. Conduct post-go-live review within 1 week
4. Update documentation with production configurations
    
Support Contacts:
- Primary: SRE Team
- Secondary: Platform Engineering
- Escalation: Engineering Manager
    "</span>
<span class="token punctuation">}</span>

<span class="token comment"># Execute main function</span>
main
</code></pre>
</div>
<hr>

        <h2 id="summary-and-next-steps" class="group relative scroll-mt-20 text-2xl font-semibold mb-4 mt-6 border-b border-gray-200 dark:border-gray-700 pb-2">
          <a class="anchor absolute -ml-10 flex items-center opacity-0 group-hover:opacity-100 transition-opacity duration-200" aria-label="Link to this section" href="#summary-and-next-steps">
            <svg class="octicon octicon-link" viewBox="0 0 16 16" aria-hidden="true">
              <path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path>
            </svg>
          </a>
          <span>Summary and Next Steps</span>
        <a href="#/blog/self-managed-elasticsearch-vm-bare-metal-production-guide#summary-and-next-steps" class="header-link" style="opacity: 0; margin-left: 8px; text-decoration: none; color: rgb(107, 114, 128); transition: opacity 0.2s; cursor: pointer;">#</a></h2>
      
<p>Self-managed Elasticsearch deployments offer unparalleled control, performance optimization opportunities, and cost efficiency at scale. However, they require significant technical expertise, operational maturity, and long-term commitment to succeed.</p>

        <h3 id="key-success-factors" class="group relative scroll-mt-20 text-xl font-semibold mb-3 mt-5">
          <a class="anchor absolute -ml-10 flex items-center opacity-0 group-hover:opacity-100 transition-opacity duration-200" aria-label="Link to this section" href="#key-success-factors">
            <svg class="octicon octicon-link" viewBox="0 0 16 16" aria-hidden="true">
              <path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path>
            </svg>
          </a>
          <span>Key Success Factors</span>
        <a href="#/blog/self-managed-elasticsearch-vm-bare-metal-production-guide#key-success-factors" class="header-link" style="opacity: 0; margin-left: 8px; text-decoration: none; color: rgb(107, 114, 128); transition: opacity 0.2s; cursor: pointer;">#</a></h3>
      
<p><strong>Technical Foundation:</strong></p>
<ul>
<li>Proper hardware sizing and optimization</li>
<li>Comprehensive monitoring and alerting</li>
<li>Automated backup and disaster recovery</li>
<li>Security implementation and maintenance</li>
</ul>
<p><strong>Operational Excellence:</strong></p>
<ul>
<li>Skilled team with Elasticsearch expertise</li>
<li>Robust deployment and update procedures</li>
<li>24/7 monitoring and incident response</li>
<li>Regular capacity planning and optimization</li>
</ul>
<p><strong>Strategic Alignment:</strong></p>
<ul>
<li>Clear ROI justification and tracking</li>
<li>Long-term commitment to operational investment</li>
<li>Integration with existing infrastructure</li>
<li>Compliance and security requirements</li>
</ul>

        <h3 id="when-self-managed-makes-sense" class="group relative scroll-mt-20 text-xl font-semibold mb-3 mt-5">
          <a class="anchor absolute -ml-10 flex items-center opacity-0 group-hover:opacity-100 transition-opacity duration-200" aria-label="Link to this section" href="#when-self-managed-makes-sense">
            <svg class="octicon octicon-link" viewBox="0 0 16 16" aria-hidden="true">
              <path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path>
            </svg>
          </a>
          <span>When Self-Managed Makes Sense</span>
        <a href="#/blog/self-managed-elasticsearch-vm-bare-metal-production-guide#when-self-managed-makes-sense" class="header-link" style="opacity: 0; margin-left: 8px; text-decoration: none; color: rgb(107, 114, 128); transition: opacity 0.2s; cursor: pointer;">#</a></h3>
      
<p>Choose self-managed Elasticsearch when:</p>
<ul>
<li>Data volume exceeds 10TB with predictable growth</li>
<li>Team has strong infrastructure and Elasticsearch expertise</li>
<li>Cost optimization is a primary concern (40-60% savings at scale)</li>
<li>Custom performance tuning or security requirements exist</li>
<li>Long-term deployment horizon (2+ years) justifies investment</li>
</ul>

        <h3 id="migration-path-from-managed-solutions" class="group relative scroll-mt-20 text-xl font-semibold mb-3 mt-5">
          <a class="anchor absolute -ml-10 flex items-center opacity-0 group-hover:opacity-100 transition-opacity duration-200" aria-label="Link to this section" href="#migration-path-from-managed-solutions">
            <svg class="octicon octicon-link" viewBox="0 0 16 16" aria-hidden="true">
              <path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path>
            </svg>
          </a>
          <span>Migration Path from Managed Solutions</span>
        <a href="#/blog/self-managed-elasticsearch-vm-bare-metal-production-guide#migration-path-from-managed-solutions" class="header-link" style="opacity: 0; margin-left: 8px; text-decoration: none; color: rgb(107, 114, 128); transition: opacity 0.2s; cursor: pointer;">#</a></h3>
      
<p>If you're currently using managed Elasticsearch and considering self-managed:</p>
<ol>
<li><p><strong>Assessment Phase (1-2 months):</strong></p>
<ul>
<li>Evaluate team capabilities and training needs</li>
<li>Analyze current costs and performance requirements</li>
<li>Plan infrastructure and automation requirements</li>
</ul>
</li>
<li><p><strong>Proof of Concept (2-3 months):</strong></p>
<ul>
<li>Build parallel self-managed environment</li>
<li>Test performance and operational procedures</li>
<li>Validate cost projections and ROI</li>
</ul>
</li>
<li><p><strong>Production Migration (1-2 months):</strong></p>
<ul>
<li>Implement gradual data migration</li>
<li>Validate functionality and performance</li>
<li>Execute complete cutover with rollback plan</li>
</ul>
</li>
</ol>
<hr>

        <h2 id="next-in-the-series" class="group relative scroll-mt-20 text-2xl font-semibold mb-4 mt-6 border-b border-gray-200 dark:border-gray-700 pb-2">
          <a class="anchor absolute -ml-10 flex items-center opacity-0 group-hover:opacity-100 transition-opacity duration-200" aria-label="Link to this section" href="#next-in-the-series">
            <svg class="octicon octicon-link" viewBox="0 0 16 16" aria-hidden="true">
              <path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path>
            </svg>
          </a>
          <span>Next in the Series</span>
        <a href="#/blog/self-managed-elasticsearch-vm-bare-metal-production-guide#next-in-the-series" class="header-link" style="opacity: 0; margin-left: 8px; text-decoration: none; color: rgb(107, 114, 128); transition: opacity 0.2s; cursor: pointer;">#</a></h2>
      
<p>Your self-managed infrastructure foundation is now solid. Continue exploring deployment strategies:</p>
<ul>
<li><strong><a href="https://thisiskushal31.github.io/blog/#/blog/docker-elasticsearch-container-deployment-strategies" target="_blank" rel="noopener noreferrer">Blog 4: Containerized Elasticsearch</a></strong> - Master Docker production strategies and container orchestration</li>
<li><strong><a href="https://thisiskushal31.github.io/blog/#/blog/kubernetes-elasticsearch-eck-helm-raw-yaml-deep-dive" target="_blank" rel="noopener noreferrer">Blog 5: Kubernetes Deep Dive</a></strong> - Learn cloud-native deployment with ECK, Helm, and StatefulSets</li>
<li><strong><a href="https://thisiskushal31.github.io/blog/#/blog/elasticsearch-local-development-docker-packages-quick-start" target="_blank" rel="noopener noreferrer">Blog 6: Local Development</a></strong> - Optimize development workflows for maximum productivity</li>
<li><strong><a href="https://thisiskushal31.github.io/blog/#/blog/elasticsearch-deployment-decision-matrix-complete-comparison-guide" target="_blank" rel="noopener noreferrer">Blog 7: Ultimate Decision Matrix</a></strong> - Compare all deployment approaches with comprehensive analysis</li>
</ul>
<hr>
<p>Ready to explore advanced infrastructure automation and deployment patterns? Connect with a community of engineers building production-scale search infrastructure.</p>
<p><strong><a href="https://thisiskushal31.github.io/link/" target="_blank" rel="noopener noreferrer"> Access My Complete Technical Resource Collection</a></strong></p>
<hr>
<p><strong>Fact-Checking &amp; Verification:</strong> This blog post contains technical specifications, best practices, and cost estimates based on publicly available documentation and industry research. All pricing information should be verified with official cloud provider pricing calculators. Technical capabilities and configurations may vary by environment and Elasticsearch version. For the most current and accurate information, please consult:</p>
<ul>
<li><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/index.html" target="_blank" rel="noopener noreferrer">Elasticsearch Official Documentation</a></li>
<li><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/install-elasticsearch.html" target="_blank" rel="noopener noreferrer">Elasticsearch Installation Guide</a></li>
<li><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/settings.html" target="_blank" rel="noopener noreferrer">Elasticsearch Configuration</a></li>
</ul>
<hr>
<p><em>From infrastructure as code to performance optimization, monitoring strategies to cost management - discover battle-tested insights for building resilient, scalable systems that power modern applications.</em> 
    </p>
</div></div></div></div></article><section class="py-12 px-4 bg-muted/30"><div class="max-w-7xl mx-auto"><h2 class="text-3xl font-bold text-foreground mb-8 text-center">More Articles</h2><div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8"><div class="blog-card fade-in-up" style="animation-delay: 0ms;"><div class="space-y-4"><div class="flex flex-wrap gap-2"><span class="tag text-xs">MongoDB</span><span class="tag text-xs">Self-Managed</span></div><h3 class="text-xl font-semibold text-foreground hover:text-primary transition-colors duration-200 line-clamp-2"><a href="#/blog/mongodb-self-managed-vm-bare-metal-production-guide">Self-Managed MongoDB - VM and Bare Metal Production Guide</a></h3><p class="text-muted-foreground line-clamp-3">Complete guide to self-managed MongoDB on VMs and bare metal with production optimizations. Learn architecture, HA setup, performance tuning, and cost optimization strategies.</p><div class="flex items-center justify-between text-sm text-muted-foreground"><span>January 30, 2025</span><span>4 min read</span></div></div></div><div class="blog-card fade-in-up" style="animation-delay: 100ms;"><div class="space-y-4"><div class="flex flex-wrap gap-2"><span class="tag text-xs">Redis</span><span class="tag text-xs">Self-Managed</span></div><h3 class="text-xl font-semibold text-foreground hover:text-primary transition-colors duration-200 line-clamp-2"><a href="#/blog/redis-self-managed-vm-bare-metal-production-guide">Self-Managed Redis - VM and Bare Metal Production Guide</a></h3><p class="text-muted-foreground line-clamp-3">Complete guide to self-managed Redis on VMs and bare metal with production optimizations. Learn architecture, HA setup, performance tuning, and cost optimization strategies.</p><div class="flex items-center justify-between text-sm text-muted-foreground"><span>February 7, 2025</span><span>3 min read</span></div></div></div><div class="blog-card fade-in-up" style="animation-delay: 200ms;"><div class="space-y-4"><div class="flex flex-wrap gap-2"><span class="tag text-xs">Aerospike</span><span class="tag text-xs">Self-Managed</span></div><h3 class="text-xl font-semibold text-foreground hover:text-primary transition-colors duration-200 line-clamp-2"><a href="#/blog/aerospike-self-managed-vm-bare-metal-production-guide">Self-Managed Aerospike - VM and Bare Metal Production Guide</a></h3><p class="text-muted-foreground line-clamp-3">Complete guide to self-managed Aerospike on VMs and bare metal with production optimizations. Learn architecture, HA setup, HMA tuning, performance optimization, and cost optimization strategies.</p><div class="flex items-center justify-between text-sm text-muted-foreground"><span>February 15, 2025</span><span>3 min read</span></div></div></div></div></div></section></div></main></div></div>
    <script>
      // GitHub Pages SPA redirect for clean URLs
      // This script converts clean URLs like /blog/post-name to hash URLs like /#/blog/post-name
      (function() {
        var path = window.location.pathname;
        var search = window.location.search;
        var hash = window.location.hash;
        
        // Handle root blog path: /blog/ -> /blog/#/blog
        if (path === '/blog/' && !hash) {
          // Store the original URL for the 404.html redirect
          sessionStorage.redirect = window.location.href;
          // Redirect to hash version: /blog/#/blog
          window.location.replace('/blog/#/blog');
        }
        // If we're on a clean URL (not already a hash URL), redirect to hash version
        else if (path !== '/blog/' && path.startsWith('/blog/') && !hash) {
          var cleanPath = path.replace('/blog/', '');
          if (cleanPath) {
            // Store the original URL for the 404.html redirect
            sessionStorage.redirect = window.location.href;
            // Redirect to hash version: /blog/#/blog/post-name
            window.location.replace('/blog/#/blog/' + cleanPath);
          }
        }
        // Handle direct post URLs like /post-name (even cleaner)
        else if (path !== '/' && !path.startsWith('/blog/') && !hash && path !== '/blog/') {
          var postSlug = path.substring(1); // Remove leading slash
          if (postSlug) {
            // Store the original URL for the 404.html redirect
            sessionStorage.redirect = window.location.href;
            // Redirect to hash version: /blog/#/blog/post-name
            window.location.replace('/blog/#/blog/' + postSlug);
          }
        }
      })();
    </script>
  

</body></html>